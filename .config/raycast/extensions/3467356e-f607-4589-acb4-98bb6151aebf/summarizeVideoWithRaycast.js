"use strict";var zu=Object.create;var pn=Object.defineProperty;var Hu=Object.getOwnPropertyDescriptor;var Gu=Object.getOwnPropertyNames;var Yu=Object.getPrototypeOf,Qu=Object.prototype.hasOwnProperty;var Rr=(r,n)=>()=>(r&&(n=r(r=0)),n);var te=(r,n)=>()=>(n||r((n={exports:{}}).exports,n),n.exports),So=(r,n)=>{for(var a in n)pn(r,a,{get:n[a],enumerable:!0})},wo=(r,n,a,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of Gu(n))!Qu.call(r,i)&&i!==a&&pn(r,i,{get:()=>n[i],enumerable:!(s=Hu(n,i))||s.enumerable});return r};var We=(r,n,a)=>(a=r!=null?zu(Yu(r)):{},wo(n||!r||!r.__esModule?pn(a,"default",{value:r,enumerable:!0}):a,r)),Xu=r=>wo(pn({},"__esModule",{value:!0}),r);var vo=te((bn,Ro)=>{(function(r,n){typeof bn=="object"&&typeof Ro<"u"?n(bn):typeof define=="function"&&define.amd?define(["exports"],n):(r=typeof globalThis<"u"?globalThis:r||self,n(r.WebStreamsPolyfill={}))})(bn,function(r){"use strict";function n(){}function a(e){return typeof e=="object"&&e!==null||typeof e=="function"}let s=n;function i(e,t){try{Object.defineProperty(e,"name",{value:t,configurable:!0})}catch{}}let u=Promise,f=Promise.prototype.then,p=Promise.reject.bind(u);function b(e){return new u(e)}function m(e){return b(t=>t(e))}function _(e){return p(e)}function v(e,t,o){return f.call(e,t,o)}function P(e,t,o){v(v(e,t,o),void 0,s)}function A(e,t){P(e,t)}function R(e,t){P(e,void 0,t)}function N(e,t,o){return v(e,t,o)}function O(e){v(e,void 0,s)}let W=e=>{if(typeof queueMicrotask=="function")W=queueMicrotask;else{let t=m(void 0);W=o=>v(t,o)}return W(e)};function I(e,t,o){if(typeof e!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(e,t,o)}function L(e,t,o){try{return m(I(e,t,o))}catch(d){return _(d)}}let M=16384;class U{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(t){let o=this._back,d=o;o._elements.length===M-1&&(d={_elements:[],_next:void 0}),o._elements.push(t),d!==o&&(this._back=d,o._next=d),++this._size}shift(){let t=this._front,o=t,d=this._cursor,h=d+1,S=t._elements,w=S[d];return h===M&&(o=t._next,h=0),--this._size,this._cursor=h,t!==o&&(this._front=o),S[d]=void 0,w}forEach(t){let o=this._cursor,d=this._front,h=d._elements;for(;(o!==h.length||d._next!==void 0)&&!(o===h.length&&(d=d._next,h=d._elements,o=0,h.length===0));)t(h[o]),++o}peek(){let t=this._front,o=this._cursor;return t._elements[o]}}let V=Symbol("[[AbortSteps]]"),Q=Symbol("[[ErrorSteps]]"),g=Symbol("[[CancelSteps]]"),de=Symbol("[[PullSteps]]"),F=Symbol("[[ReleaseSteps]]");function C(e,t){e._ownerReadableStream=t,t._reader=e,t._state==="readable"?he(e):t._state==="closed"?D(e):q(e,t._storedError)}function z(e,t){let o=e._ownerReadableStream;return Me(o,t)}function X(e){let t=e._ownerReadableStream;t._state==="readable"?re(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):ct(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),t._readableStreamController[F](),t._reader=void 0,e._ownerReadableStream=void 0}function Y(e){return new TypeError("Cannot "+e+" a stream using a released reader")}function he(e){e._closedPromise=b((t,o)=>{e._closedPromise_resolve=t,e._closedPromise_reject=o})}function q(e,t){he(e),re(e,t)}function D(e){he(e),je(e)}function re(e,t){e._closedPromise_reject!==void 0&&(O(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}function ct(e,t){q(e,t)}function je(e){e._closedPromise_resolve!==void 0&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}let Vt=Number.isFinite||function(e){return typeof e=="number"&&isFinite(e)},Nn=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};function xr(e){return typeof e=="object"||typeof e=="function"}function we(e,t){if(e!==void 0&&!xr(e))throw new TypeError(`${t} is not an object.`)}function pe(e,t){if(typeof e!="function")throw new TypeError(`${t} is not a function.`)}function c(e){return typeof e=="object"&&e!==null||typeof e=="function"}function l(e,t){if(!c(e))throw new TypeError(`${t} is not an object.`)}function T(e,t,o){if(e===void 0)throw new TypeError(`Parameter ${t} is required in '${o}'.`)}function y(e,t,o){if(e===void 0)throw new TypeError(`${t} is required in '${o}'.`)}function G(e){return Number(e)}function ee(e){return e===0?0:e}function ne(e){return ee(Nn(e))}function se(e,t){let d=Number.MAX_SAFE_INTEGER,h=Number(e);if(h=ee(h),!Vt(h))throw new TypeError(`${t} is not a finite number`);if(h=ne(h),h<0||h>d)throw new TypeError(`${t} is outside the accepted range of 0 to ${d}, inclusive`);return!Vt(h)||h===0?0:h}function be(e,t){if(!pt(e))throw new TypeError(`${t} is not a ReadableStream.`)}function Te(e){return new Ie(e)}function ae(e,t){e._reader._readRequests.push(t)}function Re(e,t,o){let h=e._reader._readRequests.shift();o?h._closeSteps():h._chunkSteps(t)}function $t(e){return e._reader._readRequests.length}function fr(e){let t=e._reader;return!(t===void 0||!ke(t))}class Ie{constructor(t){if(T(t,1,"ReadableStreamDefaultReader"),be(t,"First parameter"),bt(t))throw new TypeError("This stream has already been locked for exclusive reading by another reader");C(this,t),this._readRequests=new U}get closed(){return ke(this)?this._closedPromise:_(Wr("closed"))}cancel(t=void 0){return ke(this)?this._ownerReadableStream===void 0?_(Y("cancel")):z(this,t):_(Wr("cancel"))}read(){if(!ke(this))return _(Wr("read"));if(this._ownerReadableStream===void 0)return _(Y("read from"));let t,o,d=b((S,w)=>{t=S,o=w});return mr(this,{_chunkSteps:S=>t({value:S,done:!1}),_closeSteps:()=>t({value:void 0,done:!0}),_errorSteps:S=>o(S)}),d}releaseLock(){if(!ke(this))throw Wr("releaseLock");this._ownerReadableStream!==void 0&&sl(this)}}Object.defineProperties(Ie.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),i(Ie.prototype.cancel,"cancel"),i(Ie.prototype.read,"read"),i(Ie.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ie.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function ke(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_readRequests")?!1:e instanceof Ie}function mr(e,t){let o=e._ownerReadableStream;o._disturbed=!0,o._state==="closed"?t._closeSteps():o._state==="errored"?t._errorSteps(o._storedError):o._readableStreamController[de](t)}function sl(e){X(e);let t=new TypeError("Reader was released");di(e,t)}function di(e,t){let o=e._readRequests;e._readRequests=new U,o.forEach(d=>{d._errorSteps(t)})}function Wr(e){return new TypeError(`ReadableStreamDefaultReader.prototype.${e} can only be used on a ReadableStreamDefaultReader`)}let ll=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class fi{constructor(t,o){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=t,this._preventCancel=o}next(){let t=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?N(this._ongoingPromise,t,t):t(),this._ongoingPromise}return(t){let o=()=>this._returnSteps(t);return this._ongoingPromise?N(this._ongoingPromise,o,o):o()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let t=this._reader,o,d,h=b((w,E)=>{o=w,d=E});return mr(t,{_chunkSteps:w=>{this._ongoingPromise=void 0,W(()=>o({value:w,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,X(t),o({value:void 0,done:!0})},_errorSteps:w=>{this._ongoingPromise=void 0,this._isFinished=!0,X(t),d(w)}}),h}_returnSteps(t){if(this._isFinished)return Promise.resolve({value:t,done:!0});this._isFinished=!0;let o=this._reader;if(!this._preventCancel){let d=z(o,t);return X(o),N(d,()=>({value:t,done:!0}))}return X(o),m({value:t,done:!0})}}let mi={next(){return hi(this)?this._asyncIteratorImpl.next():_(pi("next"))},return(e){return hi(this)?this._asyncIteratorImpl.return(e):_(pi("return"))}};Object.setPrototypeOf(mi,ll);function ul(e,t){let o=Te(e),d=new fi(o,t),h=Object.create(mi);return h._asyncIteratorImpl=d,h}function hi(e){if(!a(e)||!Object.prototype.hasOwnProperty.call(e,"_asyncIteratorImpl"))return!1;try{return e._asyncIteratorImpl instanceof fi}catch{return!1}}function pi(e){return new TypeError(`ReadableStreamAsyncIterator.${e} can only be used on a ReadableSteamAsyncIterator`)}let bi=Number.isNaN||function(e){return e!==e};var Mn,xn,Wn;function hr(e){return e.slice()}function yi(e,t,o,d,h){new Uint8Array(e).set(new Uint8Array(o,d,h),t)}let Ze=e=>(typeof e.transfer=="function"?Ze=t=>t.transfer():typeof structuredClone=="function"?Ze=t=>structuredClone(t,{transfer:[t]}):Ze=t=>t,Ze(e)),dt=e=>(typeof e.detached=="boolean"?dt=t=>t.detached:dt=t=>t.byteLength===0,dt(e));function gi(e,t,o){if(e.slice)return e.slice(t,o);let d=o-t,h=new ArrayBuffer(d);return yi(h,0,e,t,d),h}function Ur(e,t){let o=e[t];if(o!=null){if(typeof o!="function")throw new TypeError(`${String(t)} is not a function`);return o}}function cl(e){let t={[Symbol.iterator]:()=>e.iterator},o=async function*(){return yield*t}(),d=o.next;return{iterator:o,nextMethod:d,done:!1}}let Un=(Wn=(Mn=Symbol.asyncIterator)!==null&&Mn!==void 0?Mn:(xn=Symbol.for)===null||xn===void 0?void 0:xn.call(Symbol,"Symbol.asyncIterator"))!==null&&Wn!==void 0?Wn:"@@asyncIterator";function _i(e,t="sync",o){if(o===void 0)if(t==="async"){if(o=Ur(e,Un),o===void 0){let S=Ur(e,Symbol.iterator),w=_i(e,"sync",S);return cl(w)}}else o=Ur(e,Symbol.iterator);if(o===void 0)throw new TypeError("The object is not iterable");let d=I(o,e,[]);if(!a(d))throw new TypeError("The iterator method must return an object");let h=d.next;return{iterator:d,nextMethod:h,done:!1}}function dl(e){let t=I(e.nextMethod,e.iterator,[]);if(!a(t))throw new TypeError("The iterator.next() method must return an object");return t}function fl(e){return!!e.done}function ml(e){return e.value}function hl(e){return!(typeof e!="number"||bi(e)||e<0)}function Si(e){let t=gi(e.buffer,e.byteOffset,e.byteOffset+e.byteLength);return new Uint8Array(t)}function Vn(e){let t=e._queue.shift();return e._queueTotalSize-=t.size,e._queueTotalSize<0&&(e._queueTotalSize=0),t.value}function $n(e,t,o){if(!hl(o)||o===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");e._queue.push({value:t,size:o}),e._queueTotalSize+=o}function pl(e){return e._queue.peek().value}function ft(e){e._queue=new U,e._queueTotalSize=0}function wi(e){return e===DataView}function bl(e){return wi(e.constructor)}function yl(e){return wi(e)?1:e.BYTES_PER_ELEMENT}class vt{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!jn(this))throw Qn("view");return this._view}respond(t){if(!jn(this))throw Qn("respond");if(T(t,1,"respond"),t=se(t,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(dt(this._view.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");zr(this._associatedReadableByteStreamController,t)}respondWithNewView(t){if(!jn(this))throw Qn("respondWithNewView");if(T(t,1,"respondWithNewView"),!ArrayBuffer.isView(t))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(dt(t.buffer))throw new TypeError("The given view's buffer has been detached and so cannot be used as a response");Hr(this._associatedReadableByteStreamController,t)}}Object.defineProperties(vt.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),i(vt.prototype.respond,"respond"),i(vt.prototype.respondWithNewView,"respondWithNewView"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(vt.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class Ke{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!Et(this))throw br("byobRequest");return Yn(this)}get desiredSize(){if(!Et(this))throw br("desiredSize");return Bi(this)}close(){if(!Et(this))throw br("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");let t=this._controlledReadableByteStream._state;if(t!=="readable")throw new TypeError(`The stream (in ${t} state) is not in the readable state and cannot be closed`);pr(this)}enqueue(t){if(!Et(this))throw br("enqueue");if(T(t,1,"enqueue"),!ArrayBuffer.isView(t))throw new TypeError("chunk must be an array buffer view");if(t.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(t.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");let o=this._controlledReadableByteStream._state;if(o!=="readable")throw new TypeError(`The stream (in ${o} state) is not in the readable state and cannot be enqueued to`);jr(this,t)}error(t=void 0){if(!Et(this))throw br("error");De(this,t)}[g](t){Ti(this),ft(this);let o=this._cancelAlgorithm(t);return $r(this),o}[de](t){let o=this._controlledReadableByteStream;if(this._queueTotalSize>0){Di(this,t);return}let d=this._autoAllocateChunkSize;if(d!==void 0){let h;try{h=new ArrayBuffer(d)}catch(w){t._errorSteps(w);return}let S={buffer:h,bufferByteLength:d,byteOffset:0,byteLength:d,bytesFilled:0,minimumFill:1,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(S)}ae(o,t),At(this)}[F](){if(this._pendingPullIntos.length>0){let t=this._pendingPullIntos.peek();t.readerType="none",this._pendingPullIntos=new U,this._pendingPullIntos.push(t)}}}Object.defineProperties(Ke.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),i(Ke.prototype.close,"close"),i(Ke.prototype.enqueue,"enqueue"),i(Ke.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ke.prototype,Symbol.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function Et(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledReadableByteStream")?!1:e instanceof Ke}function jn(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_associatedReadableByteStreamController")?!1:e instanceof vt}function At(e){if(!Tl(e))return;if(e._pulling){e._pullAgain=!0;return}e._pulling=!0;let o=e._pullAlgorithm();P(o,()=>(e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,At(e)),null),d=>(De(e,d),null))}function Ti(e){Hn(e),e._pendingPullIntos=new U}function zn(e,t){let o=!1;e._state==="closed"&&(o=!0);let d=Ri(t);t.readerType==="default"?Re(e,d,o):Pl(e,d,o)}function Ri(e){let t=e.bytesFilled,o=e.elementSize;return new e.viewConstructor(e.buffer,e.byteOffset,t/o)}function Vr(e,t,o,d){e._queue.push({buffer:t,byteOffset:o,byteLength:d}),e._queueTotalSize+=d}function vi(e,t,o,d){let h;try{h=gi(t,o,o+d)}catch(S){throw De(e,S),S}Vr(e,h,0,d)}function Ei(e,t){t.bytesFilled>0&&vi(e,t.buffer,t.byteOffset,t.bytesFilled),jt(e)}function Ai(e,t){let o=Math.min(e._queueTotalSize,t.byteLength-t.bytesFilled),d=t.bytesFilled+o,h=o,S=!1,w=d%t.elementSize,E=d-w;E>=t.minimumFill&&(h=E-t.bytesFilled,S=!0);let x=e._queue;for(;h>0;){let B=x.peek(),$=Math.min(h,B.byteLength),j=t.byteOffset+t.bytesFilled;yi(t.buffer,j,B.buffer,B.byteOffset,$),B.byteLength===$?x.shift():(B.byteOffset+=$,B.byteLength-=$),e._queueTotalSize-=$,Ci(e,$,t),h-=$}return S}function Ci(e,t,o){o.bytesFilled+=t}function Pi(e){e._queueTotalSize===0&&e._closeRequested?($r(e),Tr(e._controlledReadableByteStream)):At(e)}function Hn(e){e._byobRequest!==null&&(e._byobRequest._associatedReadableByteStreamController=void 0,e._byobRequest._view=null,e._byobRequest=null)}function Gn(e){for(;e._pendingPullIntos.length>0;){if(e._queueTotalSize===0)return;let t=e._pendingPullIntos.peek();Ai(e,t)&&(jt(e),zn(e._controlledReadableByteStream,t))}}function gl(e){let t=e._controlledReadableByteStream._reader;for(;t._readRequests.length>0;){if(e._queueTotalSize===0)return;let o=t._readRequests.shift();Di(e,o)}}function _l(e,t,o,d){let h=e._controlledReadableByteStream,S=t.constructor,w=yl(S),{byteOffset:E,byteLength:x}=t,B=o*w,$;try{$=Ze(t.buffer)}catch(Z){d._errorSteps(Z);return}let j={buffer:$,bufferByteLength:$.byteLength,byteOffset:E,byteLength:x,bytesFilled:0,minimumFill:B,elementSize:w,viewConstructor:S,readerType:"byob"};if(e._pendingPullIntos.length>0){e._pendingPullIntos.push(j),Fi(h,d);return}if(h._state==="closed"){let Z=new S(j.buffer,j.byteOffset,0);d._closeSteps(Z);return}if(e._queueTotalSize>0){if(Ai(e,j)){let Z=Ri(j);Pi(e),d._chunkSteps(Z);return}if(e._closeRequested){let Z=new TypeError("Insufficient bytes to fill elements in the given buffer");De(e,Z),d._errorSteps(Z);return}}e._pendingPullIntos.push(j),Fi(h,d),At(e)}function Sl(e,t){t.readerType==="none"&&jt(e);let o=e._controlledReadableByteStream;if(Xn(o))for(;qi(o)>0;){let d=jt(e);zn(o,d)}}function wl(e,t,o){if(Ci(e,t,o),o.readerType==="none"){Ei(e,o),Gn(e);return}if(o.bytesFilled<o.minimumFill)return;jt(e);let d=o.bytesFilled%o.elementSize;if(d>0){let h=o.byteOffset+o.bytesFilled;vi(e,o.buffer,h-d,d)}o.bytesFilled-=d,zn(e._controlledReadableByteStream,o),Gn(e)}function Ii(e,t){let o=e._pendingPullIntos.peek();Hn(e),e._controlledReadableByteStream._state==="closed"?Sl(e,o):wl(e,t,o),At(e)}function jt(e){return e._pendingPullIntos.shift()}function Tl(e){let t=e._controlledReadableByteStream;return t._state!=="readable"||e._closeRequested||!e._started?!1:!!(fr(t)&&$t(t)>0||Xn(t)&&qi(t)>0||Bi(e)>0)}function $r(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0}function pr(e){let t=e._controlledReadableByteStream;if(!(e._closeRequested||t._state!=="readable")){if(e._queueTotalSize>0){e._closeRequested=!0;return}if(e._pendingPullIntos.length>0){let o=e._pendingPullIntos.peek();if(o.bytesFilled%o.elementSize!==0){let d=new TypeError("Insufficient bytes to fill elements in the given buffer");throw De(e,d),d}}$r(e),Tr(t)}}function jr(e,t){let o=e._controlledReadableByteStream;if(e._closeRequested||o._state!=="readable")return;let{buffer:d,byteOffset:h,byteLength:S}=t;if(dt(d))throw new TypeError("chunk's buffer is detached and so cannot be enqueued");let w=Ze(d);if(e._pendingPullIntos.length>0){let E=e._pendingPullIntos.peek();if(dt(E.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");Hn(e),E.buffer=Ze(E.buffer),E.readerType==="none"&&Ei(e,E)}if(fr(o))if(gl(e),$t(o)===0)Vr(e,w,h,S);else{e._pendingPullIntos.length>0&&jt(e);let E=new Uint8Array(w,h,S);Re(o,E,!1)}else Xn(o)?(Vr(e,w,h,S),Gn(e)):Vr(e,w,h,S);At(e)}function De(e,t){let o=e._controlledReadableByteStream;o._state==="readable"&&(Ti(e),ft(e),$r(e),io(o,t))}function Di(e,t){let o=e._queue.shift();e._queueTotalSize-=o.byteLength,Pi(e);let d=new Uint8Array(o.buffer,o.byteOffset,o.byteLength);t._chunkSteps(d)}function Yn(e){if(e._byobRequest===null&&e._pendingPullIntos.length>0){let t=e._pendingPullIntos.peek(),o=new Uint8Array(t.buffer,t.byteOffset+t.bytesFilled,t.byteLength-t.bytesFilled),d=Object.create(vt.prototype);vl(d,e,o),e._byobRequest=d}return e._byobRequest}function Bi(e){let t=e._controlledReadableByteStream._state;return t==="errored"?null:t==="closed"?0:e._strategyHWM-e._queueTotalSize}function zr(e,t){let o=e._pendingPullIntos.peek();if(e._controlledReadableByteStream._state==="closed"){if(t!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(t===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(o.bytesFilled+t>o.byteLength)throw new RangeError("bytesWritten out of range")}o.buffer=Ze(o.buffer),Ii(e,t)}function Hr(e,t){let o=e._pendingPullIntos.peek();if(e._controlledReadableByteStream._state==="closed"){if(t.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(t.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(o.byteOffset+o.bytesFilled!==t.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(o.bufferByteLength!==t.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(o.bytesFilled+t.byteLength>o.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");let h=t.byteLength;o.buffer=Ze(t.buffer),Ii(e,h)}function Li(e,t,o,d,h,S,w){t._controlledReadableByteStream=e,t._pullAgain=!1,t._pulling=!1,t._byobRequest=null,t._queue=t._queueTotalSize=void 0,ft(t),t._closeRequested=!1,t._started=!1,t._strategyHWM=S,t._pullAlgorithm=d,t._cancelAlgorithm=h,t._autoAllocateChunkSize=w,t._pendingPullIntos=new U,e._readableStreamController=t;let E=o();P(m(E),()=>(t._started=!0,At(t),null),x=>(De(t,x),null))}function Rl(e,t,o){let d=Object.create(Ke.prototype),h,S,w;t.start!==void 0?h=()=>t.start(d):h=()=>{},t.pull!==void 0?S=()=>t.pull(d):S=()=>m(void 0),t.cancel!==void 0?w=x=>t.cancel(x):w=()=>m(void 0);let E=t.autoAllocateChunkSize;if(E===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");Li(e,d,h,S,w,o,E)}function vl(e,t,o){e._associatedReadableByteStreamController=t,e._view=o}function Qn(e){return new TypeError(`ReadableStreamBYOBRequest.prototype.${e} can only be used on a ReadableStreamBYOBRequest`)}function br(e){return new TypeError(`ReadableByteStreamController.prototype.${e} can only be used on a ReadableByteStreamController`)}function El(e,t){we(e,t);let o=e?.mode;return{mode:o===void 0?void 0:Al(o,`${t} has member 'mode' that`)}}function Al(e,t){if(e=`${e}`,e!=="byob")throw new TypeError(`${t} '${e}' is not a valid enumeration value for ReadableStreamReaderMode`);return e}function Cl(e,t){var o;we(e,t);let d=(o=e?.min)!==null&&o!==void 0?o:1;return{min:se(d,`${t} has member 'min' that`)}}function Oi(e){return new mt(e)}function Fi(e,t){e._reader._readIntoRequests.push(t)}function Pl(e,t,o){let h=e._reader._readIntoRequests.shift();o?h._closeSteps(t):h._chunkSteps(t)}function qi(e){return e._reader._readIntoRequests.length}function Xn(e){let t=e._reader;return!(t===void 0||!Ct(t))}class mt{constructor(t){if(T(t,1,"ReadableStreamBYOBReader"),be(t,"First parameter"),bt(t))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!Et(t._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");C(this,t),this._readIntoRequests=new U}get closed(){return Ct(this)?this._closedPromise:_(Gr("closed"))}cancel(t=void 0){return Ct(this)?this._ownerReadableStream===void 0?_(Y("cancel")):z(this,t):_(Gr("cancel"))}read(t,o={}){if(!Ct(this))return _(Gr("read"));if(!ArrayBuffer.isView(t))return _(new TypeError("view must be an array buffer view"));if(t.byteLength===0)return _(new TypeError("view must have non-zero byteLength"));if(t.buffer.byteLength===0)return _(new TypeError("view's buffer must have non-zero byteLength"));if(dt(t.buffer))return _(new TypeError("view's buffer has been detached"));let d;try{d=Cl(o,"options")}catch(B){return _(B)}let h=d.min;if(h===0)return _(new TypeError("options.min must be greater than 0"));if(bl(t)){if(h>t.byteLength)return _(new RangeError("options.min must be less than or equal to view's byteLength"))}else if(h>t.length)return _(new RangeError("options.min must be less than or equal to view's length"));if(this._ownerReadableStream===void 0)return _(Y("read from"));let S,w,E=b((B,$)=>{S=B,w=$});return ki(this,t,h,{_chunkSteps:B=>S({value:B,done:!1}),_closeSteps:B=>S({value:B,done:!0}),_errorSteps:B=>w(B)}),E}releaseLock(){if(!Ct(this))throw Gr("releaseLock");this._ownerReadableStream!==void 0&&Il(this)}}Object.defineProperties(mt.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),i(mt.prototype.cancel,"cancel"),i(mt.prototype.read,"read"),i(mt.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(mt.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function Ct(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_readIntoRequests")?!1:e instanceof mt}function ki(e,t,o,d){let h=e._ownerReadableStream;h._disturbed=!0,h._state==="errored"?d._errorSteps(h._storedError):_l(h._readableStreamController,t,o,d)}function Il(e){X(e);let t=new TypeError("Reader was released");Ni(e,t)}function Ni(e,t){let o=e._readIntoRequests;e._readIntoRequests=new U,o.forEach(d=>{d._errorSteps(t)})}function Gr(e){return new TypeError(`ReadableStreamBYOBReader.prototype.${e} can only be used on a ReadableStreamBYOBReader`)}function yr(e,t){let{highWaterMark:o}=e;if(o===void 0)return t;if(bi(o)||o<0)throw new RangeError("Invalid highWaterMark");return o}function Yr(e){let{size:t}=e;return t||(()=>1)}function Qr(e,t){we(e,t);let o=e?.highWaterMark,d=e?.size;return{highWaterMark:o===void 0?void 0:G(o),size:d===void 0?void 0:Dl(d,`${t} has member 'size' that`)}}function Dl(e,t){return pe(e,t),o=>G(e(o))}function Bl(e,t){we(e,t);let o=e?.abort,d=e?.close,h=e?.start,S=e?.type,w=e?.write;return{abort:o===void 0?void 0:Ll(o,e,`${t} has member 'abort' that`),close:d===void 0?void 0:Ol(d,e,`${t} has member 'close' that`),start:h===void 0?void 0:Fl(h,e,`${t} has member 'start' that`),write:w===void 0?void 0:ql(w,e,`${t} has member 'write' that`),type:S}}function Ll(e,t,o){return pe(e,o),d=>L(e,t,[d])}function Ol(e,t,o){return pe(e,o),()=>L(e,t,[])}function Fl(e,t,o){return pe(e,o),d=>I(e,t,[d])}function ql(e,t,o){return pe(e,o),(d,h)=>L(e,t,[d,h])}function Mi(e,t){if(!zt(e))throw new TypeError(`${t} is not a WritableStream.`)}function kl(e){if(typeof e!="object"||e===null)return!1;try{return typeof e.aborted=="boolean"}catch{return!1}}let Nl=typeof AbortController=="function";function Ml(){if(Nl)return new AbortController}class ht{constructor(t={},o={}){t===void 0?t=null:l(t,"First parameter");let d=Qr(o,"Second parameter"),h=Bl(t,"First parameter");if(Wi(this),h.type!==void 0)throw new RangeError("Invalid type is specified");let w=Yr(d),E=yr(d,1);Kl(this,h,E,w)}get locked(){if(!zt(this))throw en("locked");return Ht(this)}abort(t=void 0){return zt(this)?Ht(this)?_(new TypeError("Cannot abort a stream that already has a writer")):Xr(this,t):_(en("abort"))}close(){return zt(this)?Ht(this)?_(new TypeError("Cannot close a stream that already has a writer")):ze(this)?_(new TypeError("Cannot close an already-closing stream")):Ui(this):_(en("close"))}getWriter(){if(!zt(this))throw en("getWriter");return xi(this)}}Object.defineProperties(ht.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),i(ht.prototype.abort,"abort"),i(ht.prototype.close,"close"),i(ht.prototype.getWriter,"getWriter"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ht.prototype,Symbol.toStringTag,{value:"WritableStream",configurable:!0});function xi(e){return new Je(e)}function xl(e,t,o,d,h=1,S=()=>1){let w=Object.create(ht.prototype);Wi(w);let E=Object.create(Gt.prototype);return Gi(w,E,e,t,o,d,h,S),w}function Wi(e){e._state="writable",e._storedError=void 0,e._writer=void 0,e._writableStreamController=void 0,e._writeRequests=new U,e._inFlightWriteRequest=void 0,e._closeRequest=void 0,e._inFlightCloseRequest=void 0,e._pendingAbortRequest=void 0,e._backpressure=!1}function zt(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_writableStreamController")?!1:e instanceof ht}function Ht(e){return e._writer!==void 0}function Xr(e,t){var o;if(e._state==="closed"||e._state==="errored")return m(void 0);e._writableStreamController._abortReason=t,(o=e._writableStreamController._abortController)===null||o===void 0||o.abort(t);let d=e._state;if(d==="closed"||d==="errored")return m(void 0);if(e._pendingAbortRequest!==void 0)return e._pendingAbortRequest._promise;let h=!1;d==="erroring"&&(h=!0,t=void 0);let S=b((w,E)=>{e._pendingAbortRequest={_promise:void 0,_resolve:w,_reject:E,_reason:t,_wasAlreadyErroring:h}});return e._pendingAbortRequest._promise=S,h||Kn(e,t),S}function Ui(e){let t=e._state;if(t==="closed"||t==="errored")return _(new TypeError(`The stream (in ${t} state) is not in the writable state and cannot be closed`));let o=b((h,S)=>{let w={_resolve:h,_reject:S};e._closeRequest=w}),d=e._writer;return d!==void 0&&e._backpressure&&t==="writable"&&oa(d),Jl(e._writableStreamController),o}function Wl(e){return b((o,d)=>{let h={_resolve:o,_reject:d};e._writeRequests.push(h)})}function Zn(e,t){if(e._state==="writable"){Kn(e,t);return}Jn(e)}function Kn(e,t){let o=e._writableStreamController;e._state="erroring",e._storedError=t;let d=e._writer;d!==void 0&&$i(d,t),!zl(e)&&o._started&&Jn(e)}function Jn(e){e._state="errored",e._writableStreamController[Q]();let t=e._storedError;if(e._writeRequests.forEach(h=>{h._reject(t)}),e._writeRequests=new U,e._pendingAbortRequest===void 0){Zr(e);return}let o=e._pendingAbortRequest;if(e._pendingAbortRequest=void 0,o._wasAlreadyErroring){o._reject(t),Zr(e);return}let d=e._writableStreamController[V](o._reason);P(d,()=>(o._resolve(),Zr(e),null),h=>(o._reject(h),Zr(e),null))}function Ul(e){e._inFlightWriteRequest._resolve(void 0),e._inFlightWriteRequest=void 0}function Vl(e,t){e._inFlightWriteRequest._reject(t),e._inFlightWriteRequest=void 0,Zn(e,t)}function $l(e){e._inFlightCloseRequest._resolve(void 0),e._inFlightCloseRequest=void 0,e._state==="erroring"&&(e._storedError=void 0,e._pendingAbortRequest!==void 0&&(e._pendingAbortRequest._resolve(),e._pendingAbortRequest=void 0)),e._state="closed";let o=e._writer;o!==void 0&&Zi(o)}function jl(e,t){e._inFlightCloseRequest._reject(t),e._inFlightCloseRequest=void 0,e._pendingAbortRequest!==void 0&&(e._pendingAbortRequest._reject(t),e._pendingAbortRequest=void 0),Zn(e,t)}function ze(e){return!(e._closeRequest===void 0&&e._inFlightCloseRequest===void 0)}function zl(e){return!(e._inFlightWriteRequest===void 0&&e._inFlightCloseRequest===void 0)}function Hl(e){e._inFlightCloseRequest=e._closeRequest,e._closeRequest=void 0}function Gl(e){e._inFlightWriteRequest=e._writeRequests.shift()}function Zr(e){e._closeRequest!==void 0&&(e._closeRequest._reject(e._storedError),e._closeRequest=void 0);let t=e._writer;t!==void 0&&aa(t,e._storedError)}function ea(e,t){let o=e._writer;o!==void 0&&t!==e._backpressure&&(t?ou(o):oa(o)),e._backpressure=t}class Je{constructor(t){if(T(t,1,"WritableStreamDefaultWriter"),Mi(t,"First parameter"),Ht(t))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=t,t._writer=this;let o=t._state;if(o==="writable")!ze(t)&&t._backpressure?rn(this):Ki(this),tn(this);else if(o==="erroring")ia(this,t._storedError),tn(this);else if(o==="closed")Ki(this),au(this);else{let d=t._storedError;ia(this,d),Xi(this,d)}}get closed(){return Pt(this)?this._closedPromise:_(It("closed"))}get desiredSize(){if(!Pt(this))throw It("desiredSize");if(this._ownerWritableStream===void 0)throw _r("desiredSize");return Zl(this)}get ready(){return Pt(this)?this._readyPromise:_(It("ready"))}abort(t=void 0){return Pt(this)?this._ownerWritableStream===void 0?_(_r("abort")):Yl(this,t):_(It("abort"))}close(){if(!Pt(this))return _(It("close"));let t=this._ownerWritableStream;return t===void 0?_(_r("close")):ze(t)?_(new TypeError("Cannot close an already-closing stream")):Vi(this)}releaseLock(){if(!Pt(this))throw It("releaseLock");this._ownerWritableStream!==void 0&&ji(this)}write(t=void 0){return Pt(this)?this._ownerWritableStream===void 0?_(_r("write to")):zi(this,t):_(It("write"))}}Object.defineProperties(Je.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),i(Je.prototype.abort,"abort"),i(Je.prototype.close,"close"),i(Je.prototype.releaseLock,"releaseLock"),i(Je.prototype.write,"write"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Je.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function Pt(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_ownerWritableStream")?!1:e instanceof Je}function Yl(e,t){let o=e._ownerWritableStream;return Xr(o,t)}function Vi(e){let t=e._ownerWritableStream;return Ui(t)}function Ql(e){let t=e._ownerWritableStream,o=t._state;return ze(t)||o==="closed"?m(void 0):o==="errored"?_(t._storedError):Vi(e)}function Xl(e,t){e._closedPromiseState==="pending"?aa(e,t):iu(e,t)}function $i(e,t){e._readyPromiseState==="pending"?Ji(e,t):su(e,t)}function Zl(e){let t=e._ownerWritableStream,o=t._state;return o==="errored"||o==="erroring"?null:o==="closed"?0:Yi(t._writableStreamController)}function ji(e){let t=e._ownerWritableStream,o=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");$i(e,o),Xl(e,o),t._writer=void 0,e._ownerWritableStream=void 0}function zi(e,t){let o=e._ownerWritableStream,d=o._writableStreamController,h=eu(d,t);if(o!==e._ownerWritableStream)return _(_r("write to"));let S=o._state;if(S==="errored")return _(o._storedError);if(ze(o)||S==="closed")return _(new TypeError("The stream is closing or closed and cannot be written to"));if(S==="erroring")return _(o._storedError);let w=Wl(o);return tu(d,t,h),w}let Hi={};class Gt{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!ta(this))throw na("abortReason");return this._abortReason}get signal(){if(!ta(this))throw na("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(t=void 0){if(!ta(this))throw na("error");this._controlledWritableStream._state==="writable"&&Qi(this,t)}[V](t){let o=this._abortAlgorithm(t);return Kr(this),o}[Q](){ft(this)}}Object.defineProperties(Gt.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Gt.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function ta(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledWritableStream")?!1:e instanceof Gt}function Gi(e,t,o,d,h,S,w,E){t._controlledWritableStream=e,e._writableStreamController=t,t._queue=void 0,t._queueTotalSize=void 0,ft(t),t._abortReason=void 0,t._abortController=Ml(),t._started=!1,t._strategySizeAlgorithm=E,t._strategyHWM=w,t._writeAlgorithm=d,t._closeAlgorithm=h,t._abortAlgorithm=S;let x=ra(t);ea(e,x);let B=o(),$=m(B);P($,()=>(t._started=!0,Jr(t),null),j=>(t._started=!0,Zn(e,j),null))}function Kl(e,t,o,d){let h=Object.create(Gt.prototype),S,w,E,x;t.start!==void 0?S=()=>t.start(h):S=()=>{},t.write!==void 0?w=B=>t.write(B,h):w=()=>m(void 0),t.close!==void 0?E=()=>t.close():E=()=>m(void 0),t.abort!==void 0?x=B=>t.abort(B):x=()=>m(void 0),Gi(e,h,S,w,E,x,o,d)}function Kr(e){e._writeAlgorithm=void 0,e._closeAlgorithm=void 0,e._abortAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function Jl(e){$n(e,Hi,0),Jr(e)}function eu(e,t){try{return e._strategySizeAlgorithm(t)}catch(o){return gr(e,o),1}}function Yi(e){return e._strategyHWM-e._queueTotalSize}function tu(e,t,o){try{$n(e,t,o)}catch(h){gr(e,h);return}let d=e._controlledWritableStream;if(!ze(d)&&d._state==="writable"){let h=ra(e);ea(d,h)}Jr(e)}function Jr(e){let t=e._controlledWritableStream;if(!e._started||t._inFlightWriteRequest!==void 0)return;if(t._state==="erroring"){Jn(t);return}if(e._queue.length===0)return;let d=pl(e);d===Hi?ru(e):nu(e,d)}function gr(e,t){e._controlledWritableStream._state==="writable"&&Qi(e,t)}function ru(e){let t=e._controlledWritableStream;Hl(t),Vn(e);let o=e._closeAlgorithm();Kr(e),P(o,()=>($l(t),null),d=>(jl(t,d),null))}function nu(e,t){let o=e._controlledWritableStream;Gl(o);let d=e._writeAlgorithm(t);P(d,()=>{Ul(o);let h=o._state;if(Vn(e),!ze(o)&&h==="writable"){let S=ra(e);ea(o,S)}return Jr(e),null},h=>(o._state==="writable"&&Kr(e),Vl(o,h),null))}function ra(e){return Yi(e)<=0}function Qi(e,t){let o=e._controlledWritableStream;Kr(e),Kn(o,t)}function en(e){return new TypeError(`WritableStream.prototype.${e} can only be used on a WritableStream`)}function na(e){return new TypeError(`WritableStreamDefaultController.prototype.${e} can only be used on a WritableStreamDefaultController`)}function It(e){return new TypeError(`WritableStreamDefaultWriter.prototype.${e} can only be used on a WritableStreamDefaultWriter`)}function _r(e){return new TypeError("Cannot "+e+" a stream using a released writer")}function tn(e){e._closedPromise=b((t,o)=>{e._closedPromise_resolve=t,e._closedPromise_reject=o,e._closedPromiseState="pending"})}function Xi(e,t){tn(e),aa(e,t)}function au(e){tn(e),Zi(e)}function aa(e,t){e._closedPromise_reject!==void 0&&(O(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="rejected")}function iu(e,t){Xi(e,t)}function Zi(e){e._closedPromise_resolve!==void 0&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="resolved")}function rn(e){e._readyPromise=b((t,o)=>{e._readyPromise_resolve=t,e._readyPromise_reject=o}),e._readyPromiseState="pending"}function ia(e,t){rn(e),Ji(e,t)}function Ki(e){rn(e),oa(e)}function Ji(e,t){e._readyPromise_reject!==void 0&&(O(e._readyPromise),e._readyPromise_reject(t),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="rejected")}function ou(e){rn(e)}function su(e,t){ia(e,t)}function oa(e){e._readyPromise_resolve!==void 0&&(e._readyPromise_resolve(void 0),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="fulfilled")}function lu(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof global<"u")return global}let sa=lu();function uu(e){if(!(typeof e=="function"||typeof e=="object")||e.name!=="DOMException")return!1;try{return new e,!0}catch{return!1}}function cu(){let e=sa?.DOMException;return uu(e)?e:void 0}function du(){let e=function(o,d){this.message=o||"",this.name=d||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return i(e,"DOMException"),e.prototype=Object.create(Error.prototype),Object.defineProperty(e.prototype,"constructor",{value:e,writable:!0,configurable:!0}),e}let fu=cu()||du();function eo(e,t,o,d,h,S){let w=Te(e),E=xi(t);e._disturbed=!0;let x=!1,B=m(void 0);return b(($,j)=>{let Z;if(S!==void 0){if(Z=()=>{let k=S.reason!==void 0?S.reason:new fu("Aborted","AbortError"),H=[];d||H.push(()=>t._state==="writable"?Xr(t,k):m(void 0)),h||H.push(()=>e._state==="readable"?Me(e,k):m(void 0)),ye(()=>Promise.all(H.map(K=>K())),!0,k)},S.aborted){Z();return}S.addEventListener("abort",Z)}function xe(){return b((k,H)=>{function K(ve){ve?k():v(Zt(),K,H)}K(!1)})}function Zt(){return x?m(!0):v(E._readyPromise,()=>b((k,H)=>{mr(w,{_chunkSteps:K=>{B=v(zi(E,K),void 0,n),k(!1)},_closeSteps:()=>k(!0),_errorSteps:H})}))}if(tt(e,w._closedPromise,k=>(d?Be(!0,k):ye(()=>Xr(t,k),!0,k),null)),tt(t,E._closedPromise,k=>(h?Be(!0,k):ye(()=>Me(e,k),!0,k),null)),fe(e,w._closedPromise,()=>(o?Be():ye(()=>Ql(E)),null)),ze(t)||t._state==="closed"){let k=new TypeError("the destination writable stream closed before all data could be piped to it");h?Be(!0,k):ye(()=>Me(e,k),!0,k)}O(xe());function gt(){let k=B;return v(B,()=>k!==B?gt():void 0)}function tt(k,H,K){k._state==="errored"?K(k._storedError):R(H,K)}function fe(k,H,K){k._state==="closed"?K():A(H,K)}function ye(k,H,K){if(x)return;x=!0,t._state==="writable"&&!ze(t)?A(gt(),ve):ve();function ve(){return P(k(),()=>rt(H,K),Kt=>rt(!0,Kt)),null}}function Be(k,H){x||(x=!0,t._state==="writable"&&!ze(t)?A(gt(),()=>rt(k,H)):rt(k,H))}function rt(k,H){return ji(E),X(w),S!==void 0&&S.removeEventListener("abort",Z),k?j(H):$(void 0),null}})}class et{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!nn(this))throw on("desiredSize");return la(this)}close(){if(!nn(this))throw on("close");if(!Qt(this))throw new TypeError("The stream is not in a state that permits close");Dt(this)}enqueue(t=void 0){if(!nn(this))throw on("enqueue");if(!Qt(this))throw new TypeError("The stream is not in a state that permits enqueue");return Yt(this,t)}error(t=void 0){if(!nn(this))throw on("error");Ne(this,t)}[g](t){ft(this);let o=this._cancelAlgorithm(t);return an(this),o}[de](t){let o=this._controlledReadableStream;if(this._queue.length>0){let d=Vn(this);this._closeRequested&&this._queue.length===0?(an(this),Tr(o)):Sr(this),t._chunkSteps(d)}else ae(o,t),Sr(this)}[F](){}}Object.defineProperties(et.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),i(et.prototype.close,"close"),i(et.prototype.enqueue,"enqueue"),i(et.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(et.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function nn(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledReadableStream")?!1:e instanceof et}function Sr(e){if(!to(e))return;if(e._pulling){e._pullAgain=!0;return}e._pulling=!0;let o=e._pullAlgorithm();P(o,()=>(e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,Sr(e)),null),d=>(Ne(e,d),null))}function to(e){let t=e._controlledReadableStream;return!Qt(e)||!e._started?!1:!!(bt(t)&&$t(t)>0||la(e)>0)}function an(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function Dt(e){if(!Qt(e))return;let t=e._controlledReadableStream;e._closeRequested=!0,e._queue.length===0&&(an(e),Tr(t))}function Yt(e,t){if(!Qt(e))return;let o=e._controlledReadableStream;if(bt(o)&&$t(o)>0)Re(o,t,!1);else{let d;try{d=e._strategySizeAlgorithm(t)}catch(h){throw Ne(e,h),h}try{$n(e,t,d)}catch(h){throw Ne(e,h),h}}Sr(e)}function Ne(e,t){let o=e._controlledReadableStream;o._state==="readable"&&(ft(e),an(e),io(o,t))}function la(e){let t=e._controlledReadableStream._state;return t==="errored"?null:t==="closed"?0:e._strategyHWM-e._queueTotalSize}function mu(e){return!to(e)}function Qt(e){let t=e._controlledReadableStream._state;return!e._closeRequested&&t==="readable"}function ro(e,t,o,d,h,S,w){t._controlledReadableStream=e,t._queue=void 0,t._queueTotalSize=void 0,ft(t),t._started=!1,t._closeRequested=!1,t._pullAgain=!1,t._pulling=!1,t._strategySizeAlgorithm=w,t._strategyHWM=S,t._pullAlgorithm=d,t._cancelAlgorithm=h,e._readableStreamController=t;let E=o();P(m(E),()=>(t._started=!0,Sr(t),null),x=>(Ne(t,x),null))}function hu(e,t,o,d){let h=Object.create(et.prototype),S,w,E;t.start!==void 0?S=()=>t.start(h):S=()=>{},t.pull!==void 0?w=()=>t.pull(h):w=()=>m(void 0),t.cancel!==void 0?E=x=>t.cancel(x):E=()=>m(void 0),ro(e,h,S,w,E,o,d)}function on(e){return new TypeError(`ReadableStreamDefaultController.prototype.${e} can only be used on a ReadableStreamDefaultController`)}function pu(e,t){return Et(e._readableStreamController)?yu(e):bu(e)}function bu(e,t){let o=Te(e),d=!1,h=!1,S=!1,w=!1,E,x,B,$,j,Z=b(fe=>{j=fe});function xe(){return d?(h=!0,m(void 0)):(d=!0,mr(o,{_chunkSteps:ye=>{W(()=>{h=!1;let Be=ye,rt=ye;S||Yt(B._readableStreamController,Be),w||Yt($._readableStreamController,rt),d=!1,h&&xe()})},_closeSteps:()=>{d=!1,S||Dt(B._readableStreamController),w||Dt($._readableStreamController),(!S||!w)&&j(void 0)},_errorSteps:()=>{d=!1}}),m(void 0))}function Zt(fe){if(S=!0,E=fe,w){let ye=hr([E,x]),Be=Me(e,ye);j(Be)}return Z}function gt(fe){if(w=!0,x=fe,S){let ye=hr([E,x]),Be=Me(e,ye);j(Be)}return Z}function tt(){}return B=wr(tt,xe,Zt),$=wr(tt,xe,gt),R(o._closedPromise,fe=>(Ne(B._readableStreamController,fe),Ne($._readableStreamController,fe),(!S||!w)&&j(void 0),null)),[B,$]}function yu(e){let t=Te(e),o=!1,d=!1,h=!1,S=!1,w=!1,E,x,B,$,j,Z=b(k=>{j=k});function xe(k){R(k._closedPromise,H=>(k!==t||(De(B._readableStreamController,H),De($._readableStreamController,H),(!S||!w)&&j(void 0)),null))}function Zt(){Ct(t)&&(X(t),t=Te(e),xe(t)),mr(t,{_chunkSteps:H=>{W(()=>{d=!1,h=!1;let K=H,ve=H;if(!S&&!w)try{ve=Si(H)}catch(Kt){De(B._readableStreamController,Kt),De($._readableStreamController,Kt),j(Me(e,Kt));return}S||jr(B._readableStreamController,K),w||jr($._readableStreamController,ve),o=!1,d?tt():h&&fe()})},_closeSteps:()=>{o=!1,S||pr(B._readableStreamController),w||pr($._readableStreamController),B._readableStreamController._pendingPullIntos.length>0&&zr(B._readableStreamController,0),$._readableStreamController._pendingPullIntos.length>0&&zr($._readableStreamController,0),(!S||!w)&&j(void 0)},_errorSteps:()=>{o=!1}})}function gt(k,H){ke(t)&&(X(t),t=Oi(e),xe(t));let K=H?$:B,ve=H?B:$;ki(t,k,1,{_chunkSteps:Jt=>{W(()=>{d=!1,h=!1;let er=H?w:S;if(H?S:w)er||Hr(K._readableStreamController,Jt);else{let _o;try{_o=Si(Jt)}catch(ma){De(K._readableStreamController,ma),De(ve._readableStreamController,ma),j(Me(e,ma));return}er||Hr(K._readableStreamController,Jt),jr(ve._readableStreamController,_o)}o=!1,d?tt():h&&fe()})},_closeSteps:Jt=>{o=!1;let er=H?w:S,hn=H?S:w;er||pr(K._readableStreamController),hn||pr(ve._readableStreamController),Jt!==void 0&&(er||Hr(K._readableStreamController,Jt),!hn&&ve._readableStreamController._pendingPullIntos.length>0&&zr(ve._readableStreamController,0)),(!er||!hn)&&j(void 0)},_errorSteps:()=>{o=!1}})}function tt(){if(o)return d=!0,m(void 0);o=!0;let k=Yn(B._readableStreamController);return k===null?Zt():gt(k._view,!1),m(void 0)}function fe(){if(o)return h=!0,m(void 0);o=!0;let k=Yn($._readableStreamController);return k===null?Zt():gt(k._view,!0),m(void 0)}function ye(k){if(S=!0,E=k,w){let H=hr([E,x]),K=Me(e,H);j(K)}return Z}function Be(k){if(w=!0,x=k,S){let H=hr([E,x]),K=Me(e,H);j(K)}return Z}function rt(){}return B=ao(rt,tt,ye),$=ao(rt,fe,Be),xe(t),[B,$]}function gu(e){return a(e)&&typeof e.getReader<"u"}function _u(e){return gu(e)?wu(e.getReader()):Su(e)}function Su(e){let t,o=_i(e,"async"),d=n;function h(){let w;try{w=dl(o)}catch(x){return _(x)}let E=m(w);return N(E,x=>{if(!a(x))throw new TypeError("The promise returned by the iterator.next() method must fulfill with an object");if(fl(x))Dt(t._readableStreamController);else{let $=ml(x);Yt(t._readableStreamController,$)}})}function S(w){let E=o.iterator,x;try{x=Ur(E,"return")}catch(j){return _(j)}if(x===void 0)return m(void 0);let B;try{B=I(x,E,[w])}catch(j){return _(j)}let $=m(B);return N($,j=>{if(!a(j))throw new TypeError("The promise returned by the iterator.return() method must fulfill with an object")})}return t=wr(d,h,S,0),t}function wu(e){let t,o=n;function d(){let S;try{S=e.read()}catch(w){return _(w)}return N(S,w=>{if(!a(w))throw new TypeError("The promise returned by the reader.read() method must fulfill with an object");if(w.done)Dt(t._readableStreamController);else{let E=w.value;Yt(t._readableStreamController,E)}})}function h(S){try{return m(e.cancel(S))}catch(w){return _(w)}}return t=wr(o,d,h,0),t}function Tu(e,t){we(e,t);let o=e,d=o?.autoAllocateChunkSize,h=o?.cancel,S=o?.pull,w=o?.start,E=o?.type;return{autoAllocateChunkSize:d===void 0?void 0:se(d,`${t} has member 'autoAllocateChunkSize' that`),cancel:h===void 0?void 0:Ru(h,o,`${t} has member 'cancel' that`),pull:S===void 0?void 0:vu(S,o,`${t} has member 'pull' that`),start:w===void 0?void 0:Eu(w,o,`${t} has member 'start' that`),type:E===void 0?void 0:Au(E,`${t} has member 'type' that`)}}function Ru(e,t,o){return pe(e,o),d=>L(e,t,[d])}function vu(e,t,o){return pe(e,o),d=>L(e,t,[d])}function Eu(e,t,o){return pe(e,o),d=>I(e,t,[d])}function Au(e,t){if(e=`${e}`,e!=="bytes")throw new TypeError(`${t} '${e}' is not a valid enumeration value for ReadableStreamType`);return e}function Cu(e,t){return we(e,t),{preventCancel:!!e?.preventCancel}}function no(e,t){we(e,t);let o=e?.preventAbort,d=e?.preventCancel,h=e?.preventClose,S=e?.signal;return S!==void 0&&Pu(S,`${t} has member 'signal' that`),{preventAbort:!!o,preventCancel:!!d,preventClose:!!h,signal:S}}function Pu(e,t){if(!kl(e))throw new TypeError(`${t} is not an AbortSignal.`)}function Iu(e,t){we(e,t);let o=e?.readable;y(o,"readable","ReadableWritablePair"),be(o,`${t} has member 'readable' that`);let d=e?.writable;return y(d,"writable","ReadableWritablePair"),Mi(d,`${t} has member 'writable' that`),{readable:o,writable:d}}class ce{constructor(t={},o={}){t===void 0?t=null:l(t,"First parameter");let d=Qr(o,"Second parameter"),h=Tu(t,"First parameter");if(ua(this),h.type==="bytes"){if(d.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");let S=yr(d,0);Rl(this,h,S)}else{let S=Yr(d),w=yr(d,1);hu(this,h,w,S)}}get locked(){if(!pt(this))throw Bt("locked");return bt(this)}cancel(t=void 0){return pt(this)?bt(this)?_(new TypeError("Cannot cancel a stream that already has a reader")):Me(this,t):_(Bt("cancel"))}getReader(t=void 0){if(!pt(this))throw Bt("getReader");return El(t,"First parameter").mode===void 0?Te(this):Oi(this)}pipeThrough(t,o={}){if(!pt(this))throw Bt("pipeThrough");T(t,1,"pipeThrough");let d=Iu(t,"First parameter"),h=no(o,"Second parameter");if(bt(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(Ht(d.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");let S=eo(this,d.writable,h.preventClose,h.preventAbort,h.preventCancel,h.signal);return O(S),d.readable}pipeTo(t,o={}){if(!pt(this))return _(Bt("pipeTo"));if(t===void 0)return _("Parameter 1 is required in 'pipeTo'.");if(!zt(t))return _(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let d;try{d=no(o,"Second parameter")}catch(h){return _(h)}return bt(this)?_(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):Ht(t)?_(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):eo(this,t,d.preventClose,d.preventAbort,d.preventCancel,d.signal)}tee(){if(!pt(this))throw Bt("tee");let t=pu(this);return hr(t)}values(t=void 0){if(!pt(this))throw Bt("values");let o=Cu(t,"First parameter");return ul(this,o.preventCancel)}[Un](t){return this.values(t)}static from(t){return _u(t)}}Object.defineProperties(ce,{from:{enumerable:!0}}),Object.defineProperties(ce.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),i(ce.from,"from"),i(ce.prototype.cancel,"cancel"),i(ce.prototype.getReader,"getReader"),i(ce.prototype.pipeThrough,"pipeThrough"),i(ce.prototype.pipeTo,"pipeTo"),i(ce.prototype.tee,"tee"),i(ce.prototype.values,"values"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ce.prototype,Symbol.toStringTag,{value:"ReadableStream",configurable:!0}),Object.defineProperty(ce.prototype,Un,{value:ce.prototype.values,writable:!0,configurable:!0});function wr(e,t,o,d=1,h=()=>1){let S=Object.create(ce.prototype);ua(S);let w=Object.create(et.prototype);return ro(S,w,e,t,o,d,h),S}function ao(e,t,o){let d=Object.create(ce.prototype);ua(d);let h=Object.create(Ke.prototype);return Li(d,h,e,t,o,0,void 0),d}function ua(e){e._state="readable",e._reader=void 0,e._storedError=void 0,e._disturbed=!1}function pt(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_readableStreamController")?!1:e instanceof ce}function bt(e){return e._reader!==void 0}function Me(e,t){if(e._disturbed=!0,e._state==="closed")return m(void 0);if(e._state==="errored")return _(e._storedError);Tr(e);let o=e._reader;if(o!==void 0&&Ct(o)){let h=o._readIntoRequests;o._readIntoRequests=new U,h.forEach(S=>{S._closeSteps(void 0)})}let d=e._readableStreamController[g](t);return N(d,n)}function Tr(e){e._state="closed";let t=e._reader;if(t!==void 0&&(je(t),ke(t))){let o=t._readRequests;t._readRequests=new U,o.forEach(d=>{d._closeSteps()})}}function io(e,t){e._state="errored",e._storedError=t;let o=e._reader;o!==void 0&&(re(o,t),ke(o)?di(o,t):Ni(o,t))}function Bt(e){return new TypeError(`ReadableStream.prototype.${e} can only be used on a ReadableStream`)}function oo(e,t){we(e,t);let o=e?.highWaterMark;return y(o,"highWaterMark","QueuingStrategyInit"),{highWaterMark:G(o)}}let so=e=>e.byteLength;i(so,"size");class sn{constructor(t){T(t,1,"ByteLengthQueuingStrategy"),t=oo(t,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=t.highWaterMark}get highWaterMark(){if(!uo(this))throw lo("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!uo(this))throw lo("size");return so}}Object.defineProperties(sn.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(sn.prototype,Symbol.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function lo(e){return new TypeError(`ByteLengthQueuingStrategy.prototype.${e} can only be used on a ByteLengthQueuingStrategy`)}function uo(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_byteLengthQueuingStrategyHighWaterMark")?!1:e instanceof sn}let co=()=>1;i(co,"size");class ln{constructor(t){T(t,1,"CountQueuingStrategy"),t=oo(t,"First parameter"),this._countQueuingStrategyHighWaterMark=t.highWaterMark}get highWaterMark(){if(!mo(this))throw fo("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!mo(this))throw fo("size");return co}}Object.defineProperties(ln.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ln.prototype,Symbol.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function fo(e){return new TypeError(`CountQueuingStrategy.prototype.${e} can only be used on a CountQueuingStrategy`)}function mo(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_countQueuingStrategyHighWaterMark")?!1:e instanceof ln}function Du(e,t){we(e,t);let o=e?.cancel,d=e?.flush,h=e?.readableType,S=e?.start,w=e?.transform,E=e?.writableType;return{cancel:o===void 0?void 0:Fu(o,e,`${t} has member 'cancel' that`),flush:d===void 0?void 0:Bu(d,e,`${t} has member 'flush' that`),readableType:h,start:S===void 0?void 0:Lu(S,e,`${t} has member 'start' that`),transform:w===void 0?void 0:Ou(w,e,`${t} has member 'transform' that`),writableType:E}}function Bu(e,t,o){return pe(e,o),d=>L(e,t,[d])}function Lu(e,t,o){return pe(e,o),d=>I(e,t,[d])}function Ou(e,t,o){return pe(e,o),(d,h)=>L(e,t,[d,h])}function Fu(e,t,o){return pe(e,o),d=>L(e,t,[d])}class un{constructor(t={},o={},d={}){t===void 0&&(t=null);let h=Qr(o,"Second parameter"),S=Qr(d,"Third parameter"),w=Du(t,"First parameter");if(w.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(w.writableType!==void 0)throw new RangeError("Invalid writableType specified");let E=yr(S,0),x=Yr(S),B=yr(h,1),$=Yr(h),j,Z=b(xe=>{j=xe});qu(this,Z,B,$,E,x),Nu(this,w),w.start!==void 0?j(w.start(this._transformStreamController)):j(void 0)}get readable(){if(!ho(this))throw go("readable");return this._readable}get writable(){if(!ho(this))throw go("writable");return this._writable}}Object.defineProperties(un.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(un.prototype,Symbol.toStringTag,{value:"TransformStream",configurable:!0});function qu(e,t,o,d,h,S){function w(){return t}function E(Z){return Wu(e,Z)}function x(Z){return Uu(e,Z)}function B(){return Vu(e)}e._writable=xl(w,E,B,x,o,d);function $(){return $u(e)}function j(Z){return ju(e,Z)}e._readable=wr(w,$,j,h,S),e._backpressure=void 0,e._backpressureChangePromise=void 0,e._backpressureChangePromise_resolve=void 0,cn(e,!0),e._transformStreamController=void 0}function ho(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_transformStreamController")?!1:e instanceof un}function po(e,t){Ne(e._readable._readableStreamController,t),ca(e,t)}function ca(e,t){fn(e._transformStreamController),gr(e._writable._writableStreamController,t),da(e)}function da(e){e._backpressure&&cn(e,!1)}function cn(e,t){e._backpressureChangePromise!==void 0&&e._backpressureChangePromise_resolve(),e._backpressureChangePromise=b(o=>{e._backpressureChangePromise_resolve=o}),e._backpressure=t}class yt{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!dn(this))throw mn("desiredSize");let t=this._controlledTransformStream._readable._readableStreamController;return la(t)}enqueue(t=void 0){if(!dn(this))throw mn("enqueue");bo(this,t)}error(t=void 0){if(!dn(this))throw mn("error");Mu(this,t)}terminate(){if(!dn(this))throw mn("terminate");xu(this)}}Object.defineProperties(yt.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),i(yt.prototype.enqueue,"enqueue"),i(yt.prototype.error,"error"),i(yt.prototype.terminate,"terminate"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(yt.prototype,Symbol.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function dn(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledTransformStream")?!1:e instanceof yt}function ku(e,t,o,d,h){t._controlledTransformStream=e,e._transformStreamController=t,t._transformAlgorithm=o,t._flushAlgorithm=d,t._cancelAlgorithm=h,t._finishPromise=void 0,t._finishPromise_resolve=void 0,t._finishPromise_reject=void 0}function Nu(e,t){let o=Object.create(yt.prototype),d,h,S;t.transform!==void 0?d=w=>t.transform(w,o):d=w=>{try{return bo(o,w),m(void 0)}catch(E){return _(E)}},t.flush!==void 0?h=()=>t.flush(o):h=()=>m(void 0),t.cancel!==void 0?S=w=>t.cancel(w):S=()=>m(void 0),ku(e,o,d,h,S)}function fn(e){e._transformAlgorithm=void 0,e._flushAlgorithm=void 0,e._cancelAlgorithm=void 0}function bo(e,t){let o=e._controlledTransformStream,d=o._readable._readableStreamController;if(!Qt(d))throw new TypeError("Readable side is not in a state that permits enqueue");try{Yt(d,t)}catch(S){throw ca(o,S),o._readable._storedError}mu(d)!==o._backpressure&&cn(o,!0)}function Mu(e,t){po(e._controlledTransformStream,t)}function yo(e,t){let o=e._transformAlgorithm(t);return N(o,void 0,d=>{throw po(e._controlledTransformStream,d),d})}function xu(e){let t=e._controlledTransformStream,o=t._readable._readableStreamController;Dt(o);let d=new TypeError("TransformStream terminated");ca(t,d)}function Wu(e,t){let o=e._transformStreamController;if(e._backpressure){let d=e._backpressureChangePromise;return N(d,()=>{let h=e._writable;if(h._state==="erroring")throw h._storedError;return yo(o,t)})}return yo(o,t)}function Uu(e,t){let o=e._transformStreamController;if(o._finishPromise!==void 0)return o._finishPromise;let d=e._readable;o._finishPromise=b((S,w)=>{o._finishPromise_resolve=S,o._finishPromise_reject=w});let h=o._cancelAlgorithm(t);return fn(o),P(h,()=>(d._state==="errored"?Xt(o,d._storedError):(Ne(d._readableStreamController,t),fa(o)),null),S=>(Ne(d._readableStreamController,S),Xt(o,S),null)),o._finishPromise}function Vu(e){let t=e._transformStreamController;if(t._finishPromise!==void 0)return t._finishPromise;let o=e._readable;t._finishPromise=b((h,S)=>{t._finishPromise_resolve=h,t._finishPromise_reject=S});let d=t._flushAlgorithm();return fn(t),P(d,()=>(o._state==="errored"?Xt(t,o._storedError):(Dt(o._readableStreamController),fa(t)),null),h=>(Ne(o._readableStreamController,h),Xt(t,h),null)),t._finishPromise}function $u(e){return cn(e,!1),e._backpressureChangePromise}function ju(e,t){let o=e._transformStreamController;if(o._finishPromise!==void 0)return o._finishPromise;let d=e._writable;o._finishPromise=b((S,w)=>{o._finishPromise_resolve=S,o._finishPromise_reject=w});let h=o._cancelAlgorithm(t);return fn(o),P(h,()=>(d._state==="errored"?Xt(o,d._storedError):(gr(d._writableStreamController,t),da(e),fa(o)),null),S=>(gr(d._writableStreamController,S),da(e),Xt(o,S),null)),o._finishPromise}function mn(e){return new TypeError(`TransformStreamDefaultController.prototype.${e} can only be used on a TransformStreamDefaultController`)}function fa(e){e._finishPromise_resolve!==void 0&&(e._finishPromise_resolve(),e._finishPromise_resolve=void 0,e._finishPromise_reject=void 0)}function Xt(e,t){e._finishPromise_reject!==void 0&&(O(e._finishPromise),e._finishPromise_reject(t),e._finishPromise_resolve=void 0,e._finishPromise_reject=void 0)}function go(e){return new TypeError(`TransformStream.prototype.${e} can only be used on a TransformStream`)}r.ByteLengthQueuingStrategy=sn,r.CountQueuingStrategy=ln,r.ReadableByteStreamController=Ke,r.ReadableStream=ce,r.ReadableStreamBYOBReader=mt,r.ReadableStreamBYOBRequest=vt,r.ReadableStreamDefaultController=et,r.ReadableStreamDefaultReader=Ie,r.TransformStream=un,r.TransformStreamDefaultController=yt,r.WritableStream=ht,r.WritableStreamDefaultController=Gt,r.WritableStreamDefaultWriter=Je})});var Eo=te(()=>{if(!globalThis.ReadableStream)try{let r=require("node:process"),{emitWarning:n}=r;try{r.emitWarning=()=>{},Object.assign(globalThis,require("node:stream/web")),r.emitWarning=n}catch(a){throw r.emitWarning=n,a}}catch{Object.assign(globalThis,vo())}try{let{Blob:r}=require("buffer");r&&!r.prototype.stream&&(r.prototype.stream=function(a){let s=0,i=this;return new ReadableStream({type:"bytes",async pull(u){let p=await i.slice(s,Math.min(i.size,s+65536)).arrayBuffer();s+=p.byteLength,u.enqueue(new Uint8Array(p)),s===i.size&&u.close()}})})}catch{}});async function*ha(r,n=!0){for(let a of r)if("stream"in a)yield*a.stream();else if(ArrayBuffer.isView(a))if(n){let s=a.byteOffset,i=a.byteOffset+a.byteLength;for(;s!==i;){let u=Math.min(i-s,Ao),f=a.buffer.slice(s,s+u);s+=f.byteLength,yield new Uint8Array(f)}}else yield a;else{let s=0,i=a;for(;s!==i.size;){let f=await i.slice(s,Math.min(i.size,s+Ao)).arrayBuffer();s+=f.byteLength,yield new Uint8Array(f)}}}var ff,Ao,Co,Ku,nt,vr=Rr(()=>{ff=We(Eo(),1);Ao=65536;Co=class pa{#e=[];#t="";#r=0;#n="transparent";constructor(n=[],a={}){if(typeof n!="object"||n===null)throw new TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if(typeof n[Symbol.iterator]!="function")throw new TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if(typeof a!="object"&&typeof a!="function")throw new TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");a===null&&(a={});let s=new TextEncoder;for(let u of n){let f;ArrayBuffer.isView(u)?f=new Uint8Array(u.buffer.slice(u.byteOffset,u.byteOffset+u.byteLength)):u instanceof ArrayBuffer?f=new Uint8Array(u.slice(0)):u instanceof pa?f=u:f=s.encode(`${u}`),this.#r+=ArrayBuffer.isView(f)?f.byteLength:f.size,this.#e.push(f)}this.#n=`${a.endings===void 0?"transparent":a.endings}`;let i=a.type===void 0?"":String(a.type);this.#t=/^[\x20-\x7E]*$/.test(i)?i:""}get size(){return this.#r}get type(){return this.#t}async text(){let n=new TextDecoder,a="";for await(let s of ha(this.#e,!1))a+=n.decode(s,{stream:!0});return a+=n.decode(),a}async arrayBuffer(){let n=new Uint8Array(this.size),a=0;for await(let s of ha(this.#e,!1))n.set(s,a),a+=s.length;return n.buffer}stream(){let n=ha(this.#e,!0);return new globalThis.ReadableStream({type:"bytes",async pull(a){let s=await n.next();s.done?a.close():a.enqueue(s.value)},async cancel(){await n.return()}})}slice(n=0,a=this.size,s=""){let{size:i}=this,u=n<0?Math.max(i+n,0):Math.min(n,i),f=a<0?Math.max(i+a,0):Math.min(a,i),p=Math.max(f-u,0),b=this.#e,m=[],_=0;for(let P of b){if(_>=p)break;let A=ArrayBuffer.isView(P)?P.byteLength:P.size;if(u&&A<=u)u-=A,f-=A;else{let R;ArrayBuffer.isView(P)?(R=P.subarray(u,Math.min(A,f)),_+=R.byteLength):(R=P.slice(u,Math.min(A,f)),_+=R.size),f-=A,m.push(R),u=0}}let v=new pa([],{type:String(s).toLowerCase()});return v.#r=p,v.#e=m,v}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](n){return n&&typeof n=="object"&&typeof n.constructor=="function"&&(typeof n.stream=="function"||typeof n.arrayBuffer=="function")&&/^(Blob|File)$/.test(n[Symbol.toStringTag])}};Object.defineProperties(Co.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});Ku=Co,nt=Ku});var Ju,ec,tr,ba=Rr(()=>{vr();Ju=class extends nt{#e=0;#t="";constructor(n,a,s={}){if(arguments.length<2)throw new TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);super(n,s),s===null&&(s={});let i=s.lastModified===void 0?Date.now():Number(s.lastModified);Number.isNaN(i)||(this.#e=i),this.#t=String(a)}get name(){return this.#t}get lastModified(){return this.#e}get[Symbol.toStringTag](){return"File"}static[Symbol.hasInstance](n){return!!n&&n instanceof nt&&/^(File)$/.test(n[Symbol.toStringTag])}},ec=Ju,tr=ec});function Do(r,n=nt){var a=`${Po()}${Po()}`.replace(/\./g,"").slice(-28).padStart(32,"-"),s=[],i=`--${a}\r
Content-Disposition: form-data; name="`;return r.forEach((u,f)=>typeof u=="string"?s.push(i+ya(f)+`"\r
\r
${u.replace(/\r(?!\n)|(?<!\r)\n/g,`\r
`)}\r
`):s.push(i+ya(f)+`"; filename="${ya(u.name,1)}"\r
Content-Type: ${u.type||"application/octet-stream"}\r
\r
`,u,`\r
`)),s.push(`--${a}--`),new n(s,{type:"multipart/form-data; boundary="+a})}var Er,tc,rc,Po,nc,Io,ya,Lt,Ot,yn=Rr(()=>{vr();ba();({toStringTag:Er,iterator:tc,hasInstance:rc}=Symbol),Po=Math.random,nc="append,set,get,getAll,delete,keys,values,entries,forEach,constructor".split(","),Io=(r,n,a)=>(r+="",/^(Blob|File)$/.test(n&&n[Er])?[(a=a!==void 0?a+"":n[Er]=="File"?n.name:"blob",r),n.name!==a||n[Er]=="blob"?new tr([n],a,n):n]:[r,n+""]),ya=(r,n)=>(n?r:r.replace(/\r?\n|\r/g,`\r
`)).replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22"),Lt=(r,n,a)=>{if(n.length<a)throw new TypeError(`Failed to execute '${r}' on 'FormData': ${a} arguments required, but only ${n.length} present.`)},Ot=class{#e=[];constructor(...n){if(n.length)throw new TypeError("Failed to construct 'FormData': parameter 1 is not of type 'HTMLFormElement'.")}get[Er](){return"FormData"}[tc](){return this.entries()}static[rc](n){return n&&typeof n=="object"&&n[Er]==="FormData"&&!nc.some(a=>typeof n[a]!="function")}append(...n){Lt("append",arguments,2),this.#e.push(Io(...n))}delete(n){Lt("delete",arguments,1),n+="",this.#e=this.#e.filter(([a])=>a!==n)}get(n){Lt("get",arguments,1),n+="";for(var a=this.#e,s=a.length,i=0;i<s;i++)if(a[i][0]===n)return a[i][1];return null}getAll(n,a){return Lt("getAll",arguments,1),a=[],n+="",this.#e.forEach(s=>s[0]===n&&a.push(s[1])),a}has(n){return Lt("has",arguments,1),n+="",this.#e.some(a=>a[0]===n)}forEach(n,a){Lt("forEach",arguments,1);for(var[s,i]of this)n.call(a,i,s,this)}set(...n){Lt("set",arguments,2);var a=[],s=!0;n=Io(...n),this.#e.forEach(i=>{i[0]===n[0]?s&&(s=!a.push(n)):a.push(i)}),s&&a.push(n),this.#e=a}*entries(){yield*this.#e}*keys(){for(var[n]of this)yield n}*values(){for(var[,n]of this)yield n}}});var qo=te((Ef,Fo)=>{if(!globalThis.DOMException)try{let{MessageChannel:r}=require("worker_threads"),n=new r().port1,a=new ArrayBuffer;n.postMessage(a,[a,a])}catch(r){r.constructor.name==="DOMException"&&(globalThis.DOMException=r.constructor)}Fo.exports=globalThis.DOMException});var _n,ac,Pf,_a=Rr(()=>{_n=require("node:fs"),ac=We(qo(),1);ba();vr();({stat:Pf}=_n.promises)});var No={};So(No,{toFormData:()=>dc});function cc(r){let n=r.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!n)return;let a=n[2]||n[3]||"",s=a.slice(a.lastIndexOf("\\")+1);return s=s.replace(/%22/g,'"'),s=s.replace(/&#(\d{4});/g,(i,u)=>String.fromCharCode(u)),s}async function dc(r,n){if(!/multipart/i.test(n))throw new TypeError("Failed to fetch");let a=n.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!a)throw new TypeError("no or bad content-type header, no multipart boundary");let s=new Sa(a[1]||a[2]),i,u,f,p,b,m,_=[],v=new Ot,P=W=>{f+=O.decode(W,{stream:!0})},A=W=>{_.push(W)},R=()=>{let W=new tr(_,m,{type:b});v.append(p,W)},N=()=>{v.append(p,f)},O=new TextDecoder("utf-8");O.decode(),s.onPartBegin=function(){s.onPartData=P,s.onPartEnd=N,i="",u="",f="",p="",b="",m=null,_.length=0},s.onHeaderField=function(W){i+=O.decode(W,{stream:!0})},s.onHeaderValue=function(W){u+=O.decode(W,{stream:!0})},s.onHeaderEnd=function(){if(u+=O.decode(),i=i.toLowerCase(),i==="content-disposition"){let W=u.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);W&&(p=W[2]||W[3]||""),m=cc(u),m&&(s.onPartData=A,s.onPartEnd=R)}else i==="content-type"&&(b=u);u="",i=""};for await(let W of r)s.write(W);return s.end(),v}var He,J,ko,_t,Sn,wn,ic,Cr,oc,sc,lc,uc,Ft,Sa,Mo=Rr(()=>{_a();yn();He=0,J={START_BOUNDARY:He++,HEADER_FIELD_START:He++,HEADER_FIELD:He++,HEADER_VALUE_START:He++,HEADER_VALUE:He++,HEADER_VALUE_ALMOST_DONE:He++,HEADERS_ALMOST_DONE:He++,PART_DATA_START:He++,PART_DATA:He++,END:He++},ko=1,_t={PART_BOUNDARY:ko,LAST_BOUNDARY:ko*=2},Sn=10,wn=13,ic=32,Cr=45,oc=58,sc=97,lc=122,uc=r=>r|32,Ft=()=>{},Sa=class{constructor(n){this.index=0,this.flags=0,this.onHeaderEnd=Ft,this.onHeaderField=Ft,this.onHeadersEnd=Ft,this.onHeaderValue=Ft,this.onPartBegin=Ft,this.onPartData=Ft,this.onPartEnd=Ft,this.boundaryChars={},n=`\r
--`+n;let a=new Uint8Array(n.length);for(let s=0;s<n.length;s++)a[s]=n.charCodeAt(s),this.boundaryChars[a[s]]=!0;this.boundary=a,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=J.START_BOUNDARY}write(n){let a=0,s=n.length,i=this.index,{lookbehind:u,boundary:f,boundaryChars:p,index:b,state:m,flags:_}=this,v=this.boundary.length,P=v-1,A=n.length,R,N,O=M=>{this[M+"Mark"]=a},W=M=>{delete this[M+"Mark"]},I=(M,U,V,Q)=>{(U===void 0||U!==V)&&this[M](Q&&Q.subarray(U,V))},L=(M,U)=>{let V=M+"Mark";V in this&&(U?(I(M,this[V],a,n),delete this[V]):(I(M,this[V],n.length,n),this[V]=0))};for(a=0;a<s;a++)switch(R=n[a],m){case J.START_BOUNDARY:if(b===f.length-2){if(R===Cr)_|=_t.LAST_BOUNDARY;else if(R!==wn)return;b++;break}else if(b-1===f.length-2){if(_&_t.LAST_BOUNDARY&&R===Cr)m=J.END,_=0;else if(!(_&_t.LAST_BOUNDARY)&&R===Sn)b=0,I("onPartBegin"),m=J.HEADER_FIELD_START;else return;break}R!==f[b+2]&&(b=-2),R===f[b+2]&&b++;break;case J.HEADER_FIELD_START:m=J.HEADER_FIELD,O("onHeaderField"),b=0;case J.HEADER_FIELD:if(R===wn){W("onHeaderField"),m=J.HEADERS_ALMOST_DONE;break}if(b++,R===Cr)break;if(R===oc){if(b===1)return;L("onHeaderField",!0),m=J.HEADER_VALUE_START;break}if(N=uc(R),N<sc||N>lc)return;break;case J.HEADER_VALUE_START:if(R===ic)break;O("onHeaderValue"),m=J.HEADER_VALUE;case J.HEADER_VALUE:R===wn&&(L("onHeaderValue",!0),I("onHeaderEnd"),m=J.HEADER_VALUE_ALMOST_DONE);break;case J.HEADER_VALUE_ALMOST_DONE:if(R!==Sn)return;m=J.HEADER_FIELD_START;break;case J.HEADERS_ALMOST_DONE:if(R!==Sn)return;I("onHeadersEnd"),m=J.PART_DATA_START;break;case J.PART_DATA_START:m=J.PART_DATA,O("onPartData");case J.PART_DATA:if(i=b,b===0){for(a+=P;a<A&&!(n[a]in p);)a+=v;a-=P,R=n[a]}if(b<f.length)f[b]===R?(b===0&&L("onPartData",!0),b++):b=0;else if(b===f.length)b++,R===wn?_|=_t.PART_BOUNDARY:R===Cr?_|=_t.LAST_BOUNDARY:b=0;else if(b-1===f.length)if(_&_t.PART_BOUNDARY){if(b=0,R===Sn){_&=~_t.PART_BOUNDARY,I("onPartEnd"),I("onPartBegin"),m=J.HEADER_FIELD_START;break}}else _&_t.LAST_BOUNDARY&&R===Cr?(I("onPartEnd"),m=J.END,_=0):b=0;if(b>0)u[b-1]=R;else if(i>0){let M=new Uint8Array(u.buffer,u.byteOffset,u.byteLength);I("onPartData",0,i,M),i=0,O("onPartData"),a--}break;case J.END:break;default:throw new Error(`Unexpected state entered: ${m}`)}L("onHeaderField"),L("onHeaderValue"),L("onPartData"),this.index=b,this.state=m,this.flags=_}end(){if(this.state===J.HEADER_FIELD_START&&this.index===0||this.state===J.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==J.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}}});var Fa=te(Pn=>{(function(r){r.parser=function(c,l){return new a(c,l)},r.SAXParser=a,r.SAXStream=m,r.createStream=b,r.MAX_BUFFER_LENGTH=64*1024;var n=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];r.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function a(c,l){if(!(this instanceof a))return new a(c,l);var T=this;i(T),T.q=T.c="",T.bufferCheckPosition=r.MAX_BUFFER_LENGTH,T.opt=l||{},T.opt.lowercase=T.opt.lowercase||T.opt.lowercasetags,T.looseCase=T.opt.lowercase?"toLowerCase":"toUpperCase",T.tags=[],T.closed=T.closedRoot=T.sawRoot=!1,T.tag=T.error=null,T.strict=!!c,T.noscript=!!(c||T.opt.noscript),T.state=g.BEGIN,T.strictEntities=T.opt.strictEntities,T.ENTITIES=T.strictEntities?Object.create(r.XML_ENTITIES):Object.create(r.ENTITIES),T.attribList=[],T.opt.xmlns&&(T.ns=Object.create(R)),T.trackPosition=T.opt.position!==!1,T.trackPosition&&(T.position=T.line=T.column=0),F(T,"onready")}Object.create||(Object.create=function(c){function l(){}l.prototype=c;var T=new l;return T}),Object.keys||(Object.keys=function(c){var l=[];for(var T in c)c.hasOwnProperty(T)&&l.push(T);return l});function s(c){for(var l=Math.max(r.MAX_BUFFER_LENGTH,10),T=0,y=0,G=n.length;y<G;y++){var ee=c[n[y]].length;if(ee>l)switch(n[y]){case"textNode":z(c);break;case"cdata":C(c,"oncdata",c.cdata),c.cdata="";break;case"script":C(c,"onscript",c.script),c.script="";break;default:Y(c,"Max buffer length exceeded: "+n[y])}T=Math.max(T,ee)}var ne=r.MAX_BUFFER_LENGTH-T;c.bufferCheckPosition=ne+c.position}function i(c){for(var l=0,T=n.length;l<T;l++)c[n[l]]=""}function u(c){z(c),c.cdata!==""&&(C(c,"oncdata",c.cdata),c.cdata=""),c.script!==""&&(C(c,"onscript",c.script),c.script="")}a.prototype={end:function(){he(this)},write:pe,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){u(this)}};var f;try{f=require("stream").Stream}catch{f=function(){}}var p=r.EVENTS.filter(function(c){return c!=="error"&&c!=="end"});function b(c,l){return new m(c,l)}function m(c,l){if(!(this instanceof m))return new m(c,l);f.apply(this),this._parser=new a(c,l),this.writable=!0,this.readable=!0;var T=this;this._parser.onend=function(){T.emit("end")},this._parser.onerror=function(y){T.emit("error",y),T._parser.error=null},this._decoder=null,p.forEach(function(y){Object.defineProperty(T,"on"+y,{get:function(){return T._parser["on"+y]},set:function(G){if(!G)return T.removeAllListeners(y),T._parser["on"+y]=G,G;T.on(y,G)},enumerable:!0,configurable:!1})})}m.prototype=Object.create(f.prototype,{constructor:{value:m}}),m.prototype.write=function(c){if(typeof Buffer=="function"&&typeof Buffer.isBuffer=="function"&&Buffer.isBuffer(c)){if(!this._decoder){var l=require("string_decoder").StringDecoder;this._decoder=new l("utf8")}c=this._decoder.write(c)}return this._parser.write(c.toString()),this.emit("data",c),!0},m.prototype.end=function(c){return c&&c.length&&this.write(c),this._parser.end(),!0},m.prototype.on=function(c,l){var T=this;return!T._parser["on"+c]&&p.indexOf(c)!==-1&&(T._parser["on"+c]=function(){var y=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);y.splice(0,0,c),T.emit.apply(T,y)}),f.prototype.on.call(T,c,l)};var _="[CDATA[",v="DOCTYPE",P="http://www.w3.org/XML/1998/namespace",A="http://www.w3.org/2000/xmlns/",R={xml:P,xmlns:A},N=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,O=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,W=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,I=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function L(c){return c===" "||c===`
`||c==="\r"||c==="	"}function M(c){return c==='"'||c==="'"}function U(c){return c===">"||L(c)}function V(c,l){return c.test(l)}function Q(c,l){return!V(c,l)}var g=0;r.STATE={BEGIN:g++,BEGIN_WHITESPACE:g++,TEXT:g++,TEXT_ENTITY:g++,OPEN_WAKA:g++,SGML_DECL:g++,SGML_DECL_QUOTED:g++,DOCTYPE:g++,DOCTYPE_QUOTED:g++,DOCTYPE_DTD:g++,DOCTYPE_DTD_QUOTED:g++,COMMENT_STARTING:g++,COMMENT:g++,COMMENT_ENDING:g++,COMMENT_ENDED:g++,CDATA:g++,CDATA_ENDING:g++,CDATA_ENDING_2:g++,PROC_INST:g++,PROC_INST_BODY:g++,PROC_INST_ENDING:g++,OPEN_TAG:g++,OPEN_TAG_SLASH:g++,ATTRIB:g++,ATTRIB_NAME:g++,ATTRIB_NAME_SAW_WHITE:g++,ATTRIB_VALUE:g++,ATTRIB_VALUE_QUOTED:g++,ATTRIB_VALUE_CLOSED:g++,ATTRIB_VALUE_UNQUOTED:g++,ATTRIB_VALUE_ENTITY_Q:g++,ATTRIB_VALUE_ENTITY_U:g++,CLOSE_TAG:g++,CLOSE_TAG_SAW_WHITE:g++,SCRIPT:g++,SCRIPT_ENDING:g++},r.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},r.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(r.ENTITIES).forEach(function(c){var l=r.ENTITIES[c],T=typeof l=="number"?String.fromCharCode(l):l;r.ENTITIES[c]=T});for(var de in r.STATE)r.STATE[r.STATE[de]]=de;g=r.STATE;function F(c,l,T){c[l]&&c[l](T)}function C(c,l,T){c.textNode&&z(c),F(c,l,T)}function z(c){c.textNode=X(c.opt,c.textNode),c.textNode&&F(c,"ontext",c.textNode),c.textNode=""}function X(c,l){return c.trim&&(l=l.trim()),c.normalize&&(l=l.replace(/\s+/g," ")),l}function Y(c,l){return z(c),c.trackPosition&&(l+=`
Line: `+c.line+`
Column: `+c.column+`
Char: `+c.c),l=new Error(l),c.error=l,F(c,"onerror",l),c}function he(c){return c.sawRoot&&!c.closedRoot&&q(c,"Unclosed root tag"),c.state!==g.BEGIN&&c.state!==g.BEGIN_WHITESPACE&&c.state!==g.TEXT&&Y(c,"Unexpected end"),z(c),c.c="",c.closed=!0,F(c,"onend"),a.call(c,c.strict,c.opt),c}function q(c,l){if(typeof c!="object"||!(c instanceof a))throw new Error("bad call to strictFail");c.strict&&Y(c,l)}function D(c){c.strict||(c.tagName=c.tagName[c.looseCase]());var l=c.tags[c.tags.length-1]||c,T=c.tag={name:c.tagName,attributes:{}};c.opt.xmlns&&(T.ns=l.ns),c.attribList.length=0,C(c,"onopentagstart",T)}function re(c,l){var T=c.indexOf(":"),y=T<0?["",c]:c.split(":"),G=y[0],ee=y[1];return l&&c==="xmlns"&&(G="xmlns",ee=""),{prefix:G,local:ee}}function ct(c){if(c.strict||(c.attribName=c.attribName[c.looseCase]()),c.attribList.indexOf(c.attribName)!==-1||c.tag.attributes.hasOwnProperty(c.attribName)){c.attribName=c.attribValue="";return}if(c.opt.xmlns){var l=re(c.attribName,!0),T=l.prefix,y=l.local;if(T==="xmlns")if(y==="xml"&&c.attribValue!==P)q(c,"xml: prefix must be bound to "+P+`
Actual: `+c.attribValue);else if(y==="xmlns"&&c.attribValue!==A)q(c,"xmlns: prefix must be bound to "+A+`
Actual: `+c.attribValue);else{var G=c.tag,ee=c.tags[c.tags.length-1]||c;G.ns===ee.ns&&(G.ns=Object.create(ee.ns)),G.ns[y]=c.attribValue}c.attribList.push([c.attribName,c.attribValue])}else c.tag.attributes[c.attribName]=c.attribValue,C(c,"onattribute",{name:c.attribName,value:c.attribValue});c.attribName=c.attribValue=""}function je(c,l){if(c.opt.xmlns){var T=c.tag,y=re(c.tagName);T.prefix=y.prefix,T.local=y.local,T.uri=T.ns[y.prefix]||"",T.prefix&&!T.uri&&(q(c,"Unbound namespace prefix: "+JSON.stringify(c.tagName)),T.uri=y.prefix);var G=c.tags[c.tags.length-1]||c;T.ns&&G.ns!==T.ns&&Object.keys(T.ns).forEach(function(ke){C(c,"onopennamespace",{prefix:ke,uri:T.ns[ke]})});for(var ee=0,ne=c.attribList.length;ee<ne;ee++){var se=c.attribList[ee],be=se[0],Te=se[1],ae=re(be,!0),Re=ae.prefix,$t=ae.local,fr=Re===""?"":T.ns[Re]||"",Ie={name:be,value:Te,prefix:Re,local:$t,uri:fr};Re&&Re!=="xmlns"&&!fr&&(q(c,"Unbound namespace prefix: "+JSON.stringify(Re)),Ie.uri=Re),c.tag.attributes[be]=Ie,C(c,"onattribute",Ie)}c.attribList.length=0}c.tag.isSelfClosing=!!l,c.sawRoot=!0,c.tags.push(c.tag),C(c,"onopentag",c.tag),l||(!c.noscript&&c.tagName.toLowerCase()==="script"?c.state=g.SCRIPT:c.state=g.TEXT,c.tag=null,c.tagName=""),c.attribName=c.attribValue="",c.attribList.length=0}function Vt(c){if(!c.tagName){q(c,"Weird empty close tag."),c.textNode+="</>",c.state=g.TEXT;return}if(c.script){if(c.tagName!=="script"){c.script+="</"+c.tagName+">",c.tagName="",c.state=g.SCRIPT;return}C(c,"onscript",c.script),c.script=""}var l=c.tags.length,T=c.tagName;c.strict||(T=T[c.looseCase]());for(var y=T;l--;){var G=c.tags[l];if(G.name!==y)q(c,"Unexpected close tag");else break}if(l<0){q(c,"Unmatched closing tag: "+c.tagName),c.textNode+="</"+c.tagName+">",c.state=g.TEXT;return}c.tagName=T;for(var ee=c.tags.length;ee-- >l;){var ne=c.tag=c.tags.pop();c.tagName=c.tag.name,C(c,"onclosetag",c.tagName);var se={};for(var be in ne.ns)se[be]=ne.ns[be];var Te=c.tags[c.tags.length-1]||c;c.opt.xmlns&&ne.ns!==Te.ns&&Object.keys(ne.ns).forEach(function(ae){var Re=ne.ns[ae];C(c,"onclosenamespace",{prefix:ae,uri:Re})})}l===0&&(c.closedRoot=!0),c.tagName=c.attribValue=c.attribName="",c.attribList.length=0,c.state=g.TEXT}function Nn(c){var l=c.entity,T=l.toLowerCase(),y,G="";return c.ENTITIES[l]?c.ENTITIES[l]:c.ENTITIES[T]?c.ENTITIES[T]:(l=T,l.charAt(0)==="#"&&(l.charAt(1)==="x"?(l=l.slice(2),y=parseInt(l,16),G=y.toString(16)):(l=l.slice(1),y=parseInt(l,10),G=y.toString(10))),l=l.replace(/^0+/,""),isNaN(y)||G.toLowerCase()!==l?(q(c,"Invalid character entity"),"&"+c.entity+";"):String.fromCodePoint(y))}function xr(c,l){l==="<"?(c.state=g.OPEN_WAKA,c.startTagPosition=c.position):L(l)||(q(c,"Non-whitespace before first tag."),c.textNode=l,c.state=g.TEXT)}function we(c,l){var T="";return l<c.length&&(T=c.charAt(l)),T}function pe(c){var l=this;if(this.error)throw this.error;if(l.closed)return Y(l,"Cannot write after close. Assign an onready handler.");if(c===null)return he(l);typeof c=="object"&&(c=c.toString());for(var T=0,y="";y=we(c,T++),l.c=y,!!y;)switch(l.trackPosition&&(l.position++,y===`
`?(l.line++,l.column=0):l.column++),l.state){case g.BEGIN:if(l.state=g.BEGIN_WHITESPACE,y==="\uFEFF")continue;xr(l,y);continue;case g.BEGIN_WHITESPACE:xr(l,y);continue;case g.TEXT:if(l.sawRoot&&!l.closedRoot){for(var G=T-1;y&&y!=="<"&&y!=="&";)y=we(c,T++),y&&l.trackPosition&&(l.position++,y===`
`?(l.line++,l.column=0):l.column++);l.textNode+=c.substring(G,T-1)}y==="<"&&!(l.sawRoot&&l.closedRoot&&!l.strict)?(l.state=g.OPEN_WAKA,l.startTagPosition=l.position):(!L(y)&&(!l.sawRoot||l.closedRoot)&&q(l,"Text data outside of root node."),y==="&"?l.state=g.TEXT_ENTITY:l.textNode+=y);continue;case g.SCRIPT:y==="<"?l.state=g.SCRIPT_ENDING:l.script+=y;continue;case g.SCRIPT_ENDING:y==="/"?l.state=g.CLOSE_TAG:(l.script+="<"+y,l.state=g.SCRIPT);continue;case g.OPEN_WAKA:if(y==="!")l.state=g.SGML_DECL,l.sgmlDecl="";else if(!L(y))if(V(N,y))l.state=g.OPEN_TAG,l.tagName=y;else if(y==="/")l.state=g.CLOSE_TAG,l.tagName="";else if(y==="?")l.state=g.PROC_INST,l.procInstName=l.procInstBody="";else{if(q(l,"Unencoded <"),l.startTagPosition+1<l.position){var ee=l.position-l.startTagPosition;y=new Array(ee).join(" ")+y}l.textNode+="<"+y,l.state=g.TEXT}continue;case g.SGML_DECL:(l.sgmlDecl+y).toUpperCase()===_?(C(l,"onopencdata"),l.state=g.CDATA,l.sgmlDecl="",l.cdata=""):l.sgmlDecl+y==="--"?(l.state=g.COMMENT,l.comment="",l.sgmlDecl=""):(l.sgmlDecl+y).toUpperCase()===v?(l.state=g.DOCTYPE,(l.doctype||l.sawRoot)&&q(l,"Inappropriately located doctype declaration"),l.doctype="",l.sgmlDecl=""):y===">"?(C(l,"onsgmldeclaration",l.sgmlDecl),l.sgmlDecl="",l.state=g.TEXT):(M(y)&&(l.state=g.SGML_DECL_QUOTED),l.sgmlDecl+=y);continue;case g.SGML_DECL_QUOTED:y===l.q&&(l.state=g.SGML_DECL,l.q=""),l.sgmlDecl+=y;continue;case g.DOCTYPE:y===">"?(l.state=g.TEXT,C(l,"ondoctype",l.doctype),l.doctype=!0):(l.doctype+=y,y==="["?l.state=g.DOCTYPE_DTD:M(y)&&(l.state=g.DOCTYPE_QUOTED,l.q=y));continue;case g.DOCTYPE_QUOTED:l.doctype+=y,y===l.q&&(l.q="",l.state=g.DOCTYPE);continue;case g.DOCTYPE_DTD:l.doctype+=y,y==="]"?l.state=g.DOCTYPE:M(y)&&(l.state=g.DOCTYPE_DTD_QUOTED,l.q=y);continue;case g.DOCTYPE_DTD_QUOTED:l.doctype+=y,y===l.q&&(l.state=g.DOCTYPE_DTD,l.q="");continue;case g.COMMENT:y==="-"?l.state=g.COMMENT_ENDING:l.comment+=y;continue;case g.COMMENT_ENDING:y==="-"?(l.state=g.COMMENT_ENDED,l.comment=X(l.opt,l.comment),l.comment&&C(l,"oncomment",l.comment),l.comment=""):(l.comment+="-"+y,l.state=g.COMMENT);continue;case g.COMMENT_ENDED:y!==">"?(q(l,"Malformed comment"),l.comment+="--"+y,l.state=g.COMMENT):l.state=g.TEXT;continue;case g.CDATA:y==="]"?l.state=g.CDATA_ENDING:l.cdata+=y;continue;case g.CDATA_ENDING:y==="]"?l.state=g.CDATA_ENDING_2:(l.cdata+="]"+y,l.state=g.CDATA);continue;case g.CDATA_ENDING_2:y===">"?(l.cdata&&C(l,"oncdata",l.cdata),C(l,"onclosecdata"),l.cdata="",l.state=g.TEXT):y==="]"?l.cdata+="]":(l.cdata+="]]"+y,l.state=g.CDATA);continue;case g.PROC_INST:y==="?"?l.state=g.PROC_INST_ENDING:L(y)?l.state=g.PROC_INST_BODY:l.procInstName+=y;continue;case g.PROC_INST_BODY:if(!l.procInstBody&&L(y))continue;y==="?"?l.state=g.PROC_INST_ENDING:l.procInstBody+=y;continue;case g.PROC_INST_ENDING:y===">"?(C(l,"onprocessinginstruction",{name:l.procInstName,body:l.procInstBody}),l.procInstName=l.procInstBody="",l.state=g.TEXT):(l.procInstBody+="?"+y,l.state=g.PROC_INST_BODY);continue;case g.OPEN_TAG:V(O,y)?l.tagName+=y:(D(l),y===">"?je(l):y==="/"?l.state=g.OPEN_TAG_SLASH:(L(y)||q(l,"Invalid character in tag name"),l.state=g.ATTRIB));continue;case g.OPEN_TAG_SLASH:y===">"?(je(l,!0),Vt(l)):(q(l,"Forward-slash in opening tag not followed by >"),l.state=g.ATTRIB);continue;case g.ATTRIB:if(L(y))continue;y===">"?je(l):y==="/"?l.state=g.OPEN_TAG_SLASH:V(N,y)?(l.attribName=y,l.attribValue="",l.state=g.ATTRIB_NAME):q(l,"Invalid attribute name");continue;case g.ATTRIB_NAME:y==="="?l.state=g.ATTRIB_VALUE:y===">"?(q(l,"Attribute without value"),l.attribValue=l.attribName,ct(l),je(l)):L(y)?l.state=g.ATTRIB_NAME_SAW_WHITE:V(O,y)?l.attribName+=y:q(l,"Invalid attribute name");continue;case g.ATTRIB_NAME_SAW_WHITE:if(y==="=")l.state=g.ATTRIB_VALUE;else{if(L(y))continue;q(l,"Attribute without value"),l.tag.attributes[l.attribName]="",l.attribValue="",C(l,"onattribute",{name:l.attribName,value:""}),l.attribName="",y===">"?je(l):V(N,y)?(l.attribName=y,l.state=g.ATTRIB_NAME):(q(l,"Invalid attribute name"),l.state=g.ATTRIB)}continue;case g.ATTRIB_VALUE:if(L(y))continue;M(y)?(l.q=y,l.state=g.ATTRIB_VALUE_QUOTED):(q(l,"Unquoted attribute value"),l.state=g.ATTRIB_VALUE_UNQUOTED,l.attribValue=y);continue;case g.ATTRIB_VALUE_QUOTED:if(y!==l.q){y==="&"?l.state=g.ATTRIB_VALUE_ENTITY_Q:l.attribValue+=y;continue}ct(l),l.q="",l.state=g.ATTRIB_VALUE_CLOSED;continue;case g.ATTRIB_VALUE_CLOSED:L(y)?l.state=g.ATTRIB:y===">"?je(l):y==="/"?l.state=g.OPEN_TAG_SLASH:V(N,y)?(q(l,"No whitespace between attributes"),l.attribName=y,l.attribValue="",l.state=g.ATTRIB_NAME):q(l,"Invalid attribute name");continue;case g.ATTRIB_VALUE_UNQUOTED:if(!U(y)){y==="&"?l.state=g.ATTRIB_VALUE_ENTITY_U:l.attribValue+=y;continue}ct(l),y===">"?je(l):l.state=g.ATTRIB;continue;case g.CLOSE_TAG:if(l.tagName)y===">"?Vt(l):V(O,y)?l.tagName+=y:l.script?(l.script+="</"+l.tagName,l.tagName="",l.state=g.SCRIPT):(L(y)||q(l,"Invalid tagname in closing tag"),l.state=g.CLOSE_TAG_SAW_WHITE);else{if(L(y))continue;Q(N,y)?l.script?(l.script+="</"+y,l.state=g.SCRIPT):q(l,"Invalid tagname in closing tag."):l.tagName=y}continue;case g.CLOSE_TAG_SAW_WHITE:if(L(y))continue;y===">"?Vt(l):q(l,"Invalid characters in closing tag");continue;case g.TEXT_ENTITY:case g.ATTRIB_VALUE_ENTITY_Q:case g.ATTRIB_VALUE_ENTITY_U:var ne,se;switch(l.state){case g.TEXT_ENTITY:ne=g.TEXT,se="textNode";break;case g.ATTRIB_VALUE_ENTITY_Q:ne=g.ATTRIB_VALUE_QUOTED,se="attribValue";break;case g.ATTRIB_VALUE_ENTITY_U:ne=g.ATTRIB_VALUE_UNQUOTED,se="attribValue";break}y===";"?(l[se]+=Nn(l),l.entity="",l.state=ne):V(l.entity.length?I:W,y)?l.entity+=y:(q(l,"Invalid character in entity name"),l[se]+="&"+l.entity+y,l.entity="",l.state=ne);continue;default:throw new Error(l,"Unknown state: "+l.state)}return l.position>=l.bufferCheckPosition&&s(l),l}String.fromCodePoint||function(){var c=String.fromCharCode,l=Math.floor,T=function(){var y=16384,G=[],ee,ne,se=-1,be=arguments.length;if(!be)return"";for(var Te="";++se<be;){var ae=Number(arguments[se]);if(!isFinite(ae)||ae<0||ae>1114111||l(ae)!==ae)throw RangeError("Invalid code point: "+ae);ae<=65535?G.push(ae):(ae-=65536,ee=(ae>>10)+55296,ne=ae%1024+56320,G.push(ee,ne)),(se+1===be||G.length>y)&&(Te+=c.apply(null,G),G.length=0)}return Te};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:T,configurable:!0,writable:!0}):String.fromCodePoint=T}()})(typeof Pn>"u"?Pn.sax={}:Pn)});var Br=te((qa,cs)=>{"use strict";var us=qa&&qa.__importDefault||function(r){return r&&r.__esModule?r:{default:r}},_c=us(require("http")),Sc=us(require("https")),wc=require("stream"),ls={"http:":_c.default,"https:":Sc.default},Tc=new Set([301,302,303,307,308]),Rc=new Set([429,503]),vc=["connect","continue","information","socket","timeout","upgrade"],Ec=["aborted"];Qe.MinigetError=class extends Error{constructor(n,a){super(n),this.statusCode=a}};Qe.defaultOptions={maxRedirects:10,maxRetries:2,maxReconnects:0,backoff:{inc:100,max:1e4}};function Qe(r,n={}){var a;let s=Object.assign({},Qe.defaultOptions,n),i=new wc.PassThrough({highWaterMark:s.highWaterMark});i.destroyed=i.aborted=!1;let u,f,p,b=0,m=0,_,v=0,P,A=!1,R=0,N,O=0;if(!((a=s.headers)===null||a===void 0)&&a.Range){let F=/bytes=(\d+)-(\d+)?/.exec(`${s.headers.Range}`);F&&(R=parseInt(F[1],10),N=parseInt(F[2],10))}s.acceptEncoding&&(s.headers=Object.assign({"Accept-Encoding":Object.keys(s.acceptEncoding).join(", ")},s.headers));let W=()=>p&&O>0,I=()=>!A||O===P,L=F=>{p=null,m=0;let C=s.backoff.inc,z=Math.min(C,s.backoff.max);_=setTimeout(Q,z),i.emit("reconnect",v,F)},M=F=>n.method!=="HEAD"&&!I()&&v++<s.maxReconnects?(L(F),!0):!1,U=F=>{if(i.destroyed)return!1;if(W())return M(F.err);if((!F.err||F.err.message==="ENOTFOUND")&&m++<s.maxRetries){let C=F.retryAfter||Math.min(m*s.backoff.inc,s.backoff.max);return _=setTimeout(Q,C),i.emit("retry",m,F.err),!0}return!1},V=(F,C)=>{for(let z of C)F.on(z,i.emit.bind(i,z))},Q=()=>{let F={},C;try{let D=typeof r=="string"?new URL(r):r;F=Object.assign({},{host:D.host,hostname:D.hostname,path:D.pathname+D.search+D.hash,port:D.port,protocol:D.protocol}),D.username&&(F.auth=`${D.username}:${D.password}`),C=ls[String(F.protocol)]}catch{}if(!C){i.emit("error",new Qe.MinigetError(`Invalid URL: ${r}`));return}if(Object.assign(F,s),A&&O>0){let D=O+R,re=N||"";F.headers=Object.assign({},F.headers,{Range:`bytes=${D}-${re}`})}if(s.transform){try{F=s.transform(F)}catch(D){i.emit("error",D);return}if((!F||F.protocol)&&(C=ls[String(F?.protocol)],!C)){i.emit("error",new Qe.MinigetError("Invalid URL object from `transform` function"));return}}let z=D=>{i.destroyed||i.readableEnded||(Y(),U({err:D})?u.removeListener("close",X):i.emit("error",D))},X=()=>{Y(),U({})},Y=()=>{u.removeListener("close",X),f?.removeListener("data",he),p?.removeListener("end",q)},he=D=>{O+=D.length},q=()=>{Y(),M()||i.end()};u=C.request(F,D=>{if(!i.destroyed){if(Tc.has(D.statusCode)){if(b++>=s.maxRedirects)i.emit("error",new Qe.MinigetError("Too many redirects"));else{if(D.headers.location)r=D.headers.location;else{let re=new Qe.MinigetError("Redirect status code given with no location",D.statusCode);i.emit("error",re),Y();return}setTimeout(Q,parseInt(D.headers["retry-after"]||"0",10)*1e3),i.emit("redirect",r)}Y();return}else if(Rc.has(D.statusCode)){if(!U({retryAfter:parseInt(D.headers["retry-after"]||"0",10)})){let re=new Qe.MinigetError(`Status code: ${D.statusCode}`,D.statusCode);i.emit("error",re)}Y();return}else if(D.statusCode&&(D.statusCode<200||D.statusCode>=400)){let re=new Qe.MinigetError(`Status code: ${D.statusCode}`,D.statusCode);D.statusCode>=500?z(re):i.emit("error",re),Y();return}if(p=D,s.acceptEncoding&&D.headers["content-encoding"])for(let re of D.headers["content-encoding"].split(", ").reverse()){let ct=s.acceptEncoding[re];ct&&(p=p.pipe(ct()),p.on("error",z))}P||(P=parseInt(`${D.headers["content-length"]}`,10),A=D.headers["accept-ranges"]==="bytes"&&P>0&&s.maxReconnects>0),D.on("data",he),p.on("end",q),p.pipe(i,{end:!A}),f=D,i.emit("response",D),D.on("error",z),V(D,Ec)}}),u.on("error",z),u.on("close",X),V(u,vc),i.destroyed&&de(...g),i.emit("request",u),u.end()};i.abort=F=>{console.warn("`MinigetStream#abort()` has been deprecated in favor of `MinigetStream#destroy()`"),i.aborted=!0,i.emit("abort"),i.destroy(F)};let g,de=F=>{u.destroy(F),p?.unpipe(i),p?.destroy(),clearTimeout(_)};return i._destroy=(...F)=>{i.destroyed=!0,u?de(...F):g=F},i.text=()=>new Promise((F,C)=>{let z="";i.setEncoding("utf8"),i.on("data",X=>z+=X),i.on("end",()=>F(z)),i.on("error",C)}),process.nextTick(Q),i}cs.exports=Qe});var ka=te((qm,Ac)=>{Ac.exports={name:"ytdl-core",description:"YouTube video downloader in pure javascript.",keywords:["youtube","video","download"],version:"4.11.5",repository:{type:"git",url:"git://github.com/fent/node-ytdl-core.git"},author:"fent <fentbox@gmail.com> (https://github.com/fent)",contributors:["Tobias Kutscha (https://github.com/TimeForANinja)","Andrew Kelley (https://github.com/andrewrk)","Mauricio Allende (https://github.com/mallendeo)","Rodrigo Altamirano (https://github.com/raltamirano)","Jim Buck (https://github.com/JimmyBoh)","Pawe\u0142 Ruci\u0144ski (https://github.com/Roki100)","Alexander Paolini (https://github.com/Million900o)"],main:"./lib/index.js",types:"./typings/index.d.ts",files:["lib","typings"],scripts:{test:"nyc --reporter=lcov --reporter=text-summary npm run test:unit","test:unit":"mocha --ignore test/irl-test.js test/*-test.js --timeout 4000","test:irl":"mocha --timeout 16000 test/irl-test.js",lint:"eslint ./","lint:fix":"eslint --fix ./","lint:typings":"tslint typings/index.d.ts","lint:typings:fix":"tslint --fix typings/index.d.ts"},dependencies:{m3u8stream:"^0.8.6",miniget:"^4.2.2",sax:"^1.1.3"},devDependencies:{"@types/node":"^13.1.0","assert-diff":"^3.0.1",dtslint:"^3.6.14",eslint:"^6.8.0",mocha:"^7.0.0","muk-require":"^1.2.0",nock:"^13.0.4",nyc:"^15.0.0",sinon:"^9.0.0","stream-equal":"~1.1.0",typescript:"^3.9.7"},engines:{node:">=12"},license:"MIT"}});var ir=te(Se=>{var fs=Br();Se.between=(r,n,a)=>{let s;if(n instanceof RegExp){let i=r.match(n);if(!i)return"";s=i.index+i[0].length}else{if(s=r.indexOf(n),s===-1)return"";s+=n.length}return r=r.slice(s),s=r.indexOf(a),s===-1?"":(r=r.slice(0,s),r)};Se.parseAbbreviatedNumber=r=>{let n=r.replace(",",".").replace(" ","").match(/([\d,.]+)([MK]?)/);if(n){let[,a,s]=n;return a=parseFloat(a),Math.round(s==="M"?a*1e6:s==="K"?a*1e3:a)}return null};var Cc=[{start:'"',end:'"'},{start:"'",end:"'"},{start:"`",end:"`"},{start:"/",end:"/",startPrefix:/(^|[[{:;,/])\s?$/}];Se.cutAfterJS=r=>{let n,a;if(r[0]==="["?(n="[",a="]"):r[0]==="{"&&(n="{",a="}"),!n)throw new Error(`Can't cut unsupported JSON (need to begin with [ or { ) but got: ${r[0]}`);let s=null,i=!1,u=0,f;for(f=0;f<r.length;f++){if(!i&&s!==null&&r[f]===s.end){s=null;continue}else if(!i&&s===null){for(let p of Cc)if(r[f]===p.start&&(!p.startPrefix||r.substring(f-10,f).match(p.startPrefix))){s=p;break}if(s!==null)continue}if(i=r[f]==="\\"&&!i,s===null&&(r[f]===n?u++:r[f]===a&&u--,u===0))return r.substring(0,f+1)}throw Error("Can't cut unsupported JSON (no matching closing bracket found)")};Se.playError=(r,n,a=Error)=>{let s=r&&r.playabilityStatus;return s&&n.includes(s.status)?new a(s.reason||s.messages&&s.messages[0]):null};Se.exposedMiniget=(r,n={},a)=>{let s=fs(r,a||n.requestOptions);return typeof n.requestCallback=="function"&&n.requestCallback(s),s};Se.deprecate=(r,n,a,s,i)=>{Object.defineProperty(r,n,{get:()=>(console.warn(`\`${s}\` will be removed in a near future release, use \`${i}\` instead.`),a)})};var ds=ka(),Pc=1e3*60*60*12;Se.lastUpdateCheck=0;Se.checkForUpdates=()=>!process.env.YTDL_NO_UPDATE&&!ds.version.startsWith("0.0.0-")&&Date.now()-Se.lastUpdateCheck>=Pc?(Se.lastUpdateCheck=Date.now(),fs("https://api.github.com/repos/fent/node-ytdl-core/releases/latest",{headers:{"User-Agent":"ytdl-core"}}).text().then(r=>{JSON.parse(r).tag_name!==`v${ds.version}`&&console.warn('\x1B[33mWARNING:\x1B[0m ytdl-core is out of date! Update with "npm install ytdl-core@latest".')},r=>{console.warn("Error checking for updates:",r.message),console.warn("You can disable this check by setting the `YTDL_NO_UPDATE` env variable.")})):null;Se.getRandomIPv6=r=>{if(!Dc(r))throw Error("Invalid IPv6 format");let[n,a]=r.split("/"),s=parseInt(a);if(!s||s>128||s<24)throw Error("Invalid IPv6 subnet");let i=Bc(n);return new Array(8).fill(1).map(()=>Math.floor(Math.random()*65535)).map((p,b)=>{let m=Math.min(s,16);s-=m;let _=65535-(2**(16-m)-1);return(i[b]&_)+(p&(_^65535))}).map(p=>p.toString("16")).join(":")};var Ic=/^(([0-9a-f]{1,4}:)(:[0-9a-f]{1,4}){1,6}|([0-9a-f]{1,4}:){1,2}(:[0-9a-f]{1,4}){1,5}|([0-9a-f]{1,4}:){1,3}(:[0-9a-f]{1,4}){1,4}|([0-9a-f]{1,4}:){1,4}(:[0-9a-f]{1,4}){1,3}|([0-9a-f]{1,4}:){1,5}(:[0-9a-f]{1,4}){1,2}|([0-9a-f]{1,4}:){1,6}(:[0-9a-f]{1,4})|([0-9a-f]{1,4}:){1,7}(([0-9a-f]{1,4})|:))\/(1[0-1]\d|12[0-8]|\d{1,2})$/,Dc=Se.isIPv6=r=>Ic.test(r),Bc=Se.normalizeIP=r=>{let n=r.split("::").map(u=>u.split(":")),a=n[0]||[],s=n[1]||[];s.reverse();let i=new Array(8).fill(0);for(let u=0;u<Math.min(a.length,8);u++)i[u]=parseInt(a[u],16)||0;for(let u=0;u<Math.min(s.length,8);u++)i[7-u]=parseInt(s[u],16)||0;return i}});var hs=te((Nm,ms)=>{ms.exports={5:{mimeType:'video/flv; codecs="Sorenson H.283, mp3"',qualityLabel:"240p",bitrate:25e4,audioBitrate:64},6:{mimeType:'video/flv; codecs="Sorenson H.263, mp3"',qualityLabel:"270p",bitrate:8e5,audioBitrate:64},13:{mimeType:'video/3gp; codecs="MPEG-4 Visual, aac"',qualityLabel:null,bitrate:5e5,audioBitrate:null},17:{mimeType:'video/3gp; codecs="MPEG-4 Visual, aac"',qualityLabel:"144p",bitrate:5e4,audioBitrate:24},18:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"360p",bitrate:5e5,audioBitrate:96},22:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"720p",bitrate:2e6,audioBitrate:192},34:{mimeType:'video/flv; codecs="H.264, aac"',qualityLabel:"360p",bitrate:5e5,audioBitrate:128},35:{mimeType:'video/flv; codecs="H.264, aac"',qualityLabel:"480p",bitrate:8e5,audioBitrate:128},36:{mimeType:'video/3gp; codecs="MPEG-4 Visual, aac"',qualityLabel:"240p",bitrate:175e3,audioBitrate:32},37:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"1080p",bitrate:3e6,audioBitrate:192},38:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"3072p",bitrate:35e5,audioBitrate:192},43:{mimeType:'video/webm; codecs="VP8, vorbis"',qualityLabel:"360p",bitrate:5e5,audioBitrate:128},44:{mimeType:'video/webm; codecs="VP8, vorbis"',qualityLabel:"480p",bitrate:1e6,audioBitrate:128},45:{mimeType:'video/webm; codecs="VP8, vorbis"',qualityLabel:"720p",bitrate:2e6,audioBitrate:192},46:{mimeType:'audio/webm; codecs="vp8, vorbis"',qualityLabel:"1080p",bitrate:null,audioBitrate:192},82:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"360p",bitrate:5e5,audioBitrate:96},83:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"240p",bitrate:5e5,audioBitrate:96},84:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"720p",bitrate:2e6,audioBitrate:192},85:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"1080p",bitrate:3e6,audioBitrate:192},91:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"144p",bitrate:1e5,audioBitrate:48},92:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"240p",bitrate:15e4,audioBitrate:48},93:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"360p",bitrate:5e5,audioBitrate:128},94:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"480p",bitrate:8e5,audioBitrate:128},95:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"720p",bitrate:15e5,audioBitrate:256},96:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"1080p",bitrate:25e5,audioBitrate:256},100:{mimeType:'audio/webm; codecs="VP8, vorbis"',qualityLabel:"360p",bitrate:null,audioBitrate:128},101:{mimeType:'audio/webm; codecs="VP8, vorbis"',qualityLabel:"360p",bitrate:null,audioBitrate:192},102:{mimeType:'audio/webm; codecs="VP8, vorbis"',qualityLabel:"720p",bitrate:null,audioBitrate:192},120:{mimeType:'video/flv; codecs="H.264, aac"',qualityLabel:"720p",bitrate:2e6,audioBitrate:128},127:{mimeType:'audio/ts; codecs="aac"',qualityLabel:null,bitrate:null,audioBitrate:96},128:{mimeType:'audio/ts; codecs="aac"',qualityLabel:null,bitrate:null,audioBitrate:96},132:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"240p",bitrate:15e4,audioBitrate:48},133:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"240p",bitrate:2e5,audioBitrate:null},134:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"360p",bitrate:3e5,audioBitrate:null},135:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"480p",bitrate:5e5,audioBitrate:null},136:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"720p",bitrate:1e6,audioBitrate:null},137:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"1080p",bitrate:25e5,audioBitrate:null},138:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"4320p",bitrate:135e5,audioBitrate:null},139:{mimeType:'audio/mp4; codecs="aac"',qualityLabel:null,bitrate:null,audioBitrate:48},140:{mimeType:'audio/m4a; codecs="aac"',qualityLabel:null,bitrate:null,audioBitrate:128},141:{mimeType:'audio/mp4; codecs="aac"',qualityLabel:null,bitrate:null,audioBitrate:256},151:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"720p",bitrate:5e4,audioBitrate:24},160:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"144p",bitrate:1e5,audioBitrate:null},171:{mimeType:'audio/webm; codecs="vorbis"',qualityLabel:null,bitrate:null,audioBitrate:128},172:{mimeType:'audio/webm; codecs="vorbis"',qualityLabel:null,bitrate:null,audioBitrate:192},242:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"240p",bitrate:1e5,audioBitrate:null},243:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"360p",bitrate:25e4,audioBitrate:null},244:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"480p",bitrate:5e5,audioBitrate:null},247:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"720p",bitrate:7e5,audioBitrate:null},248:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1080p",bitrate:15e5,audioBitrate:null},249:{mimeType:'audio/webm; codecs="opus"',qualityLabel:null,bitrate:null,audioBitrate:48},250:{mimeType:'audio/webm; codecs="opus"',qualityLabel:null,bitrate:null,audioBitrate:64},251:{mimeType:'audio/webm; codecs="opus"',qualityLabel:null,bitrate:null,audioBitrate:160},264:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"1440p",bitrate:4e6,audioBitrate:null},266:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"2160p",bitrate:125e5,audioBitrate:null},271:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1440p",bitrate:9e6,audioBitrate:null},272:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"4320p",bitrate:2e7,audioBitrate:null},278:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"144p 30fps",bitrate:8e4,audioBitrate:null},298:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"720p",bitrate:3e6,audioBitrate:null},299:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"1080p",bitrate:55e5,audioBitrate:null},300:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"720p",bitrate:1318e3,audioBitrate:48},302:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"720p HFR",bitrate:25e5,audioBitrate:null},303:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1080p HFR",bitrate:5e6,audioBitrate:null},308:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1440p HFR",bitrate:1e7,audioBitrate:null},313:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"2160p",bitrate:13e6,audioBitrate:null},315:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"2160p HFR",bitrate:2e7,audioBitrate:null},330:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"144p HDR, HFR",bitrate:8e4,audioBitrate:null},331:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"240p HDR, HFR",bitrate:1e5,audioBitrate:null},332:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"360p HDR, HFR",bitrate:25e4,audioBitrate:null},333:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"240p HDR, HFR",bitrate:5e5,audioBitrate:null},334:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"720p HDR, HFR",bitrate:1e6,audioBitrate:null},335:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1080p HDR, HFR",bitrate:15e5,audioBitrate:null},336:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1440p HDR, HFR",bitrate:5e6,audioBitrate:null},337:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"2160p HDR, HFR",bitrate:12e6,audioBitrate:null}}});var Wa=te(Xe=>{var Lc=ir(),Oc=hs(),Fc=["mp4a","mp3","vorbis","aac","opus","flac"],qc=["mp4v","avc1","Sorenson H.283","MPEG-4 Visual","VP8","VP9","H.264"],ps=r=>r.bitrate||0,bs=r=>qc.findIndex(n=>r.codecs&&r.codecs.includes(n)),ys=r=>r.audioBitrate||0,gs=r=>Fc.findIndex(n=>r.codecs&&r.codecs.includes(n)),xa=(r,n,a)=>{let s=0;for(let i of a)if(s=i(n)-i(r),s!==0)break;return s},Na=(r,n)=>xa(r,n,[a=>parseInt(a.qualityLabel),ps,bs]),Ma=(r,n)=>xa(r,n,[ys,gs]);Xe.sortFormats=(r,n)=>xa(r,n,[a=>+!!a.isHLS,a=>+!!a.isDashMPD,a=>+(a.contentLength>0),a=>+(a.hasVideo&&a.hasAudio),a=>+a.hasVideo,a=>parseInt(a.qualityLabel)||0,ps,ys,bs,gs]);Xe.chooseFormat=(r,n)=>{if(typeof n.format=="object"){if(!n.format.url)throw Error("Invalid format given, did you use `ytdl.getInfo()`?");return n.format}n.filter&&(r=Xe.filterFormats(r,n.filter)),r.some(i=>i.isHLS)&&(r=r.filter(i=>i.isHLS||!i.isLive));let a,s=n.quality||"highest";switch(s){case"highest":a=r[0];break;case"lowest":a=r[r.length-1];break;case"highestaudio":{r=Xe.filterFormats(r,"audio"),r.sort(Ma);let i=r[0];r=r.filter(f=>Ma(i,f)===0);let u=r.map(f=>parseInt(f.qualityLabel)||0).sort((f,p)=>f-p)[0];a=r.find(f=>(parseInt(f.qualityLabel)||0)===u);break}case"lowestaudio":r=Xe.filterFormats(r,"audio"),r.sort(Ma),a=r[r.length-1];break;case"highestvideo":{r=Xe.filterFormats(r,"video"),r.sort(Na);let i=r[0];r=r.filter(f=>Na(i,f)===0);let u=r.map(f=>f.audioBitrate||0).sort((f,p)=>f-p)[0];a=r.find(f=>(f.audioBitrate||0)===u);break}case"lowestvideo":r=Xe.filterFormats(r,"video"),r.sort(Na),a=r[r.length-1];break;default:a=kc(s,r);break}if(!a)throw Error(`No such format found: ${s}`);return a};var kc=(r,n)=>{let a=s=>n.find(i=>`${i.itag}`==`${s}`);return Array.isArray(r)?a(r.find(s=>a(s))):a(r)};Xe.filterFormats=(r,n)=>{let a;switch(n){case"videoandaudio":case"audioandvideo":a=s=>s.hasVideo&&s.hasAudio;break;case"video":a=s=>s.hasVideo;break;case"videoonly":a=s=>s.hasVideo&&!s.hasAudio;break;case"audio":a=s=>s.hasAudio;break;case"audioonly":a=s=>!s.hasVideo&&s.hasAudio;break;default:if(typeof n=="function")a=n;else throw TypeError(`Given filter (${n}) is not supported`)}return r.filter(s=>!!s.url&&a(s))};Xe.addFormatMeta=r=>(r=Object.assign({},Oc[r.itag],r),r.hasVideo=!!r.qualityLabel,r.hasAudio=!!r.audioBitrate,r.container=r.mimeType?r.mimeType.split(";")[0].split("/")[1]:null,r.codecs=r.mimeType?Lc.between(r.mimeType,'codecs="','"'):null,r.videoCodec=r.hasVideo&&r.codecs?r.codecs.split(", ")[0]:null,r.audioCodec=r.hasAudio&&r.codecs?r.codecs.split(", ").slice(-1)[0]:null,r.isLive=/\bsource[/=]yt_live_broadcast\b/.test(r.url),r.isHLS=/\/manifest\/hls_(variant|playlist)\//.test(r.url),r.isDashMPD=/\/manifest\/dash\//.test(r.url),r)});var Ua=te(ot=>{var Nc=new Set(["youtube.com","www.youtube.com","m.youtube.com","music.youtube.com","gaming.youtube.com"]),Mc=/^https?:\/\/(youtu\.be\/|(www\.)?youtube\.com\/(embed|v|shorts)\/)/;ot.getURLVideoID=r=>{let n=new URL(r.trim()),a=n.searchParams.get("v");if(Mc.test(r.trim())&&!a){let s=n.pathname.split("/");a=n.host==="youtu.be"?s[1]:s[2]}else if(n.hostname&&!Nc.has(n.hostname))throw Error("Not a YouTube domain");if(!a)throw Error(`No video id found: "${r}"`);if(a=a.substring(0,11),!ot.validateID(a))throw TypeError(`Video id (${a}) does not match expected format (${_s.toString()})`);return a};var xc=/^https?:\/\//;ot.getVideoID=r=>{if(ot.validateID(r))return r;if(xc.test(r.trim()))return ot.getURLVideoID(r);throw Error(`No video id found: ${r}`)};var _s=/^[a-zA-Z0-9-_]{11}$/;ot.validateID=r=>_s.test(r.trim());ot.validateURL=r=>{try{return ot.getURLVideoID(r),!0}catch{return!1}}});var Ss=te($a=>{"use strict";Object.defineProperty($a,"__esModule",{value:!0});var Wc=require("stream"),Va=class extends Wc.Writable{constructor(){super(),this._lastLine="",this._seq=0,this._nextItemDuration=null,this._nextItemRange=null,this._lastItemRangeEnd=0,this.on("finish",()=>{this._parseLine(this._lastLine),this.emit("end")})}_parseAttrList(n){let a={},s=/([A-Z0-9-]+)=(?:"([^"]*?)"|([^,]*?))/g,i;for(;(i=s.exec(n))!==null;)a[i[1]]=i[2]||i[3];return a}_parseRange(n){if(!n)return null;let a=n.split("@"),s=a[1]?parseInt(a[1]):this._lastItemRangeEnd+1,i=s+parseInt(a[0])-1,u={start:s,end:i};return this._lastItemRangeEnd=u.end,u}_parseLine(n){let a=n.match(/^#(EXT[A-Z0-9-]+)(?::(.*))?/);if(a){let s=a[1],i=a[2]||"";switch(s){case"EXT-X-PROGRAM-DATE-TIME":this.emit("starttime",new Date(i).getTime());break;case"EXT-X-MEDIA-SEQUENCE":this._seq=parseInt(i);break;case"EXT-X-MAP":{let u=this._parseAttrList(i);if(!u.URI){this.destroy(new Error("`EXT-X-MAP` found without required attribute `URI`"));return}this.emit("item",{url:u.URI,seq:this._seq,init:!0,duration:0,range:this._parseRange(u.BYTERANGE)});break}case"EXT-X-BYTERANGE":{this._nextItemRange=this._parseRange(i);break}case"EXTINF":this._nextItemDuration=Math.round(parseFloat(i.split(",")[0])*1e3);break;case"EXT-X-ENDLIST":this.emit("endlist");break}}else!/^#/.test(n)&&n.trim()&&(this.emit("item",{url:n.trim(),seq:this._seq++,duration:this._nextItemDuration,range:this._nextItemRange}),this._nextItemRange=null)}_write(n,a,s){let i=n.toString("utf8").split(`
`);this._lastLine&&(i[0]=this._lastLine+i[0]),i.forEach((u,f)=>{this.destroyed||(f<i.length-1?this._parseLine(u):this._lastLine=u)}),s()}};$a.default=Va});var ja=te(or=>{"use strict";Object.defineProperty(or,"__esModule",{value:!0});or.durationStr=or.humanStr=void 0;var Uc=/^\d+$/,Vc=/^(?:(?:(\d+):)?(\d{1,2}):)?(\d{1,2})(?:\.(\d{3}))?$/,Lr={ms:1,s:1e3,m:6e4,h:36e5};or.humanStr=r=>{if(typeof r=="number")return r;if(Uc.test(r))return+r;let n=Vc.exec(r);if(n)return+(n[1]||0)*Lr.h+ +(n[2]||0)*Lr.m+ +n[3]*Lr.s+ +(n[4]||0);{let a=0,s=/(-?\d+)(ms|s|m|h)/g,i;for(;(i=s.exec(r))!==null;)a+=+i[1]*Lr[i[2]];return a}};or.durationStr=r=>{let n=0,a=/(\d+(?:\.\d+)?)(S|M|H)/g,s;for(;(s=a.exec(r))!==null;)n+=+s[1]*Lr[s[2].toLowerCase()];return n}});var ws=te(Or=>{"use strict";var $c=Or&&Or.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Or,"__esModule",{value:!0});var jc=require("stream"),zc=$c(Fa()),Hc=ja(),za=class extends jc.Writable{constructor(n){super(),this._parser=zc.default.createStream(!1,{lowercase:!0}),this._parser.on("error",this.destroy.bind(this));let a,s=0,i=0,u,f,p,b,m,_=[],v=!1,P=!1,A,R,N,O=I=>{let L={RepresentationID:n,Number:i,Time:s};return I.replace(/\$(\w+)\$/g,(M,U)=>`${L[U]}`)};this._parser.on("opentag",I=>{switch(I.name){case"mpd":s=I.attributes.availabilitystarttime?new Date(I.attributes.availabilitystarttime).getTime():0,A=I.attributes.type!=="dynamic";break;case"period":i=0,f=1e3,b=0,p=0,m=[],R=0,N=Hc.durationStr(I.attributes.start)||0;break;case"segmentlist":i=parseInt(I.attributes.startnumber)||i,f=parseInt(I.attributes.timescale)||f,b=parseInt(I.attributes.duration)||b,p=parseInt(I.attributes.presentationtimeoffset)||p;break;case"segmenttemplate":u=I.attributes,i=parseInt(I.attributes.startnumber)||i,f=parseInt(I.attributes.timescale)||f;break;case"segmenttimeline":case"baseurl":a=I.name;break;case"s":_.push({duration:parseInt(I.attributes.d),repeat:parseInt(I.attributes.r),time:parseInt(I.attributes.t)});break;case"adaptationset":case"representation":R++,n||(n=I.attributes.id),v=I.attributes.id===`${n}`,v&&(N&&(s+=N),p&&(s-=p/f*1e3),this.emit("starttime",s));break;case"initialization":v&&this.emit("item",{url:m.filter(L=>!!L).join("")+I.attributes.sourceurl,seq:i,init:!0,duration:0});break;case"segmenturl":if(v){P=!0;let L=_.shift(),M=(L?.duration||b)/f*1e3;this.emit("item",{url:m.filter(U=>!!U).join("")+I.attributes.media,seq:i++,duration:M}),s+=M}break}});let W=()=>{A&&this.emit("endlist"),v?this.emit("end"):this.destroy(Error(`Representation '${n}' not found`))};this._parser.on("closetag",I=>{switch(I){case"adaptationset":case"representation":if(R--,u&&_.length){P=!0,u.initialization&&this.emit("item",{url:m.filter(L=>!!L).join("")+O(u.initialization),seq:i,init:!0,duration:0});for(let{duration:L,repeat:M,time:U}of _){L=L/f*1e3,M=M||1,s=U||s;for(let V=0;V<M;V++)this.emit("item",{url:m.filter(Q=>!!Q).join("")+O(u.media),seq:i++,duration:L}),s+=L}}P&&(this.emit("endearly"),W(),this._parser.removeAllListeners(),this.removeAllListeners("finish"));break}}),this._parser.on("text",I=>{a==="baseurl"&&(m[R]=I,a=null)}),this.on("finish",W)}_write(n,a,s){this._parser.write(n),s()}};Or.default=za});var Ts=te(In=>{"use strict";Object.defineProperty(In,"__esModule",{value:!0});In.Queue=void 0;var Ha=class{constructor(n,a={}){this._worker=n,this._concurrency=a.concurrency||1,this.tasks=[],this.total=0,this.active=0}push(n,a){this.tasks.push({item:n,callback:a}),this.total++,this._next()}_next(){if(this.active>=this._concurrency||!this.tasks.length)return;let{item:n,callback:a}=this.tasks.shift(),s=!1;this.active++,this._worker(n,(i,u)=>{s||(this.active--,s=!0,a?.(i,u),this._next())})}die(){this.tasks=[]}};In.Queue=Ha});var Dn=te((Ga,Ps)=>{"use strict";var Ya=Ga&&Ga.__importDefault||function(r){return r&&r.__esModule?r:{default:r}},Rs=require("stream"),vs=Ya(Br()),Gc=Ya(Ss()),Yc=Ya(ws()),Es=Ts(),As=ja(),Qc={m3u8:Gc.default,"dash-mpd":Yc.default},Cs=(r,n={})=>{let a=new Rs.PassThrough({highWaterMark:n.highWaterMark}),s=n.chunkReadahead||3,i=n.liveBuffer||2e4,u=n.requestOptions,f=Qc[n.parser||(/\.mpd$/.test(r)?"dash-mpd":"m3u8")];if(!f)throw TypeError(`parser '${n.parser}' not supported`);let p=0;typeof n.begin<"u"&&(p=typeof n.begin=="string"?As.humanStr(n.begin):Math.max(n.begin-i,0));let b=C=>{for(let z of["abort","request","response","redirect","retry","reconnect"])C.on(z,a.emit.bind(a,z))},m,_=new Es.Queue((C,z)=>{m=C;let X=0;C.on("data",Y=>X+=Y.length),C.pipe(a,{end:!1}),C.on("end",()=>z(null,X))},{concurrency:1}),v=0,P=0,A=new Es.Queue((C,z)=>{let X=Object.assign({},u);C.range&&(X.headers=Object.assign({},X.headers,{Range:`bytes=${C.range.start}-${C.range.end}`}));let Y=vs.default(new URL(C.url,r).toString(),X);Y.on("error",z),b(Y),_.push(Y,(he,q)=>{P+=+q,a.emit("progress",{num:++v,size:q,duration:C.duration,url:C.url},A.total,P),z(null)})},{concurrency:s}),R=C=>{a.emit("error",C),a.end()},N,O,W,I=!0,L=!1,M=!1,U,V=C=>{if(m=null,C)R(C);else if(!I&&!L&&!M&&A.tasks.length+A.active<=N){let z=Math.max(0,O-(Date.now()-U));I=!0,W=setTimeout(F,z)}else(L||M)&&!A.tasks.length&&!A.active&&a.end()},Q,g,de=0,F=()=>{U=Date.now(),Q=vs.default(r,u),Q.on("error",R),b(Q);let C=Q.pipe(new f(n.id));C.on("starttime",q=>{de||(de=q,typeof n.begin=="string"&&p>=0&&(p+=de))}),C.on("endlist",()=>{M=!0}),C.on("endearly",Q.unpipe.bind(Q,C));let z=[],X=q=>{if(!q.init){if(q.seq<=g)return;g=q.seq}p=q.time,A.push(q,V),z.push(q)},Y=[],he=0;C.on("item",q=>{let D=Object.assign({time:de},q);if(p<=D.time)X(D);else for(Y.push(D),he+=D.duration;Y.length>1&&he-Y[0].duration>i;){let re=Y.shift();he-=re.duration}de+=D.duration}),C.on("end",()=>{Q=null,!z.length&&Y.length&&Y.forEach(q=>{X(q)}),N=Math.max(1,Math.ceil(z.length*.01)),O=z.reduce((q,D)=>D.duration+q,0),I=!1,V(null)})};return F(),a.end=()=>(L=!0,_.die(),A.die(),clearTimeout(W),Q?.destroy(),m?.destroy(),Rs.PassThrough.prototype.end.call(a,null),a),a};Cs.parseTimestamp=As.humanStr;Ps.exports=Cs});var Bs=te(st=>{var Wt=ir(),Xc=require("querystring"),{parseTimestamp:Zc}=Dn(),sr="https://www.youtube.com/watch?v=",Qa={song:{name:"Music",url:"https://music.youtube.com/"}},me=r=>r?r.runs?r.runs[0].text:r.simpleText:null;st.getMedia=r=>{let n={},a=[];try{a=r.response.contents.twoColumnWatchNextResults.results.results.contents}catch{}let s=a.find(i=>i.videoSecondaryInfoRenderer);if(!s)return{};try{let i=(s.metadataRowContainer||s.videoSecondaryInfoRenderer.metadataRowContainer).metadataRowContainerRenderer.rows;for(let u of i)if(u.metadataRowRenderer){let f=me(u.metadataRowRenderer.title).toLowerCase(),p=u.metadataRowRenderer.contents[0];n[f]=me(p);let b=p.runs;b&&b[0].navigationEndpoint&&(n[`${f}_url`]=new URL(b[0].navigationEndpoint.commandMetadata.webCommandMetadata.url,sr).toString()),f in Qa&&(n.category=Qa[f].name,n.category_url=Qa[f].url)}else if(u.richMetadataRowRenderer){let f=u.richMetadataRowRenderer.contents,p=f.filter(m=>m.richMetadataRenderer.style==="RICH_METADATA_RENDERER_STYLE_BOX_ART");for(let{richMetadataRenderer:m}of p){let _=m;n.year=me(_.subtitle);let v=me(_.callToAction).split(" ")[1];n[v]=me(_.title),n[`${v}_url`]=new URL(_.endpoint.commandMetadata.webCommandMetadata.url,sr).toString(),n.thumbnails=_.thumbnail.thumbnails}let b=f.filter(m=>m.richMetadataRenderer.style==="RICH_METADATA_RENDERER_STYLE_TOPIC");for(let{richMetadataRenderer:m}of b){let _=m;n.category=me(_.title),n.category_url=new URL(_.endpoint.commandMetadata.webCommandMetadata.url,sr).toString()}}}catch{}return n};var Ds=r=>!!(r&&r.find(n=>n.metadataBadgeRenderer.tooltip==="Verified"));st.getAuthor=r=>{let n,a=[],s,i=!1;try{let p=r.response.contents.twoColumnWatchNextResults.results.results.contents.find(b=>b.videoSecondaryInfoRenderer&&b.videoSecondaryInfoRenderer.owner&&b.videoSecondaryInfoRenderer.owner.videoOwnerRenderer).videoSecondaryInfoRenderer.owner.videoOwnerRenderer;n=p.navigationEndpoint.browseEndpoint.browseId,a=p.thumbnail.thumbnails.map(b=>(b.url=new URL(b.url,sr).toString(),b)),s=Wt.parseAbbreviatedNumber(me(p.subscriberCountText)),i=Ds(p.badges)}catch{}try{let u=r.player_response.microformat&&r.player_response.microformat.playerMicroformatRenderer,f=u&&u.channelId||n||r.player_response.videoDetails.channelId,p={id:f,name:u?u.ownerChannelName:r.player_response.videoDetails.author,user:u?u.ownerProfileUrl.split("/").slice(-1)[0]:null,channel_url:`https://www.youtube.com/channel/${f}`,external_channel_url:u?`https://www.youtube.com/channel/${u.externalChannelId}`:"",user_url:u?new URL(u.ownerProfileUrl,sr).toString():"",thumbnails:a,verified:i,subscriber_count:s};return a.length&&Wt.deprecate(p,"avatar",p.thumbnails[0].url,"author.avatar","author.thumbnails[0].url"),p}catch{return{}}};var Is=(r,n)=>{if(r)try{let a=me(r.viewCountText),s=me(r.shortViewCountText),i=n.find(_=>_.id===r.videoId);/^\d/.test(s)||(s=i&&i.short_view_count_text||""),a=(/^\d/.test(a)?a:s).split(" ")[0];let u=r.shortBylineText.runs[0].navigationEndpoint.browseEndpoint,f=u.browseId,p=me(r.shortBylineText),b=(u.canonicalBaseUrl||"").split("/").slice(-1)[0],m={id:r.videoId,title:me(r.title),published:me(r.publishedTimeText),author:{id:f,name:p,user:b,channel_url:`https://www.youtube.com/channel/${f}`,user_url:`https://www.youtube.com/user/${b}`,thumbnails:r.channelThumbnail.thumbnails.map(_=>(_.url=new URL(_.url,sr).toString(),_)),verified:Ds(r.ownerBadges),[Symbol.toPrimitive](){return console.warn("`relatedVideo.author` will be removed in a near future release, use `relatedVideo.author.name` instead."),m.author.name}},short_view_count_text:s.split(" ")[0],view_count:a.replace(/,/g,""),length_seconds:r.lengthText?Math.floor(Zc(me(r.lengthText))/1e3):n&&`${n.length_seconds}`,thumbnails:r.thumbnail.thumbnails,richThumbnails:r.richThumbnail?r.richThumbnail.movingThumbnailRenderer.movingThumbnailDetails.thumbnails:[],isLive:!!(r.badges&&r.badges.find(_=>_.metadataBadgeRenderer.label==="LIVE NOW"))};return Wt.deprecate(m,"author_thumbnail",m.author.thumbnails[0].url,"relatedVideo.author_thumbnail","relatedVideo.author.thumbnails[0].url"),Wt.deprecate(m,"ucid",m.author.id,"relatedVideo.ucid","relatedVideo.author.id"),Wt.deprecate(m,"video_thumbnail",m.thumbnails[0].url,"relatedVideo.video_thumbnail","relatedVideo.thumbnails[0].url"),m}catch{}};st.getRelatedVideos=r=>{let n=[],a=[];try{n=r.response.webWatchNextResponseExtensionData.relatedVideoArgs.split(",").map(i=>Xc.parse(i))}catch{}try{a=r.response.contents.twoColumnWatchNextResults.secondaryResults.secondaryResults.results}catch{return[]}let s=[];for(let i of a||[]){let u=i.compactVideoRenderer;if(u){let f=Is(u,n);f&&s.push(f)}else{let f=i.compactAutoplayRenderer||i.itemSectionRenderer;if(!f||!Array.isArray(f.contents))continue;for(let p of f.contents){let b=Is(p.compactVideoRenderer,n);b&&s.push(b)}}}return s};st.getLikes=r=>{try{let i=r.response.contents.twoColumnWatchNextResults.results.results.contents.find(u=>u.videoPrimaryInfoRenderer).videoPrimaryInfoRenderer.videoActions.menuRenderer.topLevelButtons.find(u=>u.toggleButtonRenderer&&u.toggleButtonRenderer.defaultIcon.iconType==="LIKE");return parseInt(i.toggleButtonRenderer.defaultText.accessibility.accessibilityData.label.replace(/\D+/g,""))}catch{return null}};st.getDislikes=r=>{try{let i=r.response.contents.twoColumnWatchNextResults.results.results.contents.find(u=>u.videoPrimaryInfoRenderer).videoPrimaryInfoRenderer.videoActions.menuRenderer.topLevelButtons.find(u=>u.toggleButtonRenderer&&u.toggleButtonRenderer.defaultIcon.iconType==="DISLIKE");return parseInt(i.toggleButtonRenderer.defaultText.accessibility.accessibilityData.label.replace(/\D+/g,""))}catch{return null}};st.cleanVideoDetails=(r,n)=>(r.thumbnails=r.thumbnail.thumbnails,delete r.thumbnail,Wt.deprecate(r,"thumbnail",{thumbnails:r.thumbnails},"videoDetails.thumbnail.thumbnails","videoDetails.thumbnails"),r.description=r.shortDescription||me(r.description),delete r.shortDescription,Wt.deprecate(r,"shortDescription",r.description,"videoDetails.shortDescription","videoDetails.description"),r.lengthSeconds=n.player_response.microformat&&n.player_response.microformat.playerMicroformatRenderer.lengthSeconds||n.player_response.videoDetails.lengthSeconds,r);st.getStoryboards=r=>{let n=r.player_response.storyboards&&r.player_response.storyboards.playerStoryboardSpecRenderer&&r.player_response.storyboards.playerStoryboardSpecRenderer.spec&&r.player_response.storyboards.playerStoryboardSpecRenderer.spec.split("|");if(!n)return[];let a=new URL(n.shift());return n.map((s,i)=>{let[u,f,p,b,m,_,v,P]=s.split("#");a.searchParams.set("sigh",P),p=parseInt(p,10),b=parseInt(b,10),m=parseInt(m,10);let A=Math.ceil(p/(b*m));return{templateUrl:a.toString().replace("$L",i).replace("$N",v),thumbnailWidth:parseInt(u,10),thumbnailHeight:parseInt(f,10),thumbnailCount:p,interval:parseInt(_,10),columns:b,rows:m,storyboardCount:A}})};st.getChapters=r=>{let n=r.response&&r.response.playerOverlays&&r.response.playerOverlays.playerOverlayRenderer,a=n&&n.decoratedPlayerBarRenderer&&n.decoratedPlayerBarRenderer.decoratedPlayerBarRenderer&&n.decoratedPlayerBarRenderer.decoratedPlayerBarRenderer.playerBar,s=a&&a.multiMarkersPlayerBarRenderer&&a.multiMarkersPlayerBarRenderer.markersMap,i=Array.isArray(s)&&s.find(f=>f.value&&Array.isArray(f.value.chapters));return i?i.value.chapters.map(f=>({title:me(f.chapterRenderer.title),start_time:f.chapterRenderer.timeRangeStartMillis/1e3})):[]}});var Xa=te((Hm,Ls)=>{var{setTimeout:Kc}=require("timers");Ls.exports=class extends Map{constructor(n=1e3){super(),this.timeout=n}set(n,a){this.has(n)&&clearTimeout(super.get(n).tid),super.set(n,{tid:Kc(this.delete.bind(this,n),this.timeout).unref(),value:a})}get(n){let a=super.get(n);return a?a.value:null}getOrSet(n,a){if(this.has(n))return this.get(n);{let s=a();return this.set(n,s),(async()=>{try{await s}catch{this.delete(n)}})(),s}}delete(n){let a=super.get(n);a&&(clearTimeout(a.tid),super.delete(n))}clear(){for(let n of this.values())clearTimeout(n.tid);super.clear()}}});var Za=te($e=>{var Jc=require("querystring"),ed=Xa(),wt=ir(),Os=require("vm");$e.cache=new ed;$e.getFunctions=(r,n)=>$e.cache.getOrSet(r,async()=>{let a=await wt.exposedMiniget(r,n).text(),s=$e.extractFunctions(a);if(!s||!s.length)throw Error("Could not extract functions");return $e.cache.set(r,s),s});$e.extractFunctions=r=>{let n=[],a=u=>{let f=wt.between(u,'a=a.split("");',".");if(!f)return"";let p=`var ${f}={`,b=r.indexOf(p);if(b<0)return"";let m=r.slice(b+p.length-1);return`var ${f}=${wt.cutAfterJS(m)}`},s=()=>{let u=wt.between(r,'a.set("alr","yes");c&&(c=',"(decodeURIC");if(u&&u.length){let f=`${u}=function(a)`,p=r.indexOf(f);if(p>=0){let b=r.slice(p+f.length),m=`var ${f}${wt.cutAfterJS(b)}`;m=`${a(m)};${m};${u}(sig);`,n.push(m)}}},i=()=>{let u=wt.between(r,'&&(b=a.get("n"))&&(b=',"(b)");if(u.includes("[")&&(u=wt.between(r,`var ${u.split("[")[0]}=[`,"]")),u&&u.length){let f=`${u}=function(a)`,p=r.indexOf(f);if(p>=0){let b=r.slice(p+f.length),m=`var ${f}${wt.cutAfterJS(b)};${u}(ncode);`;n.push(m)}}};return s(),i(),n};$e.setDownloadURL=(r,n,a)=>{let s=p=>{let b=Jc.parse(p);if(!b.s||!n)return b.url;let m=new URL(decodeURIComponent(b.url));return m.searchParams.set(b.sp?b.sp:"signature",n.runInNewContext({sig:decodeURIComponent(b.s)})),m.toString()},i=p=>{let b=new URL(decodeURIComponent(p)),m=b.searchParams.get("n");return!m||!a?p:(b.searchParams.set("n",a.runInNewContext({ncode:m})),b.toString())},u=!r.url,f=r.url||r.signatureCipher||r.cipher;r.url=i(u?s(f):f),delete r.signatureCipher,delete r.cipher};$e.decipherFormats=async(r,n,a)=>{let s={},i=await $e.getFunctions(n,a),u=i.length?new Os.Script(i[0]):null,f=i.length>1?new Os.Script(i[1]):null;return r.forEach(p=>{$e.setDownloadURL(p,u,f),s[p.url]=p}),s}});var Ns=te(ue=>{var td=require("querystring"),rd=Fa(),qs=Br(),qe=ir(),{setTimeout:nd}=require("timers"),Fs=Wa(),Fr=Ua(),Tt=Bs(),ad=Za(),ti=Xa(),qr="https://www.youtube.com/watch?v=";ue.cache=new ti;ue.cookieCache=new ti(1e3*60*60*24);ue.watchPageCache=new ti;var ri="2.20210622.10.00",Ut=class extends Error{},id=["support.google.com/youtube/?p=age_restrictions","youtube.com/t/community_guidelines"];ue.getBasicInfo=async(r,n)=>{n.IPv6Block&&(n.requestOptions=Object.assign({},n.requestOptions,{family:6,localAddress:qe.getRandomIPv6(n.IPv6Block)}));let a=Object.assign({},qs.defaultOptions,n.requestOptions);n.requestOptions=Object.assign({},n.requestOptions,{}),n.requestOptions.headers=Object.assign({},{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.101 Safari/537.36"},n.requestOptions.headers);let i=await fd([r,n],p=>{let b=qe.playError(p.player_response,["ERROR"],Ut),m=od(p.player_response);if(b||m)throw b||m;return p&&p.player_response&&(p.player_response.streamingData||sd(p.player_response)||ld(p.player_response))},a,[yd,bd,wd]);Object.assign(i,{formats:Td(i.player_response),related_videos:Tt.getRelatedVideos(i)});let u=Tt.getMedia(i),f={author:Tt.getAuthor(i),media:u,likes:Tt.getLikes(i),dislikes:Tt.getDislikes(i),age_restricted:!!(u&&id.some(p=>Object.values(u).some(b=>typeof b=="string"&&b.includes(p)))),video_url:qr+r,storyboards:Tt.getStoryboards(i),chapters:Tt.getChapters(i)};return i.videoDetails=Tt.cleanVideoDetails(Object.assign({},i.player_response&&i.player_response.microformat&&i.player_response.microformat.playerMicroformatRenderer,i.player_response&&i.player_response.videoDetails,f),i),i};var od=r=>{let n=r&&r.playabilityStatus;return n&&n.status==="LOGIN_REQUIRED"&&n.messages&&n.messages.filter(a=>/This is a private video/.test(a)).length?new Ut(n.reason||n.messages&&n.messages[0]):null},sd=r=>{let n=r.playabilityStatus;return n&&n.status==="UNPLAYABLE"&&n.errorScreen&&n.errorScreen.playerLegacyDesktopYpcOfferRenderer},ld=r=>{let n=r.playabilityStatus;return n&&n.status==="LIVE_STREAM_OFFLINE"},ks=(r,n)=>`${qr+r}&hl=${n.lang||"en"}`,ni=(r,n)=>{let a=ks(r,n);return ue.watchPageCache.getOrSet(a,()=>qe.exposedMiniget(a,n).text())},ud="https://www.youtube.com/embed/",cd=(r,n)=>{let a=`${ud+r}?hl=${n.lang||"en"}`;return qe.exposedMiniget(a,n).text()},ei=r=>{let n=/<script\s+src="([^"]+)"(?:\s+type="text\/javascript")?\s+name="player_ias\/base"\s*>|"jsUrl":"([^"]+)"/.exec(r);return n?n[1]||n[2]:null},dd=(r,n,a,s)=>ue.cookieCache.getOrSet(a,async()=>{let u=(await ni(r,n)).match(/(["'])ID_TOKEN\1[:,]\s?"([^"]+)"/);if(!u&&s)throw new Ut("Cookie header used in request, but unable to find YouTube identity token");return u&&u[2]}),fd=async(r,n,a,s)=>{let i;for(let u of s)try{let f=await md(u,r.concat([i]),a);if(f.player_response&&(f.player_response.videoDetails=Ka(i&&i.player_response&&i.player_response.videoDetails,f.player_response.videoDetails),f.player_response=Ka(i&&i.player_response,f.player_response)),i=Ka(i,f),n(i,!1))break}catch(f){if(f instanceof Ut||u===s[s.length-1])throw f}return i},Ka=(r,n)=>{if(!r||!n)return r||n;for(let[a,s]of Object.entries(n))s!=null&&(r[a]=s);return r},md=async(r,n,a)=>{let s=0,i;for(;s<=a.maxRetries;)try{i=await r(...n);break}catch(u){if(u instanceof Ut||u instanceof qs.MinigetError&&u.statusCode<500||s>=a.maxRetries)throw u;let f=Math.min(++s*a.backoff.inc,a.backoff.max);await new Promise(p=>nd(p,f))}return i},hd=/^[)\]}'\s]+/,ai=(r,n,a)=>{if(!a||typeof a=="object")return a;try{return a=a.replace(hd,""),JSON.parse(a)}catch(s){throw Error(`Error parsing ${n} in ${r}: ${s.message}`)}},Ja=(r,n,a,s,i,u)=>{let f=qe.between(a,s,i);if(!f)throw Error(`Could not find ${n} in ${r}`);return ai(r,n,qe.cutAfterJS(`${u}${f}`))},ii=(r,n)=>{let a=n&&(n.args&&n.args.player_response||n.player_response||n.playerResponse||n.embedded_player_response);return ai(r,"player_response",a)},pd=(r,n)=>`${ks(r,n)}&pbj=1`,bd=async(r,n)=>{let a=Object.assign({headers:{}},n.requestOptions),s=a.headers.Cookie||a.headers.cookie;a.headers=Object.assign({"x-youtube-client-name":"1","x-youtube-client-version":ri,"x-youtube-identity-token":ue.cookieCache.get(s||"browser")||""},a.headers);let i=async(m,_)=>{a.headers["x-youtube-identity-token"]||(a.headers["x-youtube-identity-token"]=await dd(r,n,m,_))};s&&await i(s,!0);let u=pd(r,n),f=await qe.exposedMiniget(u,n,a).text(),p=ai("watch.json","body",f);if(p.reload==="now"&&await i("browser",!1),p.reload==="now"||!Array.isArray(p))throw Error("Unable to retrieve video metadata in watch.json");let b=p.reduce((m,_)=>Object.assign(_,m),{});return b.player_response=ii("watch.json",b),b.html5player=b.player&&b.player.assets&&b.player.assets.js,b},yd=async(r,n)=>{let a=await ni(r,n),s={page:"watch"};try{ri=qe.between(a,'{"key":"cver","value":"','"}'),s.player_response=Ja("watch.html","player_response",a,/\bytInitialPlayerResponse\s*=\s*\{/i,"</script>","{")}catch{let u=Ja("watch.html","player_response",a,/\bytplayer\.config\s*=\s*{/,"</script>","{");s.player_response=ii("watch.html",u)}return s.response=Ja("watch.html","response",a,/\bytInitialData("\])?\s*=\s*\{/i,"</script>","{"),s.html5player=ei(a),s},gd="www.youtube.com",_d="/get_video_info",Sd="https://youtube.googleapis.com/v/",wd=async(r,n)=>{let a=new URL(`https://${gd}${_d}`);a.searchParams.set("video_id",r),a.searchParams.set("c","TVHTML5"),a.searchParams.set("cver",`7${ri.substr(1)}`),a.searchParams.set("eurl",Sd+r),a.searchParams.set("ps","default"),a.searchParams.set("gl","US"),a.searchParams.set("hl",n.lang||"en"),a.searchParams.set("html5","1");let s=await qe.exposedMiniget(a.toString(),n).text(),i=td.parse(s);return i.player_response=ii("get_video_info",i),i},Td=r=>{let n=[];return r&&r.streamingData&&(n=n.concat(r.streamingData.formats||[]).concat(r.streamingData.adaptiveFormats||[])),n};ue.getInfo=async(r,n)=>{let a=await ue.getBasicInfo(r,n),s=a.player_response&&a.player_response.streamingData&&(a.player_response.streamingData.dashManifestUrl||a.player_response.streamingData.hlsManifestUrl),i=[];if(a.formats.length){if(a.html5player=a.html5player||ei(await ni(r,n))||ei(await cd(r,n)),!a.html5player)throw Error("Unable to find html5player file");let f=new URL(a.html5player,qr).toString();i.push(ad.decipherFormats(a.formats,f,n))}if(s&&a.player_response.streamingData.dashManifestUrl){let f=a.player_response.streamingData.dashManifestUrl;i.push(Rd(f,n))}if(s&&a.player_response.streamingData.hlsManifestUrl){let f=a.player_response.streamingData.hlsManifestUrl;i.push(vd(f,n))}let u=await Promise.all(i);return a.formats=Object.values(Object.assign({},...u)),a.formats=a.formats.map(Fs.addFormatMeta),a.formats.sort(Fs.sortFormats),a.full=!0,a};var Rd=(r,n)=>new Promise((a,s)=>{let i={},u=rd.parser(!1);u.onerror=s;let f;u.onopentag=b=>{if(b.name==="ADAPTATIONSET")f=b.attributes;else if(b.name==="REPRESENTATION"){let m=parseInt(b.attributes.ID);isNaN(m)||(i[r]=Object.assign({itag:m,url:r,bitrate:parseInt(b.attributes.BANDWIDTH),mimeType:`${f.MIMETYPE}; codecs="${b.attributes.CODECS}"`},b.attributes.HEIGHT?{width:parseInt(b.attributes.WIDTH),height:parseInt(b.attributes.HEIGHT),fps:parseInt(b.attributes.FRAMERATE)}:{audioSampleRate:b.attributes.AUDIOSAMPLINGRATE}))}},u.onend=()=>{a(i)};let p=qe.exposedMiniget(new URL(r,qr).toString(),n);p.setEncoding("utf8"),p.on("error",s),p.on("data",b=>{u.write(b)}),p.on("end",u.close.bind(u))}),vd=async(r,n)=>{r=new URL(r,qr);let a=await qe.exposedMiniget(r.toString(),n).text(),s={};return a.split(`
`).filter(i=>/^https?:\/\//.test(i)).forEach(i=>{let u=parseInt(i.match(/\/itag\/(\d+)\//)[1]);s[i]={itag:u,url:i}}),s};for(let r of["getBasicInfo","getInfo"]){let n=ue[r];ue[r]=async(a,s={})=>{qe.checkForUpdates();let i=await Fr.getVideoID(a),u=[r,i,s.lang].join("-");return ue.cache.getOrSet(u,()=>n(i,s))}}ue.validateID=Fr.validateID;ue.validateURL=Fr.validateURL;ue.getURLVideoID=Fr.getURLVideoID;ue.getVideoID=Fr.getVideoID});var li=te((Qm,Vs)=>{var Ed=require("stream").PassThrough,kr=Ns(),Ms=ir(),si=Wa(),Bn=Ua(),Ad=Za(),xs=Br(),Cd=Dn(),{parseTimestamp:Pd}=Dn(),Pe=(r,n)=>{let a=Ws(n);return Pe.getInfo(r,n).then(s=>{Us(a,s,n)},a.emit.bind(a,"error")),a};Vs.exports=Pe;Pe.getBasicInfo=kr.getBasicInfo;Pe.getInfo=kr.getInfo;Pe.chooseFormat=si.chooseFormat;Pe.filterFormats=si.filterFormats;Pe.validateID=Bn.validateID;Pe.validateURL=Bn.validateURL;Pe.getURLVideoID=Bn.getURLVideoID;Pe.getVideoID=Bn.getVideoID;Pe.cache={sig:Ad.cache,info:kr.cache,watch:kr.watchPageCache,cookie:kr.cookieCache};Pe.version=ka().version;var Ws=r=>{let n=new Ed({highWaterMark:r&&r.highWaterMark||524288});return n._destroy=()=>{n.destroyed=!0},n},oi=(r,n,a)=>{["abort","request","response","error","redirect","retry","reconnect"].forEach(s=>{r.prependListener(s,n.emit.bind(n,s))}),r.pipe(n,{end:a})},Us=(r,n,a)=>{a=a||{};let s=Ms.playError(n.player_response,["UNPLAYABLE","LIVE_STREAM_OFFLINE","LOGIN_REQUIRED"]);if(s){r.emit("error",s);return}if(!n.formats.length){r.emit("error",Error("This video is unavailable"));return}let i;try{i=si.chooseFormat(n.formats,a)}catch(v){r.emit("error",v);return}if(r.emit("info",n,i),r.destroyed)return;let u,f=0,p=v=>{f+=v.length,r.emit("progress",v.length,f,u)};a.IPv6Block&&(a.requestOptions=Object.assign({},a.requestOptions,{family:6,localAddress:Ms.getRandomIPv6(a.IPv6Block)}));let b=a.dlChunkSize||1024*1024*10,m,_=!0;if(i.isHLS||i.isDashMPD)m=Cd(i.url,{chunkReadahead:+n.live_chunk_readahead,begin:a.begin||i.isLive&&Date.now(),liveBuffer:a.liveBuffer,requestOptions:a.requestOptions,parser:i.isDashMPD?"dash-mpd":"m3u8",id:i.itag}),m.on("progress",(v,P)=>{r.emit("progress",v.size,v.num,P)}),oi(m,r,_);else{let v=Object.assign({},a.requestOptions,{maxReconnects:6,maxRetries:3,backoff:{inc:500,max:1e4}});if(b!==0&&(!i.hasAudio||!i.hasVideo)){let A=a.range&&a.range.start||0,R=A+b,N=a.range&&a.range.end;u=a.range?(N?N+1:parseInt(i.contentLength))-A:parseInt(i.contentLength);let O=()=>{!N&&R>=u&&(R=0),N&&R>N&&(R=N),_=!R||R===N,v.headers=Object.assign({},v.headers,{Range:`bytes=${A}-${R||""}`}),m=xs(i.url,v),m.on("data",p),m.on("end",()=>{r.destroyed||R&&R!==N&&(A=R+1,R+=b,O())}),oi(m,r,_)};O()}else a.begin&&(i.url+=`&begin=${Pd(a.begin)}`),a.range&&(a.range.start||a.range.end)&&(v.headers=Object.assign({},v.headers,{Range:`bytes=${a.range.start||"0"}-${a.range.end||""}`})),m=xs(i.url,v),m.on("response",A=>{r.destroyed||(u=u||parseInt(A.headers["content-length"]))}),m.on("data",p),oi(m,r,_)}r._destroy=()=>{r.destroyed=!0,m.destroy(),m.end()}};Pe.downloadFromInfo=(r,n)=>{let a=Ws(n);if(!r.full)throw Error("Cannot use `ytdl.downloadFromInfo()` when called with info from `ytdl.getBasicInfo()`");return setImmediate(()=>{Us(a,r,n)}),a}});var rl=te(ut=>{"use strict";Object.defineProperty(ut,"__esModule",{value:!0});function nf(r,n,a,s){function i(u){return u instanceof a?u:new a(function(f){f(u)})}return new(a||(a=Promise))(function(u,f){function p(_){try{m(s.next(_))}catch(v){f(v)}}function b(_){try{m(s.throw(_))}catch(v){f(v)}}function m(_){_.done?u(_.value):i(_.value).then(p,b)}m((s=s.apply(r,n||[])).next())})}var af=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i,tl="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36,gzip(gfe)",of=/<text start="([^"]*)" dur="([^"]*)">([^<]*)<\/text>/g,lt=class extends Error{constructor(n){super(`[YoutubeTranscript] \u{1F6A8} ${n}`)}},Fn=class extends lt{constructor(){super("YouTube is receiving too many requests from this IP and now requires solving a captcha to continue")}},qn=class extends lt{constructor(n){super(`The video is no longer available (${n})`)}},Nr=class extends lt{constructor(n){super(`Transcript is disabled on this video (${n})`)}},Mr=class extends lt{constructor(n){super(`No transcripts are available for this video (${n})`)}},kn=class extends lt{constructor(n,a,s){super(`No transcripts are available in ${n} this video (${s}). Available languages: ${a.join(", ")}`)}},ci=class{static fetchTranscript(n,a){var s;return nf(this,void 0,void 0,function*(){let i=this.retrieveVideoId(n),f=yield(yield fetch(`https://www.youtube.com/watch?v=${i}`,{headers:Object.assign(Object.assign({},a?.lang&&{"Accept-Language":a.lang}),{"User-Agent":tl})})).text(),p=f.split('"captions":');if(p.length<=1)throw f.includes('class="g-recaptcha"')?new Fn:f.includes('"playabilityStatus":')?new Nr(n):new qn(n);let b=(s=(()=>{try{return JSON.parse(p[1].split(',"videoDetails')[0].replace(`
`,""))}catch{return}})())===null||s===void 0?void 0:s.playerCaptionsTracklistRenderer;if(!b)throw new Nr(n);if(!("captionTracks"in b))throw new Mr(n);if(a?.lang&&!b.captionTracks.some(A=>A.languageCode===a?.lang))throw new kn(a?.lang,b.captionTracks.map(A=>A.languageCode),n);let m=(a?.lang?b.captionTracks.find(A=>A.languageCode===a?.lang):b.captionTracks[0]).baseUrl,_=yield fetch(m,{headers:Object.assign(Object.assign({},a?.lang&&{"Accept-Language":a.lang}),{"User-Agent":tl})});if(!_.ok)throw new Mr(n);return[...(yield _.text()).matchAll(of)].map(A=>{var R;return{text:A[3],duration:parseFloat(A[2]),offset:parseFloat(A[1]),lang:(R=a?.lang)!==null&&R!==void 0?R:b.captionTracks[0].languageCode}})})}static retrieveVideoId(n){if(n.length===11)return n;let a=n.match(af);if(a&&a.length)return a[1];throw new lt("Impossible to retrieve Youtube video ID.")}};ut.YoutubeTranscript=ci;ut.YoutubeTranscriptDisabledError=Nr;ut.YoutubeTranscriptError=lt;ut.YoutubeTranscriptNotAvailableError=Mr;ut.YoutubeTranscriptNotAvailableLanguageError=kn;ut.YoutubeTranscriptTooManyRequestError=Fn;ut.YoutubeTranscriptVideoUnavailableError=qn});var sf={};So(sf,{default:()=>il});module.exports=Xu(sf);var Jo=We(require("node:http"),1),es=We(require("node:https"),1),kt=We(require("node:zlib"),1),Ce=We(require("node:stream"),1),Dr=require("node:buffer");function Zu(r){if(!/^data:/i.test(r))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');r=r.replace(/\r?\n/g,"");let n=r.indexOf(",");if(n===-1||n<=4)throw new TypeError("malformed data: URI");let a=r.substring(5,n).split(";"),s="",i=!1,u=a[0]||"text/plain",f=u;for(let _=1;_<a.length;_++)a[_]==="base64"?i=!0:a[_]&&(f+=`;${a[_]}`,a[_].indexOf("charset=")===0&&(s=a[_].substring(8)));!a[0]&&!s.length&&(f+=";charset=US-ASCII",s="US-ASCII");let p=i?"base64":"ascii",b=unescape(r.substring(n+1)),m=Buffer.from(b,p);return m.type=u,m.typeFull=f,m.charset=s,m}var To=Zu;var Le=We(require("node:stream"),1),it=require("node:util"),Ee=require("node:buffer");vr();yn();var at=class extends Error{constructor(n,a){super(n),Error.captureStackTrace(this,this.constructor),this.type=a}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}};var ge=class extends at{constructor(n,a,s){super(n,a),s&&(this.code=this.errno=s.code,this.erroredSysCall=s.syscall)}};var gn=Symbol.toStringTag,ga=r=>typeof r=="object"&&typeof r.append=="function"&&typeof r.delete=="function"&&typeof r.get=="function"&&typeof r.getAll=="function"&&typeof r.has=="function"&&typeof r.set=="function"&&typeof r.sort=="function"&&r[gn]==="URLSearchParams",Ar=r=>r&&typeof r=="object"&&typeof r.arrayBuffer=="function"&&typeof r.type=="string"&&typeof r.stream=="function"&&typeof r.constructor=="function"&&/^(Blob|File)$/.test(r[gn]),Bo=r=>typeof r=="object"&&(r[gn]==="AbortSignal"||r[gn]==="EventTarget"),Lo=(r,n)=>{let a=new URL(n).hostname,s=new URL(r).hostname;return a===s||a.endsWith(`.${s}`)},Oo=(r,n)=>{let a=new URL(n).protocol,s=new URL(r).protocol;return a===s};var fc=(0,it.promisify)(Le.default.pipeline),_e=Symbol("Body internals"),Ge=class{constructor(n,{size:a=0}={}){let s=null;n===null?n=null:ga(n)?n=Ee.Buffer.from(n.toString()):Ar(n)||Ee.Buffer.isBuffer(n)||(it.types.isAnyArrayBuffer(n)?n=Ee.Buffer.from(n):ArrayBuffer.isView(n)?n=Ee.Buffer.from(n.buffer,n.byteOffset,n.byteLength):n instanceof Le.default||(n instanceof Ot?(n=Do(n),s=n.type.split("=")[1]):n=Ee.Buffer.from(String(n))));let i=n;Ee.Buffer.isBuffer(n)?i=Le.default.Readable.from(n):Ar(n)&&(i=Le.default.Readable.from(n.stream())),this[_e]={body:n,stream:i,boundary:s,disturbed:!1,error:null},this.size=a,n instanceof Le.default&&n.on("error",u=>{let f=u instanceof at?u:new ge(`Invalid response body while trying to fetch ${this.url}: ${u.message}`,"system",u);this[_e].error=f})}get body(){return this[_e].stream}get bodyUsed(){return this[_e].disturbed}async arrayBuffer(){let{buffer:n,byteOffset:a,byteLength:s}=await wa(this);return n.slice(a,a+s)}async formData(){let n=this.headers.get("content-type");if(n.startsWith("application/x-www-form-urlencoded")){let s=new Ot,i=new URLSearchParams(await this.text());for(let[u,f]of i)s.append(u,f);return s}let{toFormData:a}=await Promise.resolve().then(()=>(Mo(),No));return a(this.body,n)}async blob(){let n=this.headers&&this.headers.get("content-type")||this[_e].body&&this[_e].body.type||"",a=await this.arrayBuffer();return new nt([a],{type:n})}async json(){let n=await this.text();return JSON.parse(n)}async text(){let n=await wa(this);return new TextDecoder().decode(n)}buffer(){return wa(this)}};Ge.prototype.buffer=(0,it.deprecate)(Ge.prototype.buffer,"Please use 'response.arrayBuffer()' instead of 'response.buffer()'","node-fetch#buffer");Object.defineProperties(Ge.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},data:{get:(0,it.deprecate)(()=>{},"data doesn't exist, use json(), text(), arrayBuffer(), or body instead","https://github.com/node-fetch/node-fetch/issues/1000 (response)")}});async function wa(r){if(r[_e].disturbed)throw new TypeError(`body used already for: ${r.url}`);if(r[_e].disturbed=!0,r[_e].error)throw r[_e].error;let{body:n}=r;if(n===null)return Ee.Buffer.alloc(0);if(!(n instanceof Le.default))return Ee.Buffer.alloc(0);let a=[],s=0;try{for await(let i of n){if(r.size>0&&s+i.length>r.size){let u=new ge(`content size at ${r.url} over limit: ${r.size}`,"max-size");throw n.destroy(u),u}s+=i.length,a.push(i)}}catch(i){throw i instanceof at?i:new ge(`Invalid response body while trying to fetch ${r.url}: ${i.message}`,"system",i)}if(n.readableEnded===!0||n._readableState.ended===!0)try{return a.every(i=>typeof i=="string")?Ee.Buffer.from(a.join("")):Ee.Buffer.concat(a,s)}catch(i){throw new ge(`Could not create Buffer from response body for ${r.url}: ${i.message}`,"system",i)}else throw new ge(`Premature close of server response while trying to fetch ${r.url}`)}var rr=(r,n)=>{let a,s,{body:i}=r[_e];if(r.bodyUsed)throw new Error("cannot clone body after it is used");return i instanceof Le.default&&typeof i.getBoundary!="function"&&(a=new Le.PassThrough({highWaterMark:n}),s=new Le.PassThrough({highWaterMark:n}),i.pipe(a),i.pipe(s),r[_e].stream=a,i=s),i},mc=(0,it.deprecate)(r=>r.getBoundary(),"form-data doesn't follow the spec and requires special treatment. Use alternative package","https://github.com/node-fetch/node-fetch/issues/1167"),Tn=(r,n)=>r===null?null:typeof r=="string"?"text/plain;charset=UTF-8":ga(r)?"application/x-www-form-urlencoded;charset=UTF-8":Ar(r)?r.type||null:Ee.Buffer.isBuffer(r)||it.types.isAnyArrayBuffer(r)||ArrayBuffer.isView(r)?null:r instanceof Ot?`multipart/form-data; boundary=${n[_e].boundary}`:r&&typeof r.getBoundary=="function"?`multipart/form-data;boundary=${mc(r)}`:r instanceof Le.default?null:"text/plain;charset=UTF-8",xo=r=>{let{body:n}=r[_e];return n===null?0:Ar(n)?n.size:Ee.Buffer.isBuffer(n)?n.length:n&&typeof n.getLengthSync=="function"&&n.hasKnownLength&&n.hasKnownLength()?n.getLengthSync():null},Wo=async(r,{body:n})=>{n===null?r.end():await fc(n,r)};var Ta=require("node:util"),Pr=We(require("node:http"),1),Rn=typeof Pr.default.validateHeaderName=="function"?Pr.default.validateHeaderName:r=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(r)){let n=new TypeError(`Header name must be a valid HTTP token [${r}]`);throw Object.defineProperty(n,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),n}},Ra=typeof Pr.default.validateHeaderValue=="function"?Pr.default.validateHeaderValue:(r,n)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(n)){let a=new TypeError(`Invalid character in header content ["${r}"]`);throw Object.defineProperty(a,"code",{value:"ERR_INVALID_CHAR"}),a}},Ae=class r extends URLSearchParams{constructor(n){let a=[];if(n instanceof r){let s=n.raw();for(let[i,u]of Object.entries(s))a.push(...u.map(f=>[i,f]))}else if(n!=null)if(typeof n=="object"&&!Ta.types.isBoxedPrimitive(n)){let s=n[Symbol.iterator];if(s==null)a.push(...Object.entries(n));else{if(typeof s!="function")throw new TypeError("Header pairs must be iterable");a=[...n].map(i=>{if(typeof i!="object"||Ta.types.isBoxedPrimitive(i))throw new TypeError("Each header pair must be an iterable object");return[...i]}).map(i=>{if(i.length!==2)throw new TypeError("Each header pair must be a name/value tuple");return[...i]})}}else throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");return a=a.length>0?a.map(([s,i])=>(Rn(s),Ra(s,String(i)),[String(s).toLowerCase(),String(i)])):void 0,super(a),new Proxy(this,{get(s,i,u){switch(i){case"append":case"set":return(f,p)=>(Rn(f),Ra(f,String(p)),URLSearchParams.prototype[i].call(s,String(f).toLowerCase(),String(p)));case"delete":case"has":case"getAll":return f=>(Rn(f),URLSearchParams.prototype[i].call(s,String(f).toLowerCase()));case"keys":return()=>(s.sort(),new Set(URLSearchParams.prototype.keys.call(s)).keys());default:return Reflect.get(s,i,u)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(n){let a=this.getAll(n);if(a.length===0)return null;let s=a.join(", ");return/^content-encoding$/i.test(n)&&(s=s.toLowerCase()),s}forEach(n,a=void 0){for(let s of this.keys())Reflect.apply(n,a,[this.get(s),s,this])}*values(){for(let n of this.keys())yield this.get(n)}*entries(){for(let n of this.keys())yield[n,this.get(n)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((n,a)=>(n[a]=this.getAll(a),n),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((n,a)=>{let s=this.getAll(a);return a==="host"?n[a]=s[0]:n[a]=s.length>1?s:s[0],n},{})}};Object.defineProperties(Ae.prototype,["get","entries","forEach","values"].reduce((r,n)=>(r[n]={enumerable:!0},r),{}));function Uo(r=[]){return new Ae(r.reduce((n,a,s,i)=>(s%2===0&&n.push(i.slice(s,s+2)),n),[]).filter(([n,a])=>{try{return Rn(n),Ra(n,String(a)),!0}catch{return!1}}))}var hc=new Set([301,302,303,307,308]),vn=r=>hc.has(r);var Ue=Symbol("Response internals"),Oe=class r extends Ge{constructor(n=null,a={}){super(n,a);let s=a.status!=null?a.status:200,i=new Ae(a.headers);if(n!==null&&!i.has("Content-Type")){let u=Tn(n,this);u&&i.append("Content-Type",u)}this[Ue]={type:"default",url:a.url,status:s,statusText:a.statusText||"",headers:i,counter:a.counter,highWaterMark:a.highWaterMark}}get type(){return this[Ue].type}get url(){return this[Ue].url||""}get status(){return this[Ue].status}get ok(){return this[Ue].status>=200&&this[Ue].status<300}get redirected(){return this[Ue].counter>0}get statusText(){return this[Ue].statusText}get headers(){return this[Ue].headers}get highWaterMark(){return this[Ue].highWaterMark}clone(){return new r(rr(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(n,a=302){if(!vn(a))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new r(null,{headers:{location:new URL(n).toString()},status:a})}static error(){let n=new r(null,{status:0,statusText:""});return n[Ue].type="error",n}static json(n=void 0,a={}){let s=JSON.stringify(n);if(s===void 0)throw new TypeError("data is not JSON serializable");let i=new Ae(a&&a.headers);return i.has("content-type")||i.set("content-type","application/json"),new r(s,{...a,headers:i})}get[Symbol.toStringTag](){return"Response"}};Object.defineProperties(Oe.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}});var Xo=require("node:url"),Zo=require("node:util");var Vo=r=>{if(r.search)return r.search;let n=r.href.length-1,a=r.hash||(r.href[n]==="#"?"#":"");return r.href[n-a.length]==="?"?"?":""};var jo=require("node:net");function $o(r,n=!1){return r==null||(r=new URL(r),/^(about|blob|data):$/.test(r.protocol))?"no-referrer":(r.username="",r.password="",r.hash="",n&&(r.pathname="",r.search=""),r)}var zo=new Set(["","no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url"]),Ho="strict-origin-when-cross-origin";function Go(r){if(!zo.has(r))throw new TypeError(`Invalid referrerPolicy: ${r}`);return r}function pc(r){if(/^(http|ws)s:$/.test(r.protocol))return!0;let n=r.host.replace(/(^\[)|(]$)/g,""),a=(0,jo.isIP)(n);return a===4&&/^127\./.test(n)||a===6&&/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(n)?!0:r.host==="localhost"||r.host.endsWith(".localhost")?!1:r.protocol==="file:"}function nr(r){return/^about:(blank|srcdoc)$/.test(r)||r.protocol==="data:"||/^(blob|filesystem):$/.test(r.protocol)?!0:pc(r)}function Yo(r,{referrerURLCallback:n,referrerOriginCallback:a}={}){if(r.referrer==="no-referrer"||r.referrerPolicy==="")return null;let s=r.referrerPolicy;if(r.referrer==="about:client")return"no-referrer";let i=r.referrer,u=$o(i),f=$o(i,!0);u.toString().length>4096&&(u=f),n&&(u=n(u)),a&&(f=a(f));let p=new URL(r.url);switch(s){case"no-referrer":return"no-referrer";case"origin":return f;case"unsafe-url":return u;case"strict-origin":return nr(u)&&!nr(p)?"no-referrer":f.toString();case"strict-origin-when-cross-origin":return u.origin===p.origin?u:nr(u)&&!nr(p)?"no-referrer":f;case"same-origin":return u.origin===p.origin?u:"no-referrer";case"origin-when-cross-origin":return u.origin===p.origin?u:f;case"no-referrer-when-downgrade":return nr(u)&&!nr(p)?"no-referrer":u;default:throw new TypeError(`Invalid referrerPolicy: ${s}`)}}function Qo(r){let n=(r.get("referrer-policy")||"").split(/[,\s]+/),a="";for(let s of n)s&&zo.has(s)&&(a=s);return a}var le=Symbol("Request internals"),Ir=r=>typeof r=="object"&&typeof r[le]=="object",bc=(0,Zo.deprecate)(()=>{},".data is not a valid RequestInit property, use .body instead","https://github.com/node-fetch/node-fetch/issues/1000 (request)"),qt=class r extends Ge{constructor(n,a={}){let s;if(Ir(n)?s=new URL(n.url):(s=new URL(n),n={}),s.username!==""||s.password!=="")throw new TypeError(`${s} is an url with embedded credentials.`);let i=a.method||n.method||"GET";if(/^(delete|get|head|options|post|put)$/i.test(i)&&(i=i.toUpperCase()),!Ir(a)&&"data"in a&&bc(),(a.body!=null||Ir(n)&&n.body!==null)&&(i==="GET"||i==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");let u=a.body?a.body:Ir(n)&&n.body!==null?rr(n):null;super(u,{size:a.size||n.size||0});let f=new Ae(a.headers||n.headers||{});if(u!==null&&!f.has("Content-Type")){let m=Tn(u,this);m&&f.set("Content-Type",m)}let p=Ir(n)?n.signal:null;if("signal"in a&&(p=a.signal),p!=null&&!Bo(p))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");let b=a.referrer==null?n.referrer:a.referrer;if(b==="")b="no-referrer";else if(b){let m=new URL(b);b=/^about:(\/\/)?client$/.test(m)?"client":m}else b=void 0;this[le]={method:i,redirect:a.redirect||n.redirect||"follow",headers:f,parsedURL:s,signal:p,referrer:b},this.follow=a.follow===void 0?n.follow===void 0?20:n.follow:a.follow,this.compress=a.compress===void 0?n.compress===void 0?!0:n.compress:a.compress,this.counter=a.counter||n.counter||0,this.agent=a.agent||n.agent,this.highWaterMark=a.highWaterMark||n.highWaterMark||16384,this.insecureHTTPParser=a.insecureHTTPParser||n.insecureHTTPParser||!1,this.referrerPolicy=a.referrerPolicy||n.referrerPolicy||""}get method(){return this[le].method}get url(){return(0,Xo.format)(this[le].parsedURL)}get headers(){return this[le].headers}get redirect(){return this[le].redirect}get signal(){return this[le].signal}get referrer(){if(this[le].referrer==="no-referrer")return"";if(this[le].referrer==="client")return"about:client";if(this[le].referrer)return this[le].referrer.toString()}get referrerPolicy(){return this[le].referrerPolicy}set referrerPolicy(n){this[le].referrerPolicy=Go(n)}clone(){return new r(this)}get[Symbol.toStringTag](){return"Request"}};Object.defineProperties(qt.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});var Ko=r=>{let{parsedURL:n}=r[le],a=new Ae(r[le].headers);a.has("Accept")||a.set("Accept","*/*");let s=null;if(r.body===null&&/^(post|put)$/i.test(r.method)&&(s="0"),r.body!==null){let p=xo(r);typeof p=="number"&&!Number.isNaN(p)&&(s=String(p))}s&&a.set("Content-Length",s),r.referrerPolicy===""&&(r.referrerPolicy=Ho),r.referrer&&r.referrer!=="no-referrer"?r[le].referrer=Yo(r):r[le].referrer="no-referrer",r[le].referrer instanceof URL&&a.set("Referer",r.referrer),a.has("User-Agent")||a.set("User-Agent","node-fetch"),r.compress&&!a.has("Accept-Encoding")&&a.set("Accept-Encoding","gzip, deflate, br");let{agent:i}=r;typeof i=="function"&&(i=i(n));let u=Vo(n),f={path:n.pathname+u,method:r.method,headers:a[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:r.insecureHTTPParser,agent:i};return{parsedURL:n,options:f}};var En=class extends at{constructor(n,a="aborted"){super(n,a)}};yn();_a();var yc=new Set(["data:","http:","https:"]);async function An(r,n){return new Promise((a,s)=>{let i=new qt(r,n),{parsedURL:u,options:f}=Ko(i);if(!yc.has(u.protocol))throw new TypeError(`node-fetch cannot load ${r}. URL scheme "${u.protocol.replace(/:$/,"")}" is not supported.`);if(u.protocol==="data:"){let R=To(i.url),N=new Oe(R,{headers:{"Content-Type":R.typeFull}});a(N);return}let p=(u.protocol==="https:"?es.default:Jo.default).request,{signal:b}=i,m=null,_=()=>{let R=new En("The operation was aborted.");s(R),i.body&&i.body instanceof Ce.default.Readable&&i.body.destroy(R),!(!m||!m.body)&&m.body.emit("error",R)};if(b&&b.aborted){_();return}let v=()=>{_(),A()},P=p(u.toString(),f);b&&b.addEventListener("abort",v);let A=()=>{P.abort(),b&&b.removeEventListener("abort",v)};P.on("error",R=>{s(new ge(`request to ${i.url} failed, reason: ${R.message}`,"system",R)),A()}),gc(P,R=>{m&&m.body&&m.body.destroy(R)}),process.version<"v14"&&P.on("socket",R=>{let N;R.prependListener("end",()=>{N=R._eventsCount}),R.prependListener("close",O=>{if(m&&N<R._eventsCount&&!O){let W=new Error("Premature close");W.code="ERR_STREAM_PREMATURE_CLOSE",m.body.emit("error",W)}})}),P.on("response",R=>{P.setTimeout(0);let N=Uo(R.rawHeaders);if(vn(R.statusCode)){let M=N.get("Location"),U=null;try{U=M===null?null:new URL(M,i.url)}catch{if(i.redirect!=="manual"){s(new ge(`uri requested responds with an invalid redirect URL: ${M}`,"invalid-redirect")),A();return}}switch(i.redirect){case"error":s(new ge(`uri requested responds with a redirect, redirect mode is set to error: ${i.url}`,"no-redirect")),A();return;case"manual":break;case"follow":{if(U===null)break;if(i.counter>=i.follow){s(new ge(`maximum redirect reached at: ${i.url}`,"max-redirect")),A();return}let V={headers:new Ae(i.headers),follow:i.follow,counter:i.counter+1,agent:i.agent,compress:i.compress,method:i.method,body:rr(i),signal:i.signal,size:i.size,referrer:i.referrer,referrerPolicy:i.referrerPolicy};if(!Lo(i.url,U)||!Oo(i.url,U))for(let g of["authorization","www-authenticate","cookie","cookie2"])V.headers.delete(g);if(R.statusCode!==303&&i.body&&n.body instanceof Ce.default.Readable){s(new ge("Cannot follow redirect with body being a readable stream","unsupported-redirect")),A();return}(R.statusCode===303||(R.statusCode===301||R.statusCode===302)&&i.method==="POST")&&(V.method="GET",V.body=void 0,V.headers.delete("content-length"));let Q=Qo(N);Q&&(V.referrerPolicy=Q),a(An(new qt(U,V))),A();return}default:return s(new TypeError(`Redirect option '${i.redirect}' is not a valid value of RequestRedirect`))}}b&&R.once("end",()=>{b.removeEventListener("abort",v)});let O=(0,Ce.pipeline)(R,new Ce.PassThrough,M=>{M&&s(M)});process.version<"v12.10"&&R.on("aborted",v);let W={url:i.url,status:R.statusCode,statusText:R.statusMessage,headers:N,size:i.size,counter:i.counter,highWaterMark:i.highWaterMark},I=N.get("Content-Encoding");if(!i.compress||i.method==="HEAD"||I===null||R.statusCode===204||R.statusCode===304){m=new Oe(O,W),a(m);return}let L={flush:kt.default.Z_SYNC_FLUSH,finishFlush:kt.default.Z_SYNC_FLUSH};if(I==="gzip"||I==="x-gzip"){O=(0,Ce.pipeline)(O,kt.default.createGunzip(L),M=>{M&&s(M)}),m=new Oe(O,W),a(m);return}if(I==="deflate"||I==="x-deflate"){let M=(0,Ce.pipeline)(R,new Ce.PassThrough,U=>{U&&s(U)});M.once("data",U=>{(U[0]&15)===8?O=(0,Ce.pipeline)(O,kt.default.createInflate(),V=>{V&&s(V)}):O=(0,Ce.pipeline)(O,kt.default.createInflateRaw(),V=>{V&&s(V)}),m=new Oe(O,W),a(m)}),M.once("end",()=>{m||(m=new Oe(O,W),a(m))});return}if(I==="br"){O=(0,Ce.pipeline)(O,kt.default.createBrotliDecompress(),M=>{M&&s(M)}),m=new Oe(O,W),a(m);return}m=new Oe(O,W),a(m)}),Wo(P,i).catch(s)})}function gc(r,n){let a=Dr.Buffer.from(`0\r
\r
`),s=!1,i=!1,u;r.on("response",f=>{let{headers:p}=f;s=p["transfer-encoding"]==="chunked"&&!p["content-length"]}),r.on("socket",f=>{let p=()=>{if(s&&!i){let m=new Error("Premature close");m.code="ERR_STREAM_PREMATURE_CLOSE",n(m)}},b=m=>{i=Dr.Buffer.compare(m.slice(-5),a)===0,!i&&u&&(i=Dr.Buffer.compare(u.slice(-3),a.slice(0,3))===0&&Dr.Buffer.compare(m.slice(-2),a.slice(3))===0),u=m};f.prependListener("close",p),f.on("data",b),r.on("close",()=>{f.removeListener("close",p),f.removeListener("data",b)})})}var dr=require("@raycast/api"),Rt=require("react");var Ye=require("@raycast/api");var Mt=require("@raycast/api");var va={title:"\u{1F4A1}",message:"Summarizing video"},Ea={title:"\u{1F4DD}",message:"Video summarized!"},Nt={title:"\u{1F6A8}"},Aa={title:"\u{1F50D}",message:"Answering your question"},Ca={title:"\u{1F517}",message:"Checking video URL"},Pa={title:"\u{1F517}",message:"Checking Browser Extension"},Ia={title:"\u{1F517}",message:"Checking Clipboard"};function ts(r,n,a){return`Summarize the following transcription of a youtube video as a list of the most important points each starting with a fitting emoji. Ignore Sponsor Segments and Video Sponsors. Answer in ${r}.
  
  Format:

  [Emoji] [List Item] &nbsp;&nbsp;
  
  Here is the transcript: ${n.length>0?n:a}`}function rs(r,n){return`The following text is the content of a video. Refer to it as video. You already summarized it for the person asking a question. Answer with a list starting with a fitting emoji. Ignore Sponsor Segments and Video Sponsors.
  
  Format:

  [Emoji] [List Item] &nbsp;&nbsp;
  
  Here is the transcript: ${n}. This is the question: ${r}`}var ns=async(r,n,a,s)=>{a(void 0);let i=(0,Mt.showToast)({style:Mt.Toast.Style.Animated,title:Aa.title,message:Aa.message}),u=Mt.AI.ask(rs(r,n));u.on("data",f=>{a(p=>p===void 0?f:p+f)}),u.finally(()=>{i.then(f=>f.hide())}),u.catch(f=>{i.then(p=>{p.style=Mt.Toast.Style.Failure,p.title=Nt.title,p.message=f.message})}),s()};var ar=require("react/jsx-runtime");function Da({transcript:r,setSummary:n,pop:a}){let s=i=>{ns(i,r,n,a)};return(0,ar.jsx)(Ye.Action.Push,{icon:Ye.Icon.QuestionMark,title:"Ask Follow-up Question",target:(0,ar.jsx)(Ye.Form,{actions:(0,ar.jsx)(Ye.ActionPanel,{children:(0,ar.jsx)(Ye.Action.SubmitForm,{title:"Ask",onSubmit:({question:i})=>s(i)})}),children:(0,ar.jsx)(Ye.Form.TextField,{id:"question",title:"Your Question"})})})}var ie=require("@raycast/api"),as=require("react");var is=async({transcript:r,setSummaryIsLoading:n,setSummary:a})=>{let s=(0,ie.getPreferenceValues)(),{creativity:i,language:u}=s;if(!ie.environment.canAccess(ie.AI)){(0,ie.showToast)({title:"No access to Raycast Pro",message:"Raycast Pro is required for this extension to work. You need Raycast Pro.",style:ie.Toast.Style.Failure}),(0,ie.popToRoot)();return}(0,as.useEffect)(()=>{if(!r)return;let f=ts(u,r,r),p=ie.AI.ask(f,{creativity:parseInt(i)});n(!0),(0,ie.showToast)({style:ie.Toast.Style.Animated,title:va.title,message:va.message}),p.on("data",b=>{a(m=>m===void 0?b:m+b)}),p.finally(()=>{n(!1),(0,ie.showToast)({style:ie.Toast.Style.Success,title:Ea.title,message:Ea.message})}),p.catch(b=>{(0,ie.showToast)({style:ie.Toast.Style.Failure,title:Nt.title,message:b.message})})},[r])};var ss=require("@raycast/api");var St=require("@raycast/api"),xt=require("react/jsx-runtime");function Ba({AskFollowUpQuestion:r,markdown:n,ownerProfileUrl:a,setSummary:s,transcript:i,video_url:u}){let{pop:f}=(0,St.useNavigation)();return(0,xt.jsxs)(St.ActionPanel,{title:"Video Actions",children:[(0,xt.jsx)(r,{transcript:i,setSummary:s,pop:f}),(0,xt.jsx)(St.Action.CopyToClipboard,{title:"Copy Result",content:n??""}),(0,xt.jsx)(St.Action.OpenInBrowser,{title:"Go to Video",url:u}),(0,xt.jsx)(St.Action.OpenInBrowser,{title:"Go to Channel",url:a})]})}var Fe=require("@raycast/api"),Ve=require("react/jsx-runtime"),os=(s=>(s.summarizeVideoWithRaycast="RaycastAI",s.summarizeVideoWithAnthropic="Anthropic",s.summarizeVideoWithOpenAI="OpenAI",s))(os||{});function La({duration:r,ownerChannelName:n,ownerProfileUrl:a,publishDate:s,title:i,viewCount:u}){let f=os[Fe.environment.commandName];return(0,Ve.jsxs)(Fe.Detail.Metadata,{children:[(0,Ve.jsx)(Fe.Detail.Metadata.Label,{title:"Title",text:i}),(0,Ve.jsx)(Fe.Detail.Metadata.Link,{title:"Channel",target:a,text:n}),(0,Ve.jsx)(Fe.Detail.Metadata.Separator,{}),(0,Ve.jsx)(Fe.Detail.Metadata.Label,{title:"Published",text:s}),(0,Ve.jsx)(Fe.Detail.Metadata.Label,{title:"Duration",text:r}),(0,Ve.jsx)(Fe.Detail.Metadata.Label,{title:"Views",text:u}),(0,Ve.jsx)(Fe.Detail.Metadata.Separator,{}),(0,Ve.jsx)(Fe.Detail.Metadata.Label,{title:"AI Model",text:f})]})}var Cn=require("react/jsx-runtime");function Oa({AskFollowUpQuestion:r,markdown:n,setSummary:a,summaryIsLoading:s,transcript:i,videoData:u}){if(!n)return null;let{duration:f,ownerChannelName:p,ownerProfileUrl:b,publishDate:m,title:_,video_url:v,viewCount:P}=u;return(0,Cn.jsx)(ss.Detail,{actions:(0,Cn.jsx)(Ba,{transcript:i,setSummary:a,markdown:n,video_url:v,ownerProfileUrl:b,AskFollowUpQuestion:r}),isLoading:s,markdown:n,metadata:(0,Cn.jsx)(La,{title:_,ownerChannelName:p,ownerProfileUrl:b,publishDate:m,duration:f,viewCount:P}),navigationTitle:u&&`${_} by ${p}`})}var oe=require("@raycast/api"),$s=require("react"),Ln=We(li());var js=async({input:r,setVideoURL:n})=>((0,$s.useEffect)(()=>{(async()=>{if((0,oe.showToast)({style:oe.Toast.Style.Animated,title:Ca.title,message:Ca.message}),r&&Ln.default.validateURL(r)){n(r);return}let s=await oe.Clipboard.readText(),i=s&&Ln.default.validateURL(s);if(!r&&i){(0,oe.showToast)({style:oe.Toast.Style.Animated,title:Ia.title,message:Ia.message}),n(s);return}if(!r&&oe.environment.canAccess(oe.BrowserExtension)){let f=(await oe.BrowserExtension.getTabs()).find(p=>p.active&&Ln.default.validateURL(p.url));if(f){(0,oe.showToast)({style:oe.Toast.Style.Animated,title:Pa.title,message:Pa.message}),n(f.url);return}}(0,oe.showToast)({style:oe.Toast.Style.Failure,title:"No video URL found",message:"Please provide a valid YouTube video URL or ID."}),(0,oe.popToRoot)()})()},[]),r);var Id={};function zs(){return Id}var Dd={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Hs=(r,n,a)=>{let s,i=Dd[r];return typeof i=="string"?s=i:n===1?s=i.one:s=i.other.replace("{{count}}",n.toString()),a?.addSuffix?a.comparison&&a.comparison>0?"in "+s:s+" ago":s};function On(r){return(n={})=>{let a=n.width?String(n.width):r.defaultWidth;return r.formats[a]||r.formats[r.defaultWidth]}}var Bd={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Ld={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Od={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Gs={date:On({formats:Bd,defaultWidth:"full"}),time:On({formats:Ld,defaultWidth:"full"}),dateTime:On({formats:Od,defaultWidth:"full"})};var Fd={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Ys=(r,n,a,s)=>Fd[r];function lr(r){return(n,a)=>{let s=a?.context?String(a.context):"standalone",i;if(s==="formatting"&&r.formattingValues){let f=r.defaultFormattingWidth||r.defaultWidth,p=a?.width?String(a.width):f;i=r.formattingValues[p]||r.formattingValues[f]}else{let f=r.defaultWidth,p=a?.width?String(a.width):r.defaultWidth;i=r.values[p]||r.values[f]}let u=r.argumentCallback?r.argumentCallback(n):n;return i[u]}}var qd={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},kd={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Nd={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Md={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},xd={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Wd={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Ud=(r,n)=>{let a=Number(r),s=a%100;if(s>20||s<10)switch(s%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd"}return a+"th"},Qs={ordinalNumber:Ud,era:lr({values:qd,defaultWidth:"wide"}),quarter:lr({values:kd,defaultWidth:"wide",argumentCallback:r=>r-1}),month:lr({values:Nd,defaultWidth:"wide"}),day:lr({values:Md,defaultWidth:"wide"}),dayPeriod:lr({values:xd,defaultWidth:"wide",formattingValues:Wd,defaultFormattingWidth:"wide"})};function ur(r){return(n,a={})=>{let s=a.width,i=s&&r.matchPatterns[s]||r.matchPatterns[r.defaultMatchWidth],u=n.match(i);if(!u)return null;let f=u[0],p=s&&r.parsePatterns[s]||r.parsePatterns[r.defaultParseWidth],b=Array.isArray(p)?$d(p,v=>v.test(f)):Vd(p,v=>v.test(f)),m;m=r.valueCallback?r.valueCallback(b):b,m=a.valueCallback?a.valueCallback(m):m;let _=n.slice(f.length);return{value:m,rest:_}}}function Vd(r,n){for(let a in r)if(Object.prototype.hasOwnProperty.call(r,a)&&n(r[a]))return a}function $d(r,n){for(let a=0;a<r.length;a++)if(n(r[a]))return a}function Xs(r){return(n,a={})=>{let s=n.match(r.matchPattern);if(!s)return null;let i=s[0],u=n.match(r.parsePattern);if(!u)return null;let f=r.valueCallback?r.valueCallback(u[0]):u[0];f=a.valueCallback?a.valueCallback(f):f;let p=n.slice(i.length);return{value:f,rest:p}}}var jd=/^(\d+)(th|st|nd|rd)?/i,zd=/\d+/i,Hd={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Gd={any:[/^b/i,/^(a|c)/i]},Yd={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Qd={any:[/1/i,/2/i,/3/i,/4/i]},Xd={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Zd={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Kd={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Jd={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},ef={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},tf={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Zs={ordinalNumber:Xs({matchPattern:jd,parsePattern:zd,valueCallback:r=>parseInt(r,10)}),era:ur({matchPatterns:Hd,defaultMatchWidth:"wide",parsePatterns:Gd,defaultParseWidth:"any"}),quarter:ur({matchPatterns:Yd,defaultMatchWidth:"wide",parsePatterns:Qd,defaultParseWidth:"any",valueCallback:r=>r+1}),month:ur({matchPatterns:Xd,defaultMatchWidth:"wide",parsePatterns:Zd,defaultParseWidth:"any"}),day:ur({matchPatterns:Kd,defaultMatchWidth:"wide",parsePatterns:Jd,defaultParseWidth:"any"}),dayPeriod:ur({matchPatterns:ef,defaultMatchWidth:"any",parsePatterns:tf,defaultParseWidth:"any"})};var ui={code:"en-US",formatDistance:Hs,formatLong:Gs,formatRelative:Ys,localize:Qs,match:Zs,options:{weekStartsOn:0,firstWeekContainsDate:1}};var rf=["years","months","weeks","days","hours","minutes","seconds"];function Ks(r,n){let a=zs(),s=n?.locale??a.locale??ui,i=n?.format??rf,u=n?.zero??!1,f=n?.delimiter??" ";return s.formatDistance?i.reduce((b,m)=>{let _=`x${m.replace(/(^.)/,P=>P.toUpperCase())}`,v=r[m];return v!==void 0&&(u||r[m])?b.concat(s.formatDistance(_,v)):b},[]).join(f):""}var Js=We(li());async function el(r){let n=await Js.default.getBasicInfo(r),a=new Date(n.videoDetails.publishDate).toLocaleDateString(),s=Number(n.videoDetails.viewCount).toLocaleString(),i=Math.floor(Number(n.videoDetails.lengthSeconds)/3600),u=Math.floor(Number(n.videoDetails.lengthSeconds)%3600/60);return{duration:Ks({hours:i,minutes:u},{format:["hours","minutes","seconds"]}),ownerChannelName:n.videoDetails.ownerChannelName,ownerProfileUrl:n.videoDetails.ownerProfileUrl,publishDate:a,thumbnail:n.videoDetails.thumbnails[4],title:n.videoDetails.title,video_url:n.videoDetails.video_url,viewCount:s}}var cr=require("@raycast/api"),nl=We(rl());async function al(r){return await nl.YoutubeTranscript.fetchTranscript(r).then(a=>a.map(i=>i.text).join(" ").replaceAll(`
`," ")).catch(()=>{(0,cr.showToast)({style:cr.Toast.Style.Failure,title:"\u2757",message:"Sorry, this video doesn't have a transcript."}),(0,cr.popToRoot)()})}var ol=require("react/jsx-runtime");globalThis.fetch=An;function il(r){let[n,a]=(0,Rt.useState)(),[s,i]=(0,Rt.useState)(!1),[u,f]=(0,Rt.useState)(),[p,b]=(0,Rt.useState)(),[m,_]=(0,Rt.useState)(r.arguments.video);if(js({input:r.arguments.video||r.launchContext?.video,setVideoURL:_}).then(R=>_(R)),(0,Rt.useEffect)(()=>{m&&(el(m).then(b).catch(R=>{(0,dr.showToast)({style:dr.Toast.Style.Failure,title:Nt.title,message:"Error fetching video data: "+R.message})}),al(m).then(f).catch(R=>{(0,dr.showToast)({style:dr.Toast.Style.Failure,title:Nt.title,message:"Error fetching video transcript: "+R.message})}))},[m]),is({transcript:u,setSummaryIsLoading:i,setSummary:a}),!p||!u)return null;let{thumbnail:v,title:P}=p,A=n?`${n}

![${P}](${v?.url})
  `:void 0;return(0,ol.jsx)(Oa,{AskFollowUpQuestion:Da,markdown:A,setSummary:a,summaryIsLoading:s,transcript:u,videoData:p})}
/*! Bundled license information:

web-streams-polyfill/dist/ponyfill.es2018.js:
  (**
   * @license
   * web-streams-polyfill v3.3.3
   * Copyright 2024 Mattias Buelens, Diwank Singh Tomer and other contributors.
   * This code is released under the MIT license.
   * SPDX-License-Identifier: MIT
   *)

fetch-blob/index.js:
  (*! fetch-blob. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> *)

formdata-polyfill/esm.min.js:
  (*! formdata-polyfill. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> *)

node-domexception/index.js:
  (*! node-domexception. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> *)

sax/lib/sax.js:
  (*! http://mths.be/fromcodepoint v0.1.0 by @mathias *)

youtube-transcript/dist/youtube-transcript.common.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)
*/
